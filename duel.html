<!DOCTYPE html>
<html lang="en">
<head>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-ML3F7KLZ');</script>
<!-- End Google Tag Manager -->
  <script src="game-engine.js"></script> <script src="components.js" defer></script> 

    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
        <link rel="manifest" href="assets/site.webmanifest">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1v1 Trivia Duel | QuizRealm Multiplayer</title>


    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
<link rel="manifest" href="assets/site.webmanifest">
<link rel="shortcut icon" href="assets/favicon.ico">
<meta name="msapplication-TileColor" content="#020617">
<meta name="theme-color" content="#020617">
    <meta name="description" content="Challenge a friend in the ultimate 1v1 Trivia Duel. Pick a category, track scores, and prove who has the bigger brain in this local multiplayer mode.">
    <meta name="keywords" content="2 player quiz, multiplayer trivia, 1v1 quiz game, duel mode, quizrealm battle">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Outfit:wght@300;400;500;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="components.js" defer></script>
    <script src="data.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Outfit', 'sans-serif'], 
                        arcade: ['Bungee', 'cursive'],
                        mono: ['Share Tech Mono', 'monospace']
                    },
                    colors: {
                        p1Color: '#3b82f6', // Blue
                        p2Color: '#ef4444', // Red
                        bgDark: '#020617',
                    },
                    animation: {
                        'fight': 'fight 0.5s cubic-bezier(0.4, 0, 0.2, 1)',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fight: {
                            '0%': { transform: 'scale(0.5)', opacity: '0' },
                            '50%': { transform: 'scale(1.2)' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #020617; 
            /* Fighting Game Gradient */
            background-image: linear-gradient(to bottom right, #0f172a, #000000);
            min-height: 100vh; 
            color: #e2e8f0;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Character Selection Cards */
        .char-card {
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .char-card.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        /* VS Text styling */
        .vs-text {
            font-family: 'Bungee', cursive;
            text-shadow: 4px 4px 0px #000;
            -webkit-text-stroke: 1px rgba(255,255,255,0.5);
        }
    </style>
</head>

<body class="flex flex-col antialiased selection:bg-purple-500 selection:text-white">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ML3F7KLZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <quiz-header></quiz-header>

    <main class="flex-grow w-full max-w-5xl mx-auto px-4 py-8">

        <div id="setupScreen" class="animate-fade-in">
            <div class="text-center mb-10">
                <span class="bg-purple-900/30 text-purple-400 border border-purple-500/30 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-widest mb-4 inline-block">
                    Local Multiplayer
                </span>
                <h1 class="font-arcade text-5xl md:text-7xl text-white mb-2 leading-none">
                    1<span class="text-purple-500">v</span>1 DUEL
                </h1>
                <p class="text-slate-400">Battle your friends on the same device.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-3xl mx-auto mb-10">
                <div class="glass-panel p-6 rounded-2xl border-t-4 border-t-blue-500 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fas fa-gamepad text-6xl text-blue-500"></i></div>
                    <label class="block text-blue-400 font-bold text-xs uppercase tracking-widest mb-2">Player One</label>
                    <input type="text" id="p1Name" value="Player 1" class="w-full bg-black/40 border border-blue-500/30 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500 font-bold text-lg mb-4">
                    <div class="flex gap-2">
                        <div class="w-8 h-8 rounded bg-blue-600"></div>
                        <span class="text-xs text-slate-500 self-center">Challenger</span>
                    </div>
                </div>

                <div class="glass-panel p-6 rounded-2xl border-t-4 border-t-red-500 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fas fa-gamepad text-6xl text-red-500"></i></div>
                    <label class="block text-red-400 font-bold text-xs uppercase tracking-widest mb-2">Player Two</label>
                    <input type="text" id="p2Name" value="Player 2" class="w-full bg-black/40 border border-red-500/30 rounded-lg p-3 text-white focus:outline-none focus:border-red-500 font-bold text-lg mb-4">
                    <div class="flex gap-2">
                        <div class="w-8 h-8 rounded bg-red-600"></div>
                        <span class="text-xs text-slate-500 self-center">Opponent</span>
                    </div>
                </div>
            </div>

            <div class="max-w-4xl mx-auto">
                <h3 class="text-center text-white font-bold mb-6 flex items-center justify-center gap-2">
                    <i class="fas fa-layer-group text-purple-500"></i> SELECT BATTLEGROUND
                </h3>
                <div id="categoryGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    </div>
            </div>

            <div class="text-center mt-12">
                <button onclick="startGame()" id="startBtn" class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-arcade text-xl py-4 px-12 rounded-xl shadow-lg shadow-purple-900/50 transform hover:scale-105 transition-all opacity-50 cursor-not-allowed" disabled>
                    ENTER ARENA
                </button>
            </div>
        </div>

        <div id="battleScreen" class="hidden min-h-[70vh] flex flex-col">
            
            <div class="flex justify-between items-center bg-black/40 border border-white/10 rounded-xl p-4 mb-8">
                <div class="text-left w-1/3">
                    <div class="text-[10px] text-blue-400 font-bold uppercase tracking-widest" id="battleP1Name">P1</div>
                    <div class="text-3xl font-mono text-white font-bold" id="battleP1Score">0</div>
                </div>
                <div class="text-center w-1/3">
                    <div class="inline-block bg-purple-900/50 border border-purple-500/50 px-3 py-1 rounded text-[10px] font-bold text-purple-300">
                        ROUND <span id="roundNum">1</span>/5
                    </div>
                </div>
                <div class="text-right w-1/3">
                    <div class="text-[10px] text-red-400 font-bold uppercase tracking-widest" id="battleP2Name">P2</div>
                    <div class="text-3xl font-mono text-white font-bold" id="battleP2Score">0</div>
                </div>
            </div>

            <div class="text-center mb-6">
                <div id="turnBanner" class="inline-block px-8 py-2 rounded-full bg-blue-600 text-white font-bold uppercase tracking-widest shadow-[0_0_20px_rgba(59,130,246,0.5)] animate-pulse">
                    Player 1's Turn
                </div>
            </div>

            <div class="glass-panel p-8 rounded-2xl text-center max-w-2xl mx-auto w-full mb-6 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-white/10">
                    <div id="timerBar" class="h-full bg-purple-500 w-full transition-all duration-1000 ease-linear"></div>
                </div>
                <h2 class="text-2xl md:text-3xl font-bold text-white mb-8 mt-4 leading-snug" id="questionText">
                    Loading Question...
                </h2>
                <div class="grid grid-cols-1 gap-3" id="battleOptions">
                    </div>
            </div>

        </div>

        <div id="resultScreen" class="hidden text-center pt-10">
            <div class="mb-6 relative inline-block">
                <div class="absolute inset-0 bg-purple-500 blur-2xl opacity-30 animate-pulse"></div>
                <i class="fas fa-trophy text-6xl text-yellow-400 relative z-10 drop-shadow-xl"></i>
            </div>
            
            <h2 class="font-arcade text-5xl text-white mb-2">VICTORY</h2>
            <p class="text-xl text-slate-300 mb-8">
                <span id="winnerName" class="font-bold text-white text-2xl">Player Name</span> Wins!
            </p>

            <div class="flex justify-center gap-8 mb-12">
                <div class="text-center">
                    <div class="text-xs text-slate-500 uppercase">P1 Score</div>
                    <div class="text-2xl font-mono text-blue-400 font-bold" id="finalP1">0</div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-slate-500 uppercase">P2 Score</div>
                    <div class="text-2xl font-mono text-red-400 font-bold" id="finalP2">0</div>
                </div>
            </div>

            <div class="flex justify-center gap-4">
                <button onclick="location.reload()" class="bg-white/10 hover:bg-white/20 text-white py-3 px-8 rounded-xl font-bold transition">
                    Rematch
                </button>
                <a href="index.html" class="bg-purple-600 hover:bg-purple-500 text-white py-3 px-8 rounded-xl font-bold transition shadow-lg shadow-purple-900/40">
                    Main Menu
                </a>
            </div>
        </div>

        <article class="mt-24 border-t border-white/10 pt-16 max-w-3xl mx-auto">
            <span class="text-purple-500 font-bold tracking-widest uppercase text-xs">Game Mode Info</span>
            <h2 class="text-2xl font-bold text-white mt-2 mb-6">Why Competitive Trivia?</h2>
            <div class="prose prose-invert prose-sm text-slate-400">
                <p>
                    The <strong>1v1 Duel Mode</strong> transforms passive learning into active recall. By adding a competitive element ("Gamification"), your brain releases higher levels of dopamine when you answer correctly, reinforcing the memory pathway.
                </p>
                <p>
                    This mode uses a "Hot Seat" mechanic designed for local multiplayer. Whether you are settling a debate or just killing time, the Duel Mode pulls from our entire database of <strong>Science, History, Tech, and Pop Culture</strong> questions.
                </p>
                <ul class="list-disc pl-5 mt-4 space-y-2">
                    <li><strong class="text-white">Turn-Based Strategy:</strong> It's not just about speed; it's about consistency.</li>
                    <li><strong class="text-white">Fair Play:</strong> Both players face questions from the same difficulty pool.</li>
                    <li><strong class="text-white">No Setup:</strong> No accounts or lobbies needed. Just enter names and fight.</li>
                </ul>
            </div>
        </article>

    </main>

    <quiz-footer></quiz-footer>

    <script>
        // --- GAME LOGIC ---
        let selectedCategory = null;
        let p1Name = "Player 1";
        let p2Name = "Player 2";
        let scoreP1 = 0;
        let scoreP2 = 0;
        let currentRound = 1;
        const totalRounds = 5;
        let currentPlayer = 1; // 1 or 2
        let questionPool = [];
        let isLocked = false;

        // 1. INIT SETUP SCREEN
        function initSetup() {
            const grid = document.getElementById('categoryGrid');
            
            // Use existing CATEGORY_CONFIG from data.js, or fallback
            const config = (typeof CATEGORY_CONFIG !== 'undefined') ? CATEGORY_CONFIG : {
                general: { label: "General", icon: "ðŸ§ " },
                science: { label: "Science", icon: "ðŸ§¬" },
                history: { label: "History", icon: "ðŸ“œ" },
                movies: { label: "Movies", icon: "ðŸŽ¬" }
            };

            grid.innerHTML = '';
            Object.keys(config).forEach(key => {
                const cat = config[key];
                if(cat.group === 'locked') return; // Skip locked

                const div = document.createElement('div');
                div.className = "char-card bg-white/5 p-4 rounded-xl cursor-pointer hover:bg-white/10 text-center";
                div.innerHTML = `
                    <div class="text-2xl mb-2">${cat.icon}</div>
                    <div class="text-xs font-bold text-white uppercase">${cat.label}</div>
                `;
                div.onclick = () => selectCategory(key, div);
                grid.appendChild(div);
            });
        }

        function selectCategory(key, el) {
            selectedCategory = key;
            // Visual feedback
            document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            
            // Enable button
            const btn = document.getElementById('startBtn');
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function startGame() {
            p1Name = document.getElementById('p1Name').value || "Player 1";
            p2Name = document.getElementById('p2Name').value || "Player 2";

            // Prepare Questions
            // Try to get from QUESTION_BANKS in data.js
            if (typeof QUESTION_BANKS !== 'undefined' && QUESTION_BANKS[selectedCategory]) {
                const raw = QUESTION_BANKS[selectedCategory];
                // Combine easy/med/hard if structured
                if(raw.easy) questionPool = [...raw.easy, ...raw.medium, ...raw.hard];
                else questionPool = raw;
            } else {
                // Fallback questions
                questionPool = [
                    { question: "What is the capital of France?", options: ["Paris", "Berlin", "Rome"], correctIndex: 0 },
                    { question: "H2O is the chemical formula for?", options: ["Gold", "Water", "Silver"], correctIndex: 1 },
                    // ... add more generics if needed
                ];
            }
            
            // Shuffle
            questionPool = questionPool.sort(() => 0.5 - Math.random());

            // Switch Screens
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('battleScreen').classList.remove('hidden');
            document.getElementById('battleP1Name').textContent = p1Name;
            document.getElementById('battleP2Name').textContent = p2Name;

            loadRound();
        }

        function loadRound() {
            if (currentRound > totalRounds) {
                endGame();
                return;
            }

            isLocked = false;
            document.getElementById('roundNum').textContent = `${currentRound}/${totalRounds}`;
            
            // UI Update for Turn
            const banner = document.getElementById('turnBanner');
            if (currentPlayer === 1) {
                banner.textContent = `${p1Name}'s Turn`;
                banner.className = "inline-block px-8 py-2 rounded-full bg-blue-600 text-white font-bold uppercase tracking-widest shadow-[0_0_20px_rgba(59,130,246,0.5)]";
            } else {
                banner.textContent = `${p2Name}'s Turn`;
                banner.className = "inline-block px-8 py-2 rounded-full bg-red-600 text-white font-bold uppercase tracking-widest shadow-[0_0_20px_rgba(239,68,68,0.5)]";
            }

            // Load Question
            const q = questionPool[currentRound + currentPlayer]; // Simple index logic to ensure unique qs
            if (!q) { endGame(); return; } // Safety catch

            document.getElementById('questionText').textContent = q.question;
            const opts = document.getElementById('battleOptions');
            opts.innerHTML = '';

            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 transition-all font-medium text-slate-300";
                btn.textContent = opt;
                btn.onclick = () => handleAnswer(btn, idx, q.correctIndex);
                opts.appendChild(btn);
            });
        }

        function handleAnswer(btn, selected, correct) {
            if (isLocked) return;
            isLocked = true;

            if (selected === correct) {
                btn.classList.add('bg-green-600', 'border-green-500', 'text-white');
                if (currentPlayer === 1) scoreP1 += 100;
                else scoreP2 += 100;
            } else {
                btn.classList.add('bg-red-600', 'border-red-500', 'text-white');
            }

            // Update Scores
            document.getElementById('battleP1Score').textContent = scoreP1;
            document.getElementById('battleP2Score').textContent = scoreP2;

            setTimeout(() => {
                if (currentPlayer === 1) {
                    currentPlayer = 2; // Switch to P2 for same round (optional logic, or next question)
                    // Actually, let's keep it simple: P1 answers Q1, P2 answers Q2.
                    // So we just toggle player.
                    loadRound();
                } else {
                    currentPlayer = 1;
                    currentRound++;
                    loadRound();
                }
            }, 1000);
        }

        function endGame() {
            document.getElementById('battleScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');
            
            document.getElementById('finalP1').textContent = scoreP1;
            document.getElementById('finalP2').textContent = scoreP2;

            const winnerEl = document.getElementById('winnerName');
            if (scoreP1 > scoreP2) {
                winnerEl.textContent = p1Name;
                winnerEl.className = "font-bold text-blue-400 text-2xl";
            } else if (scoreP2 > scoreP1) {
                winnerEl.textContent = p2Name;
                winnerEl.className = "font-bold text-red-400 text-2xl";
            } else {
                winnerEl.textContent = "It's a Draw!";
                winnerEl.className = "font-bold text-purple-400 text-2xl";
            }
        }

        window.onload = initSetup;
    </script>
</body>
</html>