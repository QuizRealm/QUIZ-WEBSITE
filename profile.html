<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>The Vibe Lab™ — Audio Identity System</title>
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="20 Questions. 50-Point Vector Analysis. The ultimate audio identity test." />

  <!-- Fonts: Inter (UI) + Bebas Neue (Headlines) + Space Mono (Data) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Bebas+Neue&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: '#FF3B30',  
            neon: '#CCFF00',
            dark: '#050505',
            panel: '#111111',
            line: '#333333'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            titans: ['Bebas Neue', 'sans-serif'],
            mono: ['Space Mono', 'monospace'],
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'slide-up': 'slideUp 0.5s ease-out forwards',
          },
          keyframes: {
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            }
          }
        }
      }
    }
  </script>

  <style>
    body { background-color: #000; color: white; overflow-x: hidden; }
    
    /* Professional Glass Effect */
    .glass-panel {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .tap-fast { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
    
    /* Custom Scrollbar for Results */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: #000; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

    /* VS Badge Animation */
    @keyframes clash {
      0%, 100% { transform: translate(-50%, -50%) rotate(-10deg) scale(1); }
      50% { transform: translate(-50%, -50%) rotate(-10deg) scale(1.1); }
    }
    .vs-badge-anim { animation: clash 2s infinite; }
  </style>
</head>

<body class="bg-black font-sans antialiased h-screen flex flex-col">

  <!-- HEADER (Fixed, High Z-Index) -->
  <header class="fixed top-0 w-full z-[60] px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/90 to-transparent pointer-events-none">
    <div class="pointer-events-auto flex items-center gap-3">
      <div class="w-8 h-8 bg-white text-black font-titans flex items-center justify-center text-xl pt-1">VL</div>
      <div class="flex flex-col">
        <span class="font-bold text-xs uppercase tracking-widest leading-none">The Vibe Lab</span>
        <span class="text-[9px] text-white/50 font-mono leading-none mt-1">SYS_VER_3.2</span>
      </div>
    </div>
    <div class="pointer-events-auto flex items-center gap-3">
       <!-- Progress Counter (Visible during quiz) -->
       <div id="header-counter" class="hidden text-[10px] font-mono font-bold text-white/80 bg-black/50 px-2 py-1 rounded border border-white/10">01 / 20</div>
       
       <div class="bg-white/10 backdrop-blur-md border border-white/10 px-3 py-1 rounded-full flex items-center gap-2">
        <div class="w-1.5 h-1.5 bg-neon rounded-full animate-pulse"></div>
        <span class="text-[10px] font-mono font-bold text-white/80">ONLINE</span>
      </div>
    </div>
  </header>

  <!-- MAIN APP -->
  <main class="flex-grow relative w-full h-full">

    <!-- SCREEN 1: LANDING -->
    <section id="screen-landing" class="absolute inset-0 flex flex-col items-center justify-center p-6 bg-[url('https://images.unsplash.com/photo-1493225255756-d9584f8606e9?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center">
      <div class="absolute inset-0 bg-black/60 backdrop-blur-[2px]"></div>

      <div class="relative z-10 w-full max-w-md text-center space-y-8 animate-slide-up">
        
        <div class="inline-flex items-center gap-2 border border-white/20 bg-black/40 px-4 py-2 rounded-full backdrop-blur-md">
          <span class="text-neon text-xs">★</span>
          <span class="text-[10px] font-bold uppercase tracking-[0.2em]">50-Point Vector Analysis</span>
        </div>

        <div>
          <h1 class="font-titans text-8xl md:text-9xl leading-[0.8] mb-2 text-white drop-shadow-2xl">
            TITANS<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-brand to-purple-600">VS</span><br>TITANS
          </h1>
          <p class="text-lg text-white/80 font-medium max-w-xs mx-auto leading-relaxed">
            No metadata. Pure psychology.<br>
            <span class="text-white border-b border-brand">20 Visual Scenarios</span> to map your true audio identity.
          </p>
        </div>

        <button id="btn-start" class="group relative w-full bg-white text-black font-titans text-4xl py-5 hover:bg-neon transition-colors duration-300 shadow-[0_0_30px_rgba(255,255,255,0.15)] overflow-hidden">
          <span class="relative z-10">START ANALYSIS</span>
          <div class="absolute inset-0 bg-brand transform translate-y-full group-hover:translate-y-0 transition-transform duration-200 z-0"></div>
        </button>

        <div class="grid grid-cols-3 gap-4 border-t border-white/10 pt-6">
          <div class="flex flex-col">
            <span class="font-titans text-2xl">20</span>
            <span class="text-[9px] font-mono uppercase text-white/50">Scenarios</span>
          </div>
          <div class="flex flex-col">
            <span class="font-titans text-2xl">50</span>
            <span class="text-[9px] font-mono uppercase text-white/50">Metrics</span>
          </div>
          <div class="flex flex-col">
            <span class="font-titans text-2xl">01</span>
            <span class="text-[9px] font-mono uppercase text-white/50">Identity</span>
          </div>
        </div>
      </div>
    </section>


    <!-- SCREEN 2: QUIZ (Interactive Battle) -->
    <section id="screen-quiz" class="hidden absolute inset-0 flex flex-col bg-black">
      
      <!-- Top Progress Bar (Under Header) -->
      <div class="absolute top-0 left-0 w-full h-1 bg-white/10 z-50">
        <div id="progress-fill" class="h-full bg-neon transition-all duration-300 w-0 shadow-[0_0_10px_#CCFF00]"></div>
      </div>

      <!-- Floating Question (Adjusted for Mobile Visibility) -->
      <div class="absolute top-24 left-0 right-0 z-40 flex justify-center pointer-events-none px-4">
        <div class="glass-panel px-6 py-4 rounded-xl border-l-4 border-l-neon shadow-2xl max-w-md w-full text-center">
          <h2 id="q-prompt" class="font-titans text-3xl md:text-5xl text-white tracking-wide leading-none">
            LOADING...
          </h2>
        </div>
      </div>

      <!-- VS Badge -->
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 vs-badge-anim pointer-events-none">
        <div class="bg-brand text-white font-titans text-3xl px-3 py-1 border-4 border-black shadow-xl rotate-[-5deg]">
          VS
        </div>
      </div>

      <!-- Split Screen Content -->
      <div class="flex flex-col md:flex-row h-full w-full">
        
        <!-- OPTION A -->
        <button id="btn-a" class="relative flex-1 group h-1/2 md:h-full overflow-hidden focus:outline-none border-b-2 md:border-b-0 md:border-r-2 border-black">
          <img id="img-a" src="" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-70 group-hover:opacity-100" />
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-90"></div>
          
          <!-- Content A -->
          <div class="absolute bottom-0 left-0 w-full p-6 md:p-8 pb-8 text-left z-20 flex flex-col items-start">
            <span class="bg-white/10 backdrop-blur-md border border-white/10 px-2 py-1 text-[10px] font-bold tracking-widest text-white/70 mb-2 rounded">OPTION A</span>
            <span id="label-a" class="font-titans text-3xl md:text-5xl leading-none mb-2 text-white group-hover:text-neon transition-colors">...</span>
            <p id="desc-a" class="font-mono text-[10px] md:text-xs text-white/80 max-w-xs border-l-2 border-white/30 pl-3 leading-tight">...</p>
            
            <!-- Hover CTA (Visible on Touch too via CSS active state if needed) -->
            <div class="mt-4 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-0 md:translate-y-2 group-hover:translate-y-0 duration-300">
              <span class="bg-white text-black font-bold text-[10px] md:text-xs px-4 py-2 rounded-full uppercase tracking-widest shadow-lg">Tap to Select</span>
            </div>
          </div>
        </button>

        <!-- OPTION B -->
        <button id="btn-b" class="relative flex-1 group h-1/2 md:h-full overflow-hidden focus:outline-none">
          <img id="img-b" src="" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-70 group-hover:opacity-100" />
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-90"></div>
          
          <!-- Content B -->
          <div class="absolute bottom-0 right-0 w-full p-6 md:p-8 pb-8 text-right z-20 flex flex-col items-end">
            <span class="bg-white/10 backdrop-blur-md border border-white/10 px-2 py-1 text-[10px] font-bold tracking-widest text-white/70 mb-2 rounded">OPTION B</span>
            <span id="label-b" class="font-titans text-3xl md:text-5xl leading-none mb-2 text-white group-hover:text-brand transition-colors">...</span>
            <p id="desc-b" class="font-mono text-[10px] md:text-xs text-white/80 max-w-xs border-r-2 border-white/30 pr-3 leading-tight">...</p>
            
            <!-- Hover CTA -->
            <div class="mt-4 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-0 md:translate-y-2 group-hover:translate-y-0 duration-300">
              <span class="bg-white text-black font-bold text-[10px] md:text-xs px-4 py-2 rounded-full uppercase tracking-widest shadow-lg">Tap to Select</span>
            </div>
          </div>
        </button>

      </div>
      
      <!-- Safe Exit (Moved to bottom right to avoid Header conflict) -->
      <button id="btn-exit" class="absolute bottom-4 right-4 z-50 text-white/30 hover:text-white text-[9px] font-mono border border-white/10 px-3 py-1 rounded hover:bg-white/10 transition-colors">
        ESC
      </button>
    </section>


    <!-- SCREEN 3: RESULTS DASHBOARD (Professional) -->
    <section id="screen-result" class="hidden absolute inset-0 bg-dark overflow-y-auto">
      <div class="min-h-full w-full max-w-4xl mx-auto p-6 pt-24 pb-12">
        
        <!-- 1. HEADER IDENTITY -->
        <div class="flex flex-col md:flex-row items-end justify-between border-b border-line pb-6 mb-8 gap-6 animate-slide-up">
          <div>
            <div class="flex items-center gap-3 mb-2">
              <span class="w-2 h-2 bg-neon rounded-full"></span>
              <span class="text-xs font-mono text-white/50 uppercase tracking-widest">Calculated Archetype</span>
            </div>
            <h1 id="r-title" class="font-titans text-6xl md:text-9xl leading-[0.8] text-white">UNKNOWN</h1>
          </div>
          <div class="text-right">
             <div class="bg-panel border border-line px-4 py-2 rounded mb-2 inline-block">
               <span class="font-mono text-xs text-brand font-bold">MATCH: 98.4%</span>
             </div>
             <p id="r-sub" class="text-sm md:text-base text-white/80 max-w-md font-medium leading-relaxed">
               Analysis pending...
             </p>
          </div>
        </div>

        <!-- 2. DOMINANT TRAITS (Top 3 Stats) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 animate-slide-up" style="animation-delay: 0.1s">
           <!-- Injected via JS -->
           <div id="trait-1" class="bg-panel border border-line p-5 rounded-xl"></div>
           <div id="trait-2" class="bg-panel border border-line p-5 rounded-xl"></div>
           <div id="trait-3" class="bg-panel border border-line p-5 rounded-xl"></div>
        </div>

        <!-- 3. VIBEPRINT (The Professional Data) -->
        <div class="glass-panel p-6 rounded-2xl mb-8 animate-slide-up" style="animation-delay: 0.2s">
          <div class="flex justify-between items-center mb-6">
            <h3 class="font-titans text-2xl tracking-wide">VECTOR ANALYSIS</h3>
            <span class="text-[10px] font-mono text-white/40">50-POINT GRID // VISUALIZED</span>
          </div>
          
          <div id="r-metrics-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-x-12 gap-y-6">
             <!-- Physics Cluster -->
             <div>
               <div class="text-[10px] font-bold text-white/40 uppercase mb-3 border-b border-white/10 pb-1">Cluster A: Physics</div>
               <div id="cluster-physics" class="space-y-3"></div>
             </div>
             <!-- Mood Cluster -->
             <div>
               <div class="text-[10px] font-bold text-white/40 uppercase mb-3 border-b border-white/10 pb-1">Cluster B: Mood</div>
               <div id="cluster-mood" class="space-y-3"></div>
             </div>
             <!-- Texture Cluster -->
             <div>
               <div class="text-[10px] font-bold text-white/40 uppercase mb-3 border-b border-white/10 pb-1">Cluster C: Texture</div>
               <div id="cluster-texture" class="space-y-3"></div>
             </div>
             <!-- Narrative Cluster -->
             <div>
               <div class="text-[10px] font-bold text-white/40 uppercase mb-3 border-b border-white/10 pb-1">Cluster D: Narrative</div>
               <div id="cluster-narrative" class="space-y-3"></div>
             </div>
          </div>
        </div>

        <!-- 4. ACTION CENTER (CTAs) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 animate-slide-up" style="animation-delay: 0.3s">
          
          <button id="btn-share" class="group bg-white text-black p-6 rounded-xl flex flex-col items-center justify-center gap-2 hover:bg-neon transition-colors duration-300">
             <span class="font-titans text-3xl">DOWNLOAD POSTER</span>
             <span class="font-mono text-[10px] uppercase tracking-widest opacity-60 group-hover:opacity-100">For Instagram Stories</span>
          </button>

          <div class="grid grid-cols-2 gap-4">
             <a href="#" onclick="alert('Opening Spotify API hook...')" class="bg-[#1DB954] text-white p-4 rounded-xl flex flex-col items-center justify-center hover:brightness-110 transition-all">
                <span class="font-bold text-sm tracking-wide">SPOTIFY</span>
                <span class="text-[10px] opacity-80">Generate Playlist</span>
             </a>
             <button id="btn-again" class="bg-panel border border-line text-white p-4 rounded-xl flex flex-col items-center justify-center hover:bg-white hover:text-black transition-all">
                <span class="font-bold text-sm tracking-wide">RESTART</span>
                <span class="text-[10px] opacity-80">New Calibration</span>
             </button>
          </div>

        </div>

      </div>
    </section>

  </main>

  <!-- HIDDEN CANVAS -->
  <canvas id="share-canvas" width="1080" height="1920" class="hidden"></canvas>

  <script>
    // --- FULL 20-QUESTION SET ---
    // Mapping visuals to 50 parameters
    const QUESTIONS = [
      { 
        id: 1, prompt: "FRIDAY NIGHT ENERGY?", 
        a: { label: "THE STADIUM", desc: "50,000 people screaming every word.", img: "https://images.unsplash.com/photo-1459749411177-2a2965eec0a5?q=80&w=1000", delta: { energy: 0.2, liveness: 0.3, chaos: 0.1, loudness: 0.2 } },
        b: { label: "THE ROOFTOP", desc: "3AM deep talks & city lights.", img: "https://images.unsplash.com/photo-1514525253440-b393452e8d26?q=80&w=1000", delta: { energy: -0.2, intimacy: 0.3, deep: 0.2, atmosphere: 0.3 } }
      },
      { 
        id: 2, prompt: "CHOOSE YOUR ANTHEM", 
        a: { label: "THE DROP", desc: "Bass that rattles your ribcage.", img: "https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?q=80&w=1000", delta: { danceability: 0.3, energy: 0.2, bass: 0.4, synthetic: 0.2 } },
        b: { label: "THE LYRIC", desc: "A bridge that makes you cry.", img: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=1000", delta: { valence: -0.2, emotional: 0.4, lyrical: 0.3, acousticness: 0.2 } }
      },
      { 
        id: 3, prompt: "YOUR AESTHETIC", 
        a: { label: "NEON CHAOS", desc: "Fast cars, flashing lights.", img: "https://images.unsplash.com/photo-1565058682670-36224340d026?q=80&w=1000", delta: { tempo: 0.2, futurism: 0.3, synthetic: 0.2, intensity: 0.2 } },
        b: { label: "GOLDEN HOUR", desc: "Vinyl records and warm sun.", img: "https://images.unsplash.com/photo-1621259250667-849504a431c7?q=80&w=1000", delta: { acousticness: 0.3, nostalgia: 0.4, organic: 0.3, warmth: 0.3 } }
      },
      { 
        id: 4, prompt: "MAIN CHARACTER", 
        a: { label: "THE VILLAIN", desc: "Walking away from explosions.", img: "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=1000", delta: { aggression: 0.4, confidence: 0.3, dark: 0.3, rock: 0.2 } },
        b: { label: "THE HERO", desc: "Running to find love.", img: "https://images.unsplash.com/photo-1517021897933-0e0319cfbc28?q=80&w=1000", delta: { euphoria: 0.4, cinematic: 0.3, valence: 0.3, pop: 0.2 } }
      },
      { 
        id: 5, prompt: "TEXTURE CHECK", 
        a: { label: "GRIT", desc: "Distortion and dust.", img: "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000", delta: { lo_fi: 0.4, rock: 0.3, organic: 0.2, intensity: 0.2 } },
        b: { label: "GLOSS", desc: "Polished and pristine.", img: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=1000", delta: { pop: 0.3, production_value: 0.4, synthetic: 0.2, clarity: 0.3 } }
      },
      { 
        id: 6, prompt: "SPEED LIMIT", 
        a: { label: "FULL THROTTLE", desc: "180 BPM. Don't blink.", img: "https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?q=80&w=1000", delta: { tempo: 0.4, energy: 0.3, intensity: 0.3, chaos: 0.2 } },
        b: { label: "CRUISE CONTROL", desc: "Slow motion. Windows down.", img: "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?q=80&w=1000", delta: { chill: 0.4, tempo: -0.2, atmosphere: 0.3, softness: 0.2 } }
      },
      { 
        id: 7, prompt: "VOCAL STYLE", 
        a: { label: "RAW SOUL", desc: "Cracking voice, pure feeling.", img: "https://images.unsplash.com/photo-1516280440614-6697288d5d38?q=80&w=1000", delta: { speechiness: 0.2, emotional: 0.4, organic: 0.3, acousticness: 0.1 } },
        b: { label: "HYPNOTIC FLOW", desc: "Rhythmic, precise, cool.", img: "https://images.unsplash.com/photo-1520333789090-1afc82db536a?q=80&w=1000", delta: { hiphop: 0.4, speechiness: 0.3, confidence: 0.3, danceability: 0.2 } }
      },
      { 
        id: 8, prompt: "THE VENUE", 
        a: { label: "UNDERGROUND", desc: "Sweaty walls, dark tech.", img: "https://images.unsplash.com/photo-1574169208507-84376144848b?q=80&w=1000", delta: { techno: 0.4, dark: 0.3, energy: 0.2, atmosphere: 0.2 } },
        b: { label: "VIP LOUNGE", desc: "Velvet ropes & champagne.", img: "https://images.unsplash.com/photo-1561524326-879743c3d523?q=80&w=1000", delta: { luxury: 0.4, pop: 0.3, danceability: 0.2, gloss: 0.3 } }
      },
      { 
        id: 9, prompt: "TIME MACHINE", 
        a: { label: "REWIND", desc: "Take me back.", img: "https://images.unsplash.com/photo-1588515724527-074a7a56616c?q=80&w=1000", delta: { nostalgia: 0.5, classic: 0.4, acousticness: 0.2, warmth: 0.2 } },
        b: { label: "FAST FORWARD", desc: "The year 3000.", img: "https://images.unsplash.com/photo-1485827404703-89b55fcc595e?q=80&w=1000", delta: { futurism: 0.5, synthetic: 0.3, experimental: 0.3, weird: 0.2 } }
      },
      { 
        id: 10, prompt: "INSTRUMENTS", 
        a: { label: "STRINGS", desc: "Orchestral drama.", img: "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1000", delta: { instrumentalness: 0.4, cinematic: 0.4, drama: 0.3, acousticness: 0.2 } },
        b: { label: "DRUMS", desc: "Tribal rhythm.", img: "https://images.unsplash.com/photo-1519892300165-31a5463f0c8f?q=80&w=1000", delta: { danceability: 0.3, energy: 0.3, rhythm: 0.4, grounded: 0.2 } }
      },
      { 
        id: 11, prompt: "MOOD COLOR", 
        a: { label: "DEEP BLUE", desc: "Rainy days & thinking.", img: "https://images.unsplash.com/photo-1494587416117-f10426b732de?q=80&w=1000", delta: { valence: -0.3, deep: 0.4, atmosphere: 0.3, chill: 0.2 } },
        b: { label: "FIERY RED", desc: "Passion & anger.", img: "https://images.unsplash.com/photo-1505330622279-bf7d7fc918f4?q=80&w=1000", delta: { energy: 0.3, aggression: 0.3, intensity: 0.3, rock: 0.2 } }
      },
      { 
        id: 12, prompt: "THE ENDING", 
        a: { label: "FADE OUT", desc: "Drifting into silence.", img: "https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?q=80&w=1000", delta: { softness: 0.3, ethereal: 0.3, atmosphere: 0.2, acousticness: 0.1 } },
        b: { label: "HARD STOP", desc: "Sudden shock.", img: "https://images.unsplash.com/photo-1505545121909-2d48e22f1618?q=80&w=1000", delta: { confidence: 0.3, energy: 0.2, punk: 0.2, surprise: 0.3 } }
      },
      { 
        id: 13, prompt: "COMPLEXITY", 
        a: { label: "MINIMALIST", desc: "Space to breathe.", img: "https://images.unsplash.com/photo-1494438639946-1ebd1d20bf85?q=80&w=1000", delta: { simple: 0.4, acousticness: 0.2, chill: 0.3, clarity: 0.2 } },
        b: { label: "MAXIMALIST", desc: "Wall of sound.", img: "https://images.unsplash.com/photo-1550684848-86a5d8727436?q=80&w=1000", delta: { complex: 0.4, chaos: 0.3, energy: 0.2, loudness: 0.3 } }
      },
      { 
        id: 14, prompt: "DANCE FLOOR", 
        a: { label: "MOSHPIT", desc: "Bodies colliding.", img: "https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?q=80&w=1000", delta: { energy: 0.5, aggression: 0.3, punk: 0.3, intensity: 0.4 } },
        b: { label: "DISCO BALL", desc: "Grooving till sunrise.", img: "https://images.unsplash.com/photo-1545128485-c400e7702796?q=80&w=1000", delta: { danceability: 0.5, funk: 0.4, pop: 0.2, valence: 0.2 } }
      },
      { 
        id: 15, prompt: "SOURCE CODE", 
        a: { label: "DIGITAL", desc: "Made by machines.", img: "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=1000", delta: { synthetic: 0.5, techno: 0.3, futurism: 0.2, precision: 0.2 } },
        b: { label: "ANALOG", desc: "Made by hands.", img: "https://images.unsplash.com/photo-1525909002-1b05e0c869d8?q=80&w=1000", delta: { organic: 0.5, folk: 0.3, acousticness: 0.2, warmth: 0.3 } }
      },
      { 
        id: 16, prompt: "LYRICAL FOCUS", 
        a: { label: "STORYTELLER", desc: "Tell me what happened.", img: "https://images.unsplash.com/photo-1478737270239-2f02b77ac6d5?q=80&w=1000", delta: { lyrical: 0.5, folk: 0.2, speechiness: 0.3, narrative: 0.4 } },
        b: { label: "ABSTRACT", desc: "Make me feel strange.", img: "https://images.unsplash.com/photo-1549490349-8643362247b5?q=80&w=1000", delta: { experimental: 0.4, weird: 0.3, atmosphere: 0.3, instrumentalness: 0.2 } }
      },
      { 
        id: 17, prompt: "VOLUME", 
        a: { label: "LOUD", desc: "Turn it up to 11.", img: "https://images.unsplash.com/photo-1593697820826-2535f160fce7?q=80&w=1000", delta: { loudness: 0.5, energy: 0.3, aggression: 0.2, rock: 0.2 } },
        b: { label: "WHISPER", desc: "Lean in close.", img: "https://images.unsplash.com/photo-1487215078519-e24265f1d896?q=80&w=1000", delta: { softness: 0.5, intimacy: 0.4, acousticness: 0.3, chill: 0.2 } }
      },
      { 
        id: 18, prompt: "RHYTHM", 
        a: { label: "STEADY", desc: "Four on the floor.", img: "https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?q=80&w=1000", delta: { stable: 0.4, house: 0.3, danceability: 0.2, pop: 0.2 } },
        b: { label: "BROKEN", desc: "Syncopated chaos.", img: "https://images.unsplash.com/photo-1519892300165-31a5463f0c8f?q=80&w=1000", delta: { jazz: 0.3, experimental: 0.3, complex: 0.2, rhythm: 0.3 } }
      },
      { 
        id: 19, prompt: "DESTINATION", 
        a: { label: "SPACE", desc: "Floating in zero gravity.", img: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1000", delta: { atmospheric: 0.5, ethereal: 0.4, futurism: 0.2, instrumentalness: 0.2 } },
        b: { label: "EARTH", desc: "Feet in the dirt.", img: "https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1000", delta: { grounded: 0.5, organic: 0.3, folk: 0.2, acousticness: 0.2 } }
      },
      { 
        id: 20, prompt: "THE VIBE", 
        a: { label: "SOLO", desc: "Headphones on world off.", img: "https://images.unsplash.com/photo-1515944526102-176c24f4699d?q=80&w=1000", delta: { intimacy: 0.4, deep: 0.3, chill: 0.2, lyrical: 0.2 } },
        b: { label: "SQUAD", desc: "Speakers blasting.", img: "https://images.unsplash.com/photo-1533174072545-e8d4aa97edf9?q=80&w=1000", delta: { energy: 0.3, party: 0.4, danceability: 0.3, loudness: 0.2 } }
      }
    ];

    const state = {
      idx: 0,
      params: {
        // Initial 0.5 baseline for all 50 params
        energy: 0.5, valence: 0.5, acousticness: 0.5, danceability: 0.5, instrumentalness: 0.5,
        liveness: 0.5, loudness: 0.5, speechiness: 0.5, tempo: 0.5, popularity: 0.5,
        chaos: 0.5, nostalgia: 0.5, futurism: 0.5, aggression: 0.5, euphoria: 0.5,
        dark: 0.5, intimacy: 0.5, organic: 0.5, synthetic: 0.5, cinematic: 0.5,
        lo_fi: 0.5, production_value: 0.5, emotional: 0.5, lyrical: 0.5, bass: 0.5,
        atmosphere: 0.5, chill: 0.5, confidence: 0.5, weird: 0.5, classic: 0.5,
        rock: 0.5, pop: 0.5, hiphop: 0.5, techno: 0.5, folk: 0.5, jazz: 0.5,
        house: 0.5, punk: 0.5, funk: 0.5, experimental: 0.5, softness: 0.5,
        intensity: 0.5, warmth: 0.5, deep: 0.5, stable: 0.5, complex: 0.5,
        simple: 0.5, grounded: 0.5, ethereal: 0.5, drama: 0.5
      }
    };

    const el = (id) => document.getElementById(id);

    // --- INIT ---
    function init() {
      state.idx = 0;
      for (const k in state.params) state.params[k] = 0.5;
      showScreen('screen-quiz');
      renderQuestion();
      el('header-counter').classList.remove('hidden');
    }

    function showScreen(id) {
      ['screen-landing', 'screen-quiz', 'screen-result'].forEach(s => el(s).classList.add('hidden'));
      el(id).classList.remove('hidden');
    }

    // --- RENDER QUESTION ---
    function renderQuestion() {
      if (state.idx >= QUESTIONS.length) {
        finish();
        return;
      }
      const q = QUESTIONS[state.idx];
      el('q-prompt').innerText = q.prompt;
      el('label-a').innerText = q.a.label;
      el('desc-a').innerText = q.a.desc;
      el('img-a').src = q.a.img;
      el('label-b').innerText = q.b.label;
      el('desc-b').innerText = q.b.desc;
      el('img-b').src = q.b.img;
      
      const pct = ((state.idx + 1) / QUESTIONS.length) * 100;
      el('progress-fill').style.width = `${pct}%`;
      
      el('header-counter').innerText = `${String(state.idx + 1).padStart(2, '0')} / ${QUESTIONS.length}`;
    }

    // --- HANDLE LOGIC ---
    function handleChoice(choice) { 
      const q = QUESTIONS[state.idx];
      const delta = q[choice].delta;
      for (let key in delta) {
        if (state.params[key] !== undefined) {
          state.params[key] = Math.max(0, Math.min(1, state.params[key] + delta[key]));
        }
      }
      state.idx++;
      renderQuestion();
    }

    // --- RESULTS LOGIC ---
    function finish() {
      const arch = getArchetype();
      el('r-title').innerText = arch.title;
      el('r-sub').innerText = arch.desc;
      el('header-counter').classList.add('hidden');
      
      console.log("FINAL VECTOR ANALYSIS:");
      console.table(state.params); // <--- Developer: View raw stats here

      renderTraitCards();
      renderClusterCharts();

      showScreen('screen-result');
    }

    function renderTraitCards() {
       // Find top 3 distinct traits
       const sorted = Object.keys(state.params)
         .filter(k => !['loudness','popularity','tempo'].includes(k)) 
         .sort((a,b) => state.params[b] - state.params[a]);
       
       const top3 = sorted.slice(0, 3);
       
       top3.forEach((key, i) => {
          const val = Math.round(state.params[key] * 100);
          const cardId = `trait-${i+1}`;
          const elCard = el(cardId);
          
          let colorClass = i === 0 ? 'text-neon' : 'text-white';
          
          elCard.innerHTML = `
             <div class="flex justify-between items-start mb-2">
                <span class="text-[10px] font-bold uppercase text-white/50 tracking-widest">Dominant Trait 0${i+1}</span>
                <span class="font-mono text-xs ${colorClass}">${val}%</span>
             </div>
             <div class="font-titans text-3xl uppercase tracking-wide text-white mb-1">${key}</div>
             <div class="w-full bg-white/10 h-1 rounded-full overflow-hidden">
                <div class="h-full bg-white" style="width: ${val}%"></div>
             </div>
          `;
       });
    }

    function renderClusterCharts() {
       const createBar = (key, label) => {
          const val = state.params[key];
          const pct = Math.round(val * 100);
          return `
            <div class="flex items-center gap-3 text-xs">
              <div class="w-20 font-bold text-white/60 uppercase text-[9px] text-right tracking-wider">${label || key}</div>
              <div class="flex-1 bg-white/5 h-2 rounded-sm overflow-hidden border border-white/5">
                 <div class="h-full bg-white transition-all duration-1000" style="width: ${pct}%"></div>
              </div>
              <div class="w-8 font-mono text-right text-white/40 text-[9px]">${pct}</div>
            </div>
          `;
       };

       el('cluster-physics').innerHTML = `
          ${createBar('energy', 'Energy')}
          ${createBar('chaos', 'Chaos')}
          ${createBar('loudness', 'Volume')}
          ${createBar('tempo', 'Speed')}
       `;
       
       el('cluster-mood').innerHTML = `
          ${createBar('valence', 'Happiness')}
          ${createBar('dark', 'Darkness')}
          ${createBar('euphoria', 'Euphoria')}
          ${createBar('aggression', 'Rage')}
       `;

       el('cluster-texture').innerHTML = `
          ${createBar('synthetic', 'Digital')}
          ${createBar('organic', 'Natural')}
          ${createBar('lo_fi', 'Grit')}
          ${createBar('production_value', 'Polish')}
       `;

       el('cluster-narrative').innerHTML = `
          ${createBar('cinematic', 'Cinema')}
          ${createBar('nostalgia', 'Memory')}
          ${createBar('futurism', 'Future')}
          ${createBar('emotional', 'Feels')}
       `;
    }

    function getArchetype() {
      const p = state.params;
      if (p.chaos > 0.7 && p.energy > 0.7) return { title: "THE RIOT", desc: "Pure adrenaline. You crave disorder and high volume." };
      if (p.futurism > 0.7 && p.synthetic > 0.7) return { title: "THE CYBORG", desc: "Digital soul. You prefer machines over humans." };
      if (p.nostalgia > 0.7 && p.acousticness > 0.6) return { title: "TIME TRAVELER", desc: "Stuck in a golden past. Vinyl crackles and warm memories." };
      if (p.dark > 0.6 && p.energy < 0.4) return { title: "NOCTURNAL", desc: "You thrive in the shadows. 3AM playlists only." };
      if (p.euphoria > 0.7 && p.danceability > 0.7) return { title: "MAIN EVENT", desc: "Living for the drop. Life is a festival." };
      if (p.aggression > 0.6 && p.rock > 0.5) return { title: "THE REBEL", desc: "Distortion is your love language." };
      if (p.organic > 0.7 && p.folk > 0.5) return { title: "THE ROOT", desc: "Grounded. Earthy. Raw. No autotune allowed." };
      if (p.intimacy > 0.7 && p.softness > 0.7) return { title: "THE WHISPER", desc: "Quiet power. You listen to hear the breath between words." };
      return { title: "SHAPESHIFTER", desc: "Too complex for one box. You flow between vibes." };
    }

    // --- CANVAS POSTER GENERATOR ---
    function generatePoster() {
      const ctx = el('share-canvas').getContext('2d');
      const w = 1080;
      const h = 1920;
      
      // bg
      ctx.fillStyle = '#050505';
      ctx.fillRect(0,0,w,h);
      
      // Text
      const arch = getArchetype();
      ctx.font = '400 220px "Bebas Neue"'; 
      ctx.fillStyle = 'white';
      ctx.textAlign = 'center';
      ctx.fillText(arch.title, w/2, 400);
      
      ctx.font = 'bold 50px Inter';
      ctx.fillStyle = '#CCFF00';
      ctx.fillText("AUDIO IDENTITY SYSTEM // V3.2", w/2, 500);

      // Draw Bars
      const sorted = Object.keys(state.params).sort((a,b) => state.params[b] - state.params[a]).slice(0, 5);
      
      let y = 800;
      sorted.forEach(k => {
         const val = state.params[k];
         const barW = 800 * val;
         
         ctx.fillStyle = '#333';
         ctx.fillRect(140, y, 800, 40); // track
         
         ctx.fillStyle = '#fff';
         ctx.fillRect(140, y, barW, 40); // fill

         ctx.textAlign = 'left';
         ctx.font = 'bold 40px "Space Mono"';
         ctx.fillStyle = '#fff';
         ctx.fillText(k.toUpperCase(), 140, y - 20);
         
         ctx.textAlign = 'right';
         ctx.fillText(Math.round(val*100) + "%", 940, y - 20);

         y += 150;
      });

      // Footer
      ctx.fillStyle = '#333';
      ctx.font = '40px Inter';
      ctx.textAlign = 'center';
      ctx.fillText("THE VIBE LAB 2025", w/2, 1800);

      const link = document.createElement('a');
      link.download = `vibelab-${arch.title}.png`;
      link.href = el('share-canvas').toDataURL();
      link.click();
    }

    // --- EVENTS ---
    el('btn-start').addEventListener('click', init);
    el('btn-a').addEventListener('click', () => handleChoice('a'));
    el('btn-b').addEventListener('click', () => handleChoice('b'));
    el('btn-exit').addEventListener('click', () => showScreen('screen-landing'));
    el('btn-again').addEventListener('click', init);
    el('btn-share').addEventListener('click', generatePoster);

  </script>
</body>
</html>