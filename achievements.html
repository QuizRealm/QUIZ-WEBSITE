<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizRealm â€¢ Trophy Room</title>
    <meta name="theme-color" content="#0A0F1E">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" type="image/png" sizes="192x192" href="assets/favicon-192.png">
    <script src="game-engine.js"></script>
    <script type="module" src="firebase-config.js"></script>
    <script src="components.js" defer></script>
<script type="module" src="assets/ux-core.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'], mono: ['Share Tech Mono', 'monospace'] },
                    colors: { bgDark: '#020617', accentCyan: '#06b6d4', accentGold: '#eab308', accentPurple: '#a855f7' }
                }
            }
        }
    </script>

    <style>
        body { background-color: #020617; color: #e2e8f0; min-height: 100vh; overflow-x: hidden; background-image: radial-gradient(circle at 50% 0%, #1e1b4b, #020617 70%); }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        /* Rarity Styles */
        .border-common { border-left: 3px solid #94a3b8; }
        .border-rare { border-left: 3px solid #3b82f6; }
        .border-epic { border-left: 3px solid #a855f7; }
        .border-legendary { border-left: 3px solid #eab308; box-shadow: 0 0 15px rgba(234, 179, 8, 0.1); }

        .card-locked { filter: grayscale(1) opacity(0.4); transition: all 0.3s; }
        .card-locked:hover { opacity: 0.6; }
        .card-unlocked { background: linear-gradient(90deg, rgba(255,255,255,0.03), transparent); }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-item { animation: fadeUp 0.3s ease-out forwards; opacity: 0; }
    </style>
</head>
<body class="flex flex-col antialiased">

    <quiz-header></quiz-header>

    <div class="border-b border-white/5 bg-[#020617]/95 backdrop-blur sticky top-[60px] z-40 py-4 shadow-xl">
        <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-accentGold/10 flex items-center justify-center text-accentGold border border-accentGold/20 shadow-[0_0_15px_rgba(234,179,8,0.2)]">
                    <i class="fas fa-trophy text-xl"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-white uppercase tracking-wider">Hall of Achievements</h1>
                    <p class="text-xs text-slate-500">Global Ranking: <span class="text-accentCyan font-bold">Top 12%</span></p>
                </div>
            </div>
            
            <div class="flex items-center gap-8 w-full md:w-auto">
                <div class="flex-grow md:flex-grow-0">
                    <div class="flex justify-between text-[10px] text-slate-400 uppercase tracking-wider mb-1">
                        <span>Completion</span>
                        <span class="text-white font-bold" id="percentDisplay">0%</span>
                    </div>
                    <div class="w-full md:w-64 h-2 bg-slate-800 rounded-full overflow-hidden">
                        <div id="progressLine" class="h-full bg-gradient-to-r from-accentCyan to-accentPurple w-0 transition-all duration-1000"></div>
                    </div>
                </div>
                <div class="text-right hidden md:block">
                    <div class="text-2xl font-mono font-bold text-white leading-none">
                        <span id="unlockedDisplay">0</span><span class="text-slate-600 text-lg">/</span><span id="totalDisplay" class="text-slate-500 text-lg">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="flex-grow p-6 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-8">

        <aside class="lg:col-span-3">
            <div class="sticky top-40 space-y-6">
                <div class="glass-panel rounded-xl p-2">
                    <div class="px-3 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-white/5 mb-2">Categories</div>
                    <nav class="space-y-1" id="filterNav">
                        </nav>
                </div>

                <div id="spotlightCard" class="hidden glass-panel rounded-xl p-6 border border-accentPurple/30 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-br from-accentPurple/10 to-transparent"></div>
                    <h3 class="relative z-10 text-[10px] font-bold text-accentPurple uppercase tracking-widest mb-2"><i class="fas fa-gem mr-1"></i> Crown Jewel</h3>
                    <div class="relative z-10">
                        <div class="text-white font-bold text-xl leading-tight" id="spotlightTitle">--</div>
                        <div class="text-slate-400 text-xs mt-2 leading-relaxed" id="spotlightDesc">--</div>
                        <div class="mt-3 inline-block px-2 py-1 rounded bg-accentPurple/20 text-accentPurple text-[10px] font-bold uppercase border border-accentPurple/30">Legendary</div>
                    </div>
                    <i class="fas fa-medal absolute -bottom-4 -right-4 text-8xl text-accentPurple/10 group-hover:scale-110 transition"></i>
                </div>
            </div>
        </aside>

        <div class="lg:col-span-9">
            <div id="achGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
            
            <div id="emptyState" class="hidden py-20 text-center border border-dashed border-white/10 rounded-2xl">
                <div class="inline-block p-4 rounded-full bg-slate-800 text-slate-600 mb-4"><i class="fas fa-lock text-2xl"></i></div>
                <p class="text-slate-500">No achievements unlocked in this category yet.</p>
            </div>
        </div>

    </main>

    <quiz-footer></quiz-footer>

    <script>
        // 1. THE MASSIVE DATABASE
        const ACHIEVEMENTS = [
            // --- GENERAL (Starter) ---
            { id: "new_recruit", title: "New Recruit", desc: "Complete your first quiz session.", rarity: "common", group: "general" },
            { id: "rookie_runner", title: "Rookie Runner", desc: "Play 5 quizzes total.", rarity: "common", group: "general" },
            { id: "quiz_addict", title: "Quiz Addict", desc: "Complete 50 quizzes.", rarity: "epic", group: "general" },
            { id: "the_veteran", title: "The Veteran", desc: "Reach Level 25.", rarity: "legendary", group: "general" },
            
            // --- SCORE & ACCURACY ---
            { id: "perfect_score", title: "Flawless Victory", desc: "Get 100% score on any quiz.", rarity: "rare", group: "mastery" },
            { id: "sharpshooter", title: "Sharpshooter", desc: "Answer 10 questions correctly in a row.", rarity: "rare", group: "mastery" },
            { id: "laser_focus", title: "Laser Focus", desc: "Maintain 90% accuracy over 100 questions.", rarity: "epic", group: "mastery" },
            { id: "point_millionaire", title: "Score Millionaire", desc: "Earn 1,000,000 total XP.", rarity: "legendary", group: "mastery" },

            // --- STREAKS ---
            { id: "streak_3", title: "Warming Up", desc: "3-Day Login Streak.", rarity: "common", group: "streaks" },
            { id: "streak_7", title: "Dedicated Agent", desc: "7-Day Login Streak.", rarity: "rare", group: "streaks" },
            { id: "streak_30", title: "Iron Will", desc: "30-Day Login Streak.", rarity: "epic", group: "streaks" },
            { id: "streak_100", title: "Century Club", desc: "100-Day Login Streak.", rarity: "legendary", group: "streaks" },

            // --- SPEED ---
            { id: "quick_thinker", title: "Quick Thinker", desc: "Answer in under 5 seconds.", rarity: "common", group: "speed" },
            { id: "speed_demon", title: "Speed Demon", desc: "Finish a quiz in under 60 seconds.", rarity: "rare", group: "speed" },
            { id: "lightning_reflexes", title: "Lightning Reflexes", desc: "Answer 5 questions in under 2 seconds each.", rarity: "epic", group: "speed" },

            // --- MOVIES ---
            { id: "superman_legacy", title: "Kryptonian Historian", desc: "Ace the Superman Legacy quiz.", rarity: "rare", group: "movies" },
            { id: "gotham_knight", title: "Dark Knight", desc: "Get 100% on Impossible Batman.", rarity: "epic", group: "movies" },
            { id: "cinephile", title: "Cinephile", desc: "Complete 20 Movie quizzes.", rarity: "rare", group: "movies" },
            { id: "marvel_fan", title: "Avenger", desc: "Answer 50 Marvel questions correctly.", rarity: "rare", group: "movies" },
            { id: "dc_fan", title: "Justice Leaguer", desc: "Answer 50 DC questions correctly.", rarity: "rare", group: "movies" },

            // --- SCIENCE & TECH ---
            { id: "lab_coat", title: "Lab Coat", desc: "Complete a Chemistry quiz.", rarity: "common", group: "science" },
            { id: "silicon_mind", title: "Silicon Mind", desc: "Ace a Technology quiz.", rarity: "rare", group: "science" },
            { id: "astrophysicist", title: "Star Gazer", desc: "Get 100% on a Space quiz.", rarity: "epic", group: "science" },

            // --- HISTORY & GEO ---
            { id: "time_traveler", title: "Time Traveler", desc: "Complete 10 History quizzes.", rarity: "rare", group: "history" },
            { id: "world_traveler", title: "Globetrotter", desc: "Identify 50 countries correctly.", rarity: "epic", group: "history" },
            
            // --- META / HIDDEN ---
            { id: "night_owl", title: "Night Owl", desc: "Play a quiz after 2 AM.", rarity: "rare", group: "secret" },
            { id: "early_bird", title: "Early Bird", desc: "Play a quiz before 6 AM.", rarity: "rare", group: "secret" },
            { id: "rage_quit", title: "Rage Quitter", desc: "Abandon a quiz halfway through.", rarity: "common", group: "secret" },
            { id: "secret_404", title: "Lost in the Realm", desc: "Find a broken link or 404 page.", rarity: "legendary", group: "secret" }
        ];

        // 2. STATE MANAGEMENT
        let userBadges = [];

        // 3. INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            connectEngine();
        });

        function connectEngine() {
            const check = setInterval(() => {
                if(window.GameEngine && window.GameEngine.state) {
                    clearInterval(check);
                    userBadges = window.GameEngine.state.badges || [];
                    initUI();
                }
            }, 200);
            
            // Fallback for visual testing if engine is offline
            setTimeout(() => {
                if(userBadges.length === 0) {
                    try {
                        const local = JSON.parse(localStorage.getItem('QR_PROFILE'));
                        if(local && local.badges) userBadges = local.badges;
                    } catch(e) {}
                    initUI();
                }
            }, 1000);
        }

        function initUI() {
            renderStats();
            renderFilters();
            renderGrid('all');
            renderSpotlight();
        }

        // 4. RENDERING LOGIC
        function renderStats() {
            const total = ACHIEVEMENTS.length;
            const unlocked = userBadges.length;
            const pct = Math.round((unlocked/total)*100);

            document.getElementById('unlockedDisplay').innerText = unlocked;
            document.getElementById('totalDisplay').innerText = total;
            document.getElementById('percentDisplay').innerText = pct + '%';
            document.getElementById('progressLine').style.width = pct + '%';
        }

        function renderFilters() {
            const groups = ['all', ...new Set(ACHIEVEMENTS.map(a => a.group))];
            const nav = document.getElementById('filterNav');
            
            nav.innerHTML = groups.map(g => {
                const label = g.charAt(0).toUpperCase() + g.slice(1);
                const icon = getIcon(g);
                const count = g === 'all' ? ACHIEVEMENTS.length : ACHIEVEMENTS.filter(a => a.group === g).length;
                return `
                    <button onclick="renderGrid('${g}')" class="w-full text-left px-3 py-2 rounded-lg text-sm text-slate-400 hover:text-white hover:bg-white/5 transition flex items-center justify-between group focus:bg-white/10 focus:text-accentCyan">
                        <div class="flex items-center gap-3">
                            <i class="fas ${icon} w-4 text-center opacity-70"></i>
                            <span>${label}</span>
                        </div>
                        <span class="text-[10px] bg-black/40 px-2 rounded-full text-slate-500">${count}</span>
                    </button>
                `;
            }).join('');
        }

        window.renderGrid = function(filter) {
            const grid = document.getElementById('achGrid');
            grid.innerHTML = '';
            
            const filtered = ACHIEVEMENTS.filter(a => filter === 'all' || a.group === filter);
            
            if(filtered.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            }
            document.getElementById('emptyState').classList.add('hidden');

            filtered.forEach((ach, i) => {
                const isUnlocked = userBadges.includes(ach.id);
                const borderClass = `border-${ach.rarity}`;
                const delay = i * 30; // Staggered animation

                const html = `
                <div class="glass-panel rounded-xl p-5 flex gap-4 items-start fade-item ${borderClass} ${isUnlocked ? 'card-unlocked' : 'card-locked'}" 
                     style="animation-delay: ${delay}ms">
                    
                    <div class="w-12 h-12 rounded-lg bg-black/40 border border-white/5 flex items-center justify-center flex-shrink-0 text-xl shadow-inner">
                        <i class="fas ${getIcon(ach.group)} ${isUnlocked ? getRarityColor(ach.rarity) : 'text-slate-600'}"></i>
                    </div>

                    <div class="flex-grow min-w-0">
                        <div class="flex justify-between items-start mb-1">
                            <h4 class="font-bold text-sm text-white truncate pr-2">${ach.title}</h4>
                            ${isUnlocked 
                                ? `<i class="fas fa-check-circle text-green-500 text-xs shadow-green-500/50 drop-shadow-md"></i>` 
                                : `<i class="fas fa-lock text-slate-700 text-xs"></i>`}
                        </div>
                        <p class="text-xs text-slate-400 leading-relaxed mb-3 line-clamp-2">${ach.desc}</p>
                        
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] uppercase font-bold tracking-wider px-1.5 py-0.5 rounded border border-white/10 ${getRarityColor(ach.rarity)} bg-white/5">
                                ${ach.rarity}
                            </span>
                            ${isUnlocked ? '<span class="text-[9px] text-slate-500">Unlocked</span>' : ''}
                        </div>
                    </div>
                </div>`;
                grid.innerHTML += html;
            });
        }

        function renderSpotlight() {
            // Find the best unlocked achievement
            const unlockedObjs = ACHIEVEMENTS.filter(a => userBadges.includes(a.id));
            if(unlockedObjs.length === 0) return;

            const value = { legendary: 4, epic: 3, rare: 2, common: 1 };
            unlockedObjs.sort((a,b) => value[b.rarity] - value[a.rarity]);

            const best = unlockedObjs[0];
            const card = document.getElementById('spotlightCard');
            
            document.getElementById('spotlightTitle').innerText = best.title;
            document.getElementById('spotlightDesc').innerText = best.desc;
            card.classList.remove('hidden');
        }

        // --- HELPERS ---
        function getRarityColor(r) {
            return {
                common: 'text-slate-400',
                rare: 'text-blue-400',
                epic: 'text-purple-400',
                legendary: 'text-yellow-400'
            }[r] || 'text-white';
        }

        function getIcon(g) {
            const icons = {
                general: 'fa-gamepad',
                mastery: 'fa-crosshairs',
                streaks: 'fa-fire',
                speed: 'fa-bolt',
                movies: 'fa-film',
                science: 'fa-flask',
                history: 'fa-landmark',
                secret: 'fa-user-secret'
            };
            return icons[g] || 'fa-star';
        }

    </script>
</body>
</html>