<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Blowers | Memory Restoration</title>

    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-ML3F7KLZ');</script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="module" src="firebase-config.js"></script>
  <script type="module" src="game-engine.js"></script> <script src="components.js" defer></script>
<script type="module" src="assets/ux-core.js"></script> 
<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        tech: ['Rajdhani', 'sans-serif'], 
                        display: ['Orbitron', 'sans-serif'],
                        code: ['Share Tech Mono', 'monospace']
                    },
                    colors: { 
                        cyan: '#00f3ff',
                        purple: '#bc13fe',
                        danger: '#ff004c',
                        void: '#050508',
                        glass: 'rgba(10, 15, 30, 0.9)'
                    },
                    animation: {
                        'scan': 'scan 4s linear infinite',
                        'pulse-glow': 'pulseGlow 2s infinite'
                    },
                    keyframes: {
                        scan: { '0%': { backgroundPosition: '0% 0%' }, '100%': { backgroundPosition: '0% 100%' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px #00f3ff' }, '50%': { boxShadow: '0 0 25px #00f3ff, 0 0 10px #bc13fe' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background: #050508; color: white; overflow-x: hidden; }
        
        .bg-grid {
            position: fixed; inset: 0; z-index: -1;
            background-image: linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(circle at center, black 40%, transparent 90%);
        }

        /* Glass Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        .glass-card:hover {
            border-color: #00f3ff;
            background: rgba(0, 243, 255, 0.05);
            transform: translateY(-5px);
        }

        /* Start Button */
        .btn-start {
            background: linear-gradient(45deg, #00f3ff, #0088ff);
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }
        .btn-start:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 30px #00f3ff;
            transform: scale(1.02);
        }

        /* Game Layout Fixes */
        .monitor-frame {
            border: 1px solid rgba(0, 243, 255, 0.3);
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            background: #000;
        }
        .scanlines {
             background: linear-gradient(to bottom, rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 51%);
             background-size: 100% 4px;
             pointer-events: none;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen font-tech selection:bg-cyan selection:text-black">

    <div class="bg-grid"></div>
    <quiz-header></quiz-header>

    <main class="flex-grow flex items-center justify-center p-4 md:p-8 relative z-10">
        
        <div class="w-full max-w-[1400px] h-[85vh] relative flex flex-col">
            
            <div id="start-screen" class="absolute inset-0 z-50 flex flex-col justify-center items-center bg-void/90 backdrop-blur-xl">
                
                <div class="w-full max-w-5xl">
                    <div class="text-center mb-10">
                        <div class="inline-block px-3 py-1 border border-danger/50 rounded text-danger text-xs font-code uppercase tracking-[0.3em] mb-4 animate-pulse">
                            Warning: Cognitive Hazard
                        </div>
                        <h1 class="font-display text-5xl md:text-7xl text-white tracking-tighter mb-2 text-shadow-cyan">
                            MIND BLOWERS
                        </h1>
                        <p class="text-cyan font-code text-sm tracking-widest">MEMORY RESTORATION PROTOCOL v9.2</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                        
                        <div class="glass-card p-6 rounded-xl relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-2 text-cyan/20 text-4xl"><i class="fas fa-microchip"></i></div>
                            <h3 class="font-display text-xl text-white mb-2">The Mission</h3>
                            <p class="text-slate-400 text-sm leading-relaxed">
                                You are trapped in the "Morty's Mind Blowers" archive. To reconstruct your psyche, you must correctly identify 30 corrupted memory files.
                            </p>
                        </div>

                        <div class="glass-card p-6 rounded-xl relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-2 text-purple/20 text-4xl"><i class="fas fa-eye"></i></div>
                            <h3 class="font-display text-xl text-white mb-2">The Content</h3>
                            <p class="text-slate-400 text-sm leading-relaxed">
                                Includes deep cuts from Seasons 1-7. Only a true "C-137" variant can achieve 100%. Are you a Rick, or just another Jerry?
                            </p>
                        </div>

                        <div class="glass-card p-6 rounded-xl relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-2 text-danger/20 text-4xl"><i class="fas fa-exclamation-triangle"></i></div>
                            <h3 class="font-display text-xl text-white mb-2">The Protocol</h3>
                            <ul class="text-slate-400 text-sm space-y-2 font-code">
                                <li class="flex items-center gap-2"><span class="text-cyan">></span> 12 Seconds per file</li>
                                <li class="flex items-center gap-2"><span class="text-cyan">></span> Single attempt only</li>
                                <li class="flex items-center gap-2"><span class="text-cyan">></span> Result is permanent</li>
                            </ul>
                        </div>
                    </div>

                    <div class="text-center">
                        <button onclick="window.startGame()" class="btn-start px-16 py-6 text-black font-display font-black text-2xl tracking-widest hover:scale-105 transform duration-200">
                            INITIALIZE SYSTEM
                        </button>
                        <div class="mt-4 text-slate-500 text-[10px] font-code">BY CLICKING, YOU WAIVE ALL RIGHTS TO YOUR SANITY</div>
                    </div>
                </div>
            </div>

            <div id="game-ui" class="flex-grow flex flex-col opacity-0 pointer-events-none transition-all duration-500 transform scale-95 h-full">
                
                <div class="flex justify-between items-center mb-4 px-2">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-cyan/10 border border-cyan flex items-center justify-center text-cyan">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div>
                            <div class="font-display text-xl text-white leading-none">ARCHIVE ACCESS</div>
                            <div class="font-code text-[10px] text-cyan">SECURE CHANNEL OPEN</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-code text-slate-500 text-[10px]">FILE PROGRESS</div>
                        <div class="font-display text-2xl text-white"><span id="q-current" class="text-cyan">01</span>/30</div>
                    </div>
                </div>

                <div class="monitor-frame relative w-full h-[40vh] md:h-[45vh] lg:h-[50vh] rounded-lg overflow-hidden shrink-0 group">
                    <div class="scanlines absolute inset-0 z-20 opacity-30"></div>
                    <img id="q-image" src="" class="w-full h-full object-contain bg-black transition-transform duration-700 group-hover:scale-105">
                    
                    <div class="absolute top-2 left-2 z-30">
                        <span class="bg-black/80 backdrop-blur text-cyan font-code text-[10px] px-2 py-1 rounded border border-cyan/30">
                            IMG_REF_<span id="q-ref">001</span>
                        </span>
                    </div>

                    <div class="absolute bottom-0 left-0 w-full h-1 bg-white/10 z-30">
                        <div id="timer-bar" class="h-full bg-cyan shadow-[0_0_10px_#00f3ff]"></div>
                    </div>
                </div>

                <div class="flex-grow flex flex-col justify-center py-4 md:py-6">
                    <h3 id="q-text" class="text-xl md:text-3xl text-white font-bold text-center mb-6 px-4 leading-tight">
                        Loading...
                    </h3>
                    
                    <div id="options-container" class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 px-2">
                        </div>
                </div>

            </div>

            <div id="end-modal" class="hidden absolute inset-0 z-[60] flex items-center justify-center bg-black/95 backdrop-blur-xl">
                <div class="w-full max-w-2xl bg-void border border-white/10 rounded-2xl overflow-hidden shadow-2xl relative">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan to-transparent"></div>
                    
                    <div class="p-8 md:p-12 text-center">
                        <div class="inline-block px-4 py-1 rounded-full bg-cyan/10 text-cyan text-xs font-code uppercase tracking-widest mb-6">
                            Protocol Complete
                        </div>

                        <div class="mb-6 relative inline-block">
                            <div class="absolute inset-0 bg-cyan blur-[40px] opacity-20"></div>
                            <div id="final-rank" class="font-display text-8xl text-cyan relative z-10 drop-shadow-[0_0_10px_rgba(0,243,255,0.8)]">
                                A
                            </div>
                        </div>

                        <h2 id="final-title" class="font-display text-2xl text-white uppercase tracking-widest mb-2">C-137 Associate</h2>
                        <div class="flex justify-center gap-4 text-sm font-code text-slate-400 mb-8">
                            <span>SCORE: <span id="final-score" class="text-white">25</span>/30</span>
                            <span>|</span>
                            <span>STATUS: <span class="text-white">ARCHIVED</span></span>
                        </div>

                        <p id="final-msg" class="text-slate-300 italic mb-8 border-t border-white/5 pt-6">
                            "Not bad. Not Rick levels, but not Jerry levels either."
                        </p>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex flex-col gap-3">
                                <a href="/rickandmortyhub.html" class="w-full py-3 border border-white/10 rounded hover:bg-white/5 text-slate-300 hover:text-white transition uppercase text-xs tracking-widest">
                                    <i class="fas fa-arrow-left mr-2"></i> Return to Hub
                                </a>
                                <button onclick="location.reload()" class="w-full py-3 border border-white/10 rounded hover:bg-white/5 text-slate-300 hover:text-white transition uppercase text-xs tracking-widest">
                                    <i class="fas fa-redo mr-2"></i> Re-Calibrate
                                </button>
                            </div>
                            
                            <button onclick="shareResult()" class="w-full py-3 bg-cyan text-black font-bold rounded flex flex-col items-center justify-center gap-1 hover:bg-white transition group">
                                <span class="uppercase text-xs tracking-widest"><i class="fas fa-share-alt mr-2"></i> Share Result</span>
                                <span class="text-[10px] opacity-60 font-code group-hover:opacity-100">Click to Copy</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script type="module">
        // 1. DATA
        const memories = [
            { img: '/assets/mb_01.png', q: "The Truth Tortoise is omniscient. What happens if you look into its eyes?", a: ["You know everything", "You die", "You become a tortoise"], correct: 0 },
            { img: '/assets/mb_02.png', q: "After experiencing 'True Level', how does Morty feel about reality?", a: ["Everything is crooked", "He feels ecstatic", "He vomits"], correct: 0 },
            { img: '/assets/mb_03.png', q: "Rick discovers that Squirrels are actually:", a: ["Running the world", "Aliens", "Robots"], correct: 0 },
            { img: '/assets/mb_04.png', q: "Why did Morty want the memory of Mr. Poopybutthole's proposal deleted?", a: ["He rejected it (embarrassing)", "He said yes", "Rick ruined it"], correct: 0 },
            { img: '/assets/mb_05.png', q: "Why did Rick slice open the adorable Beebo creature?", a: ["For warmth", "For food", "For science"], correct: 0 },
            { img: '/assets/mb_06.png', q: "Morty flipped the wrong switch in the garage. What did it actually do?", a: ["Life support for a planet", "Turned off the sun", "Garage opener"], correct: 0 },
            { img: '/assets/mb_07.png', q: "Rick and Morty appear naked in a zoo. Who captured them?", a: ["The Collector", "The Federation", "Unity"], correct: 0 },
            { img: '/assets/mb_08.png', q: "Morty accidentally killed Zikzak, the king of the:", a: ["Floop Floopians", "Gromflomites", "Plutonians"], correct: 0 },
            { img: '/assets/mb_09.png', q: "The 'man on the moon' looked like a smudge. What was it really?", a: ["A smudge on the lens", "A nazi", "A crater"], correct: 0 },
            { img: '/assets/mb_10.png', q: "In the Gotron memory, what is Rick obsessively collecting?", a: ["Anime Mechas", "Power Rangers", "Bugs"], correct: 0 },
            { img: '/assets/mb_11.png', q: "Jerry finds a Talking Cat. What did the cat do in its past?", a: ["We don't ask", "Started a war", "Ate a baby"], correct: 0 },
            { img: '/assets/mb_12.png', q: "Rick faked their deaths in a 'Vat of Acid' to prove:", a: ["His idea was good", "Morty is dumb", "Acid is safe"], correct: 0 },
            { img: '/assets/mb_13.png', q: "What is the only genre of music snakes listen to?", a: ["Snake Jazz", "Hiss Hop", "Rattle & Roll"], correct: 0 },
            { img: '/assets/mb_14.png', q: "Heistotron was built to stop heists. What was its flaw?", a: ["It heisted too much", "It exploded", "It fell in love"], correct: 0 },
            { img: '/assets/mb_15.png', q: "Which reality did Rick and Morty abandon due to Cronenbergs?", a: ["Dimension C-137", "Dimension 35-C", "The Blender Dimension"], correct: 0 },
            { img: '/assets/mb_16.png', q: "Why did Rick turn himself into a Pickle?", a: ["To avoid family therapy", "To prove he could", "By accident"], correct: 0 },
            { img: '/assets/mb_17.png', q: "What is the sole purpose of the Butter Robot?", a: ["To pass butter", "To fight", "To love"], correct: 0 },
            { img: '/assets/mb_18.png', q: "For a Mr. Meeseeks, existence is:", a: ["Pain", "Bliss", "Short"], correct: 0 },
            { img: '/assets/mb_19.png', q: "What does the gaseous entity 'Fart' want to do?", a: ["Eliminate carbon life", "Sing songs", "Go home"], correct: 0 },
            { img: '/assets/mb_20.png', q: "Unity is a hive mind that once dated:", a: ["Rick", "Birdperson", "Squanchy"], correct: 0 },
            { img: '/assets/mb_21.png', q: "Who killed Birdperson at his wedding?", a: ["Tammy", "Rick", "The Federation"], correct: 0 },
            { img: '/assets/mb_22.png', q: "What distinguishes Evil Morty physically?", a: ["An eye patch", "A scar", "Blue shirt"], correct: 0 },
            { img: '/assets/mb_23.png', q: "Simple Rick's wafers are flavored with:", a: ["Simple happiness", "Tears", "Strawberries"], correct: 0 },
            { img: '/assets/mb_24.png', q: "Rick's car battery contains:", a: ["A Microverse", "Acid", "Hamsters"], correct: 0 },
            { img: '/assets/mb_25.png', q: "In the game 'Roy', where does he work?", a: ["The Carpet Store", "The Arcade", "Football Star"], correct: 0 },
            { img: '/assets/mb_26.png', q: "In making a Plumbus, what is smoothed out?", a: ["The Dinglebop", "The Schleem", "The Grumbo"], correct: 0 },
            { img: '/assets/mb_27.png', q: "Where does the Council of Ricks convene?", a: ["The Citadel", "Earth C-137", "Space Beth's ship"], correct: 0 },
            { img: '/assets/mb_28.png', q: "To save Earth from the Cromulons, they must:", a: ["Get Schwifty", "Fight", "Solve math"], correct: 0 },
            { img: '/assets/mb_29.png', q: "Interdimensional Cable TV is entirely:", a: ["Improvised", "Scripted", "AI Generated"], correct: 0 },
            { img: '/assets/mb_30.png', q: "At Jerryboree, do they allow you to leave without your ticket?", a: ["No", "Yes", "Only if you're Rick"], correct: 0 }
        ];

        // 2. STATE
        let currentIdx = 0;
        let score = 0;
        let timerInterval;
        let isLocked = false;

        // 3. GLOBAL FUNCTIONS
        window.startGame = function() {
            const startScreen = document.getElementById('start-screen');
            const gameUI = document.getElementById('game-ui');
            
            startScreen.style.transform = 'scale(1.1)';
            startScreen.style.opacity = '0';
            
            setTimeout(() => {
                startScreen.classList.add('hidden');
                gameUI.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                gameUI.classList.add('scale-100');
                loadQuestion();
            }, 500);
        };

        window.selectAnswer = function(selectedIndex, btnElement) {
            if (isLocked) return;
            isLocked = true;
            clearInterval(timerInterval);

            const data = memories[currentIdx];
            const isCorrect = selectedIndex === data.correct;

            if (isCorrect) {
                score++;
                btnElement.classList.remove('bg-white/5', 'hover:bg-cyan/10');
                btnElement.classList.add('bg-cyan/20', 'border-cyan');
                btnElement.innerHTML += '<i class="fas fa-check float-right text-cyan mt-1"></i>';
            } else {
                btnElement.classList.remove('bg-white/5', 'hover:bg-cyan/10');
                btnElement.classList.add('bg-danger/20', 'border-danger');
                btnElement.innerHTML += '<i class="fas fa-times float-right text-danger mt-1"></i>';
            }

            setTimeout(() => {
                currentIdx++;
                loadQuestion();
            }, 1000);
        };

        window.shareResult = function() {
            const title = document.getElementById('final-title').innerText;
            const scoreText = document.getElementById('final-score').innerText;
            const text = `I scored ${scoreText}/30 in Mind Blowers: Memory Protocol.\nRank: ${title}\nCan you do better? #RickAndMorty`;
            
            navigator.clipboard.writeText(text).then(() => {
                alert("Result copied to clipboard!");
            });
        };

        // 4. INTERNAL LOGIC
        function loadQuestion() {
            if (currentIdx >= memories.length) {
                endGame();
                return;
            }

            isLocked = false;
            const data = memories[currentIdx];
            
            // Text Update
            document.getElementById('q-current').innerText = (currentIdx + 1).toString().padStart(2, '0');
            document.getElementById('q-ref').innerText = (currentIdx + 1).toString().padStart(3, '0');
            document.getElementById('q-text').innerText = data.q;
            
            // Image Update
            document.getElementById('q-image').src = data.img;

            // Buttons
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            const indices = [0, 1, 2].sort(() => Math.random() - 0.5);
            indices.forEach(i => {
                const btn = document.createElement('button');
                btn.className = 'w-full p-4 rounded-lg bg-white/5 border border-white/10 hover:border-cyan hover:bg-cyan/10 transition text-left font-tech text-slate-200 text-lg group';
                btn.innerHTML = data.a[i];
                btn.onclick = function() { window.selectAnswer(i, this) };
                container.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            const bar = document.getElementById('timer-bar');
            let timeLeft = 120; // 12 seconds
            
            bar.style.width = '100%';
            bar.style.backgroundColor = '#00f3ff';
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 1;
                bar.style.width = `${(timeLeft/120)*100}%`;
                
                if(timeLeft < 40) bar.style.backgroundColor = '#ff004c';
                
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    if(!isLocked) {
                        isLocked = true;
                        // Auto-fail visual
                        document.querySelectorAll('#options-container button').forEach(b => b.classList.add('opacity-50'));
                        setTimeout(() => {
                            currentIdx++;
                            loadQuestion();
                        }, 800);
                    }
                }
            }, 100);
        }

        async function endGame() {
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('end-modal').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            
            let rank = "F";
            let title = "Jerry";
            let msg = "You barely remembered your own name.";
            let color = "text-danger";

            if (score === 30) { rank = "S+"; title = "The Rickest Rick"; msg = "100% Omni-Knowledge. Don't look at the tortoise."; color = "text-cyan"; }
            else if (score >= 25) { rank = "A"; title = "C-137 Associate"; msg = "Impressive. You remembered the important stuff."; color = "text-green-400"; }
            else if (score >= 20) { rank = "B"; title = "Evil Morty"; msg = "Smart, but you missed a few details."; color = "text-yellow-400"; }
            else if (score >= 10) { rank = "C"; title = "Summer"; msg = "Too busy on your phone?"; color = "text-purple"; }

            const rankEl = document.getElementById('final-rank');
            rankEl.innerText = rank;
            rankEl.className = `font-display text-8xl relative z-10 drop-shadow-[0_0_10px_currentColor] ${color}`;
            
            document.getElementById('final-title').innerText = title;
            document.getElementById('final-msg').innerText = `"${msg}"`;

            // Firebase Save
            if (window.auth && window.auth.currentUser && window.db) {
                try {
                    const uid = window.auth.currentUser.uid;
                    const timestampId = new Date().getTime().toString();
                    const resultRef = window.doc(window.db, "users", uid, "gameResults", timestampId);
                    await window.setDoc(resultRef, {
                        game: 'Mind Blowers',
                        score: score,
                        rank: title,
                        total: 30,
                        timestamp: new Date().toISOString()
                    });
                } catch (e) { console.error("Save failed", e); }
            }
        }
    </script>
</body>
</html>