<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cronenberg Match | Genetic Compatibility</title>

  <!-- GTM -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-ML3F7KLZ');</script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nosifer&family=Share+Tech+Mono&family=Creepster&family=Outfit:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script type="module" src="firebase-config.js"></script>
  <script type="module" src="game-engine.js"></script> <script src="components.js" defer></script>
<script type="module" src="assets/ux-core.js"></script> 

  <!-- FIREBASE IMPORTS -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, addDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

    // Global assignment for game logic access
    window.initFirebase = async () => {
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.appId = window.__app_id || 'default-app';

        // Auth Flow
        try {
            if (window.__initial_auth_token) {
                await signInWithCustomToken(window.auth, window.__initial_auth_token);
            } else {
                await signInAnonymously(window.auth);
            }
        } catch (error) {
            console.error("Auth Failed:", error);
        }
    };
    window.initFirebase();
  </script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 
            horror: ['Nosifer', 'cursive'], 
            bio: ['Share Tech Mono', 'monospace'],
            clean: ['Outfit', 'sans-serif']
          },
          colors: { 
            fleshRed: '#ff2a2a',
            fleshPink: '#ff9999',
            bioDark: '#1a0505',
            slimeGreen: '#39ff14',
            veinBlue: '#4a00e0'
          },
          animation: {
            'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
            'pulse-fast': 'pulse 0.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'drip': 'drip 3s infinite',
            'float': 'float 6s ease-in-out infinite',
            'wiggle': 'wiggle 1s ease-in-out infinite',
          },
          keyframes: {
            heartbeat: {
              '0%, 100%': { transform: 'scale(1)' },
              '50%': { transform: 'scale(1.15)' },
            },
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' },
            },
            drip: {
              '0%': { transform: 'translateY(-20px)', opacity: 0 },
              '50%': { opacity: 1 },
              '100%': { transform: 'translateY(20px)', opacity: 0 }
            }
          }
        }
      }
    }
  </script>

  <style>
    body { background-color: #1a0505; color: #fff; overflow-x: hidden; }
    
    /* ORGANIC BACKGROUND */
    .flesh-bg {
        position: fixed; inset: 0; z-index: -1;
        background: radial-gradient(circle at 50% 50%, #2d0a0a 0%, #000 90%);
        box-shadow: inset 0 0 100px #000;
        transition: background 0.5s ease;
    }
    .veins {
        position: absolute; inset: 0;
        opacity: 0.4;
        background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ff2a2a' fill-opacity='0.15' fill-rule='evenodd'/%3E%3C/svg%3E");
        animation: pulseBg 4s infinite alternate;
    }

    @keyframes pulseBg {
        0% { transform: scale(1); opacity: 0.3; }
        100% { transform: scale(1.05); opacity: 0.5; }
    }

    /* CARD UI */
    .bio-card {
        background: rgba(40, 10, 10, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 42, 42, 0.3);
        box-shadow: 0 0 50px rgba(0,0,0,0.8);
    }

    /* INTERACTIVE ELEMENTS */
    .choice-blob {
        position: relative; overflow: hidden;
        background: rgba(255, 42, 42, 0.05);
        border: 1px solid rgba(255, 42, 42, 0.2);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .choice-blob:hover {
        background: rgba(255, 42, 42, 0.8);
        color: white;
        transform: scale(1.02);
        box-shadow: 0 0 25px rgba(255, 42, 42, 0.4);
        border-color: #ff2a2a;
    }
    .choice-blob::before {
        content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
        transform: scale(0); transition: transform 0.5s;
    }
    .choice-blob:hover::before { transform: scale(1); }

    /* Custom Scrollbar for inner content */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1a0505; }
    ::-webkit-scrollbar-thumb { background: #4a0505; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #ff2a2a; }
  </style>
</head>

<body class="flex flex-col min-h-screen">
  
  <div class="flesh-bg" id="bg-layer"><div class="veins"></div></div>
  <quiz-header></quiz-header>

  <main class="flex-grow flex items-center justify-center p-4 py-8 relative z-10">
    
    <div class="w-full max-w-5xl bio-card rounded-3xl p-6 md:p-10 relative overflow-hidden flex flex-col md:flex-row gap-6 md:gap-10 min-h-[600px] border-t-4 border-t-fleshRed shadow-[0_0_100px_rgba(255,0,0,0.1)]">
        
        <!-- SIDEBAR (DNA TRACKER) -->
        <div class="hidden md:flex flex-col items-center justify-between w-24 border-r border-fleshRed/20 pr-6 py-4">
            <div class="text-fleshRed text-5xl animate-heartbeat drop-shadow-[0_0_10px_rgba(255,0,0,0.8)]">
                <i class="fas fa-heartbeat"></i>
            </div>
            
            <div class="relative h-[350px] w-3 bg-black/40 rounded-full overflow-hidden border border-fleshRed/20">
                <div id="mutation-bar" class="absolute bottom-0 w-full bg-gradient-to-t from-fleshRed via-fleshRed to-fleshPink transition-all duration-700 ease-out shadow-[0_0_15px_#ff2a2a]" style="height: 0%"></div>
            </div>

            <div class="font-bio text-xs text-fleshPink uppercase tracking-widest text-center leading-relaxed">
                <i class="fas fa-dna mb-1 block"></i>
                Mutation<br>Index
            </div>
        </div>

        <!-- MAIN CONTENT AREA -->
        <div class="flex-grow flex flex-col relative z-20">
            
            <!-- HEADER -->
            <div class="flex justify-between items-start mb-6 md:mb-8 border-b border-fleshRed/10 pb-4">
                <div>
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-fleshRed/10 border border-fleshRed/30 text-fleshRed font-bio text-[10px] md:text-xs uppercase tracking-widest mb-2 animate-pulse">
                        <i class="fas fa-biohazard"></i> Dimension C-137 (Ruined)
                    </div>
                    <h1 class="font-horror text-3xl md:text-5xl text-fleshPink drop-shadow-[0_4px_4px_rgba(0,0,0,1)] leading-none">
                        CRONENBERG <span class="text-fleshRed">MATCH</span>
                    </h1>
                </div>
                <div class="text-right hidden sm:block">
                    <div class="font-bio text-slate-500 text-xs uppercase tracking-widest">Global Mutation</div>
                    <div class="font-bio text-2xl text-fleshRed font-bold">98.7%</div>
                </div>
            </div>

            <!-- START SCREEN -->
            <div id="start-screen" class="absolute inset-0 z-40 flex flex-col items-center justify-center text-center bg-[#1a0505]/95 backdrop-blur-md rounded-xl p-6 transition-all duration-700">
                
                <div class="w-40 h-40 mb-8 relative group">
                    <div class="absolute inset-0 bg-fleshRed rounded-full blur-xl opacity-30 animate-pulse group-hover:opacity-50 transition-opacity"></div>
                    <div class="relative w-full h-full rounded-full border-4 border-fleshRed overflow-hidden shadow-[0_0_30px_#ff2a2a]">
                        <!-- Using a solid placeholder if image fails -->
                        <div class="w-full h-full bg-black flex items-center justify-center text-fleshRed text-6xl">
                           <i class="fas fa-virus"></i>
                        </div>
                    </div>
                </div>

                <h2 class="font-clean text-3xl md:text-5xl font-bold text-white mb-4 tracking-tight">FIND YOUR MONSTER</h2>
                <p class="font-clean text-lg text-fleshPink/80 max-w-md mb-10 leading-relaxed">
                    The world is gone. Society has collapsed into flesh. 
                    <br><span class="text-fleshRed">Answer 10 genetic queries</span> to find your biologically compatible soulmate.
                </p>

                <button onclick="window.injectSerum()" class="group relative px-10 py-5 bg-fleshRed text-black font-bio font-bold text-xl rounded-lg hover:scale-105 transition-all duration-300 shadow-[0_0_40px_rgba(255,42,42,0.4)] overflow-hidden">
                    <span class="relative z-10 flex items-center gap-3">
                        <i class="fas fa-syringe group-hover:rotate-45 transition-transform"></i> INJECT SERUM
                    </span>
                    <div class="absolute inset-0 bg-white/40 transform -translate-x-full skew-x-12 group-hover:translate-x-full transition-transform duration-700 ease-in-out"></div>
                </button>
            </div>

            <!-- GAME UI (Hidden Initially) -->
            <div id="game-ui" class="flex-grow flex flex-col opacity-0 pointer-events-none transition-all duration-700 transform scale-95 h-full">
                
                <div class="flex-grow flex flex-col items-center justify-center text-center mb-8">
                    <div class="text-xs font-bio text-fleshRed/50 uppercase tracking-[0.5em] mb-4 border-b border-fleshRed/20 pb-2">
                        Query Sequence <span id="q-num">01</span>
                    </div>
                    <h2 id="q-text" class="font-clean text-2xl md:text-3xl font-bold text-white leading-tight max-w-2xl min-h-[80px] flex items-center justify-center">
                        Initializing DNA Sequence...
                    </h2>
                </div>

                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-4">
                    <!-- Options injected via JS -->
                </div>

            </div>

        </div>

    </div>

    <!-- RESULTS MODAL -->
    <div id="results-modal" class="hidden fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-4 backdrop-blur-xl transition-opacity duration-500">
        <div class="w-full max-w-lg bio-card p-1 text-center rounded-2xl relative shadow-[0_0_100px_rgba(255,42,42,0.3)]">
            
            <div class="bg-[#0f0202] rounded-xl p-8 border border-white/5 relative overflow-hidden h-full">
                <!-- Noise Overlay -->
                <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: url('data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noiseFilter%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noiseFilter)%22/%3E%3C/svg%3E');"></div>

                <div class="inline-block px-4 py-1 rounded-full bg-fleshRed text-black font-bold text-xs uppercase tracking-widest mb-6 animate-pulse">
                    Compatibility Confirmed
                </div>

                <h2 class="font-horror text-4xl text-fleshPink mb-2 tracking-wide">OFFSPRING PROJECTED</h2>
                <p class="font-bio text-slate-400 text-sm mb-8">Genetic Simulation Complete. Viability High.</p>

                <div class="relative w-48 h-48 mx-auto mb-8 group perspective-1000">
                    <div class="absolute inset-0 bg-fleshRed rounded-full blur-3xl opacity-20 group-hover:opacity-60 transition duration-500 animate-pulse"></div>
                    <div id="result-img-container" class="relative w-full h-full rounded-2xl border-2 border-fleshRed/50 shadow-2xl overflow-hidden transform group-hover:scale-105 transition duration-500 bg-black">
                         <!-- Fallback icon in case image breaks -->
                         <div class="w-full h-full flex items-center justify-center text-6xl text-fleshRed/50">
                            <i class="fas fa-dna"></i>
                         </div>
                         <img id="result-img" src="" class="absolute inset-0 w-full h-full object-cover" onerror="this.style.display='none'">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-8 text-left">
                    <div class="p-4 bg-fleshRed/5 rounded-lg border border-fleshRed/20">
                        <div class="text-[10px] text-fleshRed/70 uppercase mb-1">Partner Species</div>
                        <div id="result-partner" class="font-bold text-white text-lg leading-tight">Mantis-Person</div>
                    </div>
                    <div class="p-4 bg-fleshRed/5 rounded-lg border border-fleshRed/20">
                        <div class="text-[10px] text-fleshRed/70 uppercase mb-1">Survival Odds</div>
                        <div id="result-rate" class="font-bold text-slimeGreen text-lg font-bio">94.82%</div>
                    </div>
                </div>

                <div class="flex flex-col gap-3 relative z-10">
                    <a href="/rickandmortyhub.html" class="w-full py-4 bg-white text-black font-bold rounded-lg hover:bg-fleshRed hover:text-black transition-all uppercase tracking-widest shadow-lg">
                        Return to Hub
                    </a>
                    <button onclick="location.reload()" class="text-xs text-slate-500 hover:text-fleshRed uppercase tracking-widest mt-2 transition-colors">
                        Run New Simulation
                    </button>
                </div>
            </div>

        </div>
    </div>

  </main>
  
  <quiz-footer></quiz-footer>

  <script type="module">
    import { collection, addDoc, doc, setDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

    // 10 GENETIC QUESTIONS
    const questions = [
        { q: "The apocalypse starts. What is your first instinct?", 
          a: [
              { text: "Hide in the basement", type: "passive" }, 
              { text: "Find a shotgun", type: "aggressive" },
              { text: "Accept my new flesh form", type: "mutant" }
          ] 
        },
        { q: "Ideal romantic dinner date?", 
          a: [
              { text: "Candlelight & Canned Beans", type: "passive" }, 
              { text: "Hunting Rats in the sewers", type: "aggressive" },
              { text: "Merging our torsos together", type: "mutant" }
          ] 
        },
        { q: "Your partner has 6 eyes. How do you feel?", 
          a: [
              { text: "Terrified", type: "passive" }, 
              { text: "Tactical advantage", type: "aggressive" },
              { text: "More windows to the soul", type: "mutant" }
          ] 
        },
        { q: "You find a cure. Do you use it?", 
          a: [
              { text: "Yes! Make me human!", type: "passive" }, 
              { text: "Does it give me super strength?", type: "aggressive" },
              { text: "No. I am evolved now.", type: "mutant" }
          ] 
        },
        { q: "Choose a Mutation.", 
          a: [
              { text: "Hard Shell (Defense)", type: "passive" }, 
              { text: "Acid Spit (Attack)", type: "aggressive" },
              { text: "Gelatinous Body (Form)", type: "mutant" }
          ] 
        },
        { q: "How do you solve conflicts?", 
          a: [
              { text: "Crying", type: "passive" }, 
              { text: "Screaming", type: "aggressive" },
              { text: "Absorbing them", type: "mutant" }
          ] 
        },
        { q: "Your leg falls off. What do you do?", 
          a: [
              { text: "Faint", type: "passive" }, 
              { text: "Attach a chainsaw", type: "aggressive" },
              { text: "Grow two new ones", type: "mutant" }
          ] 
        },
        { q: "Pick a habitat.", 
          a: [
              { text: "Abandoned Library", type: "passive" }, 
              { text: "Ruined Skyscraper", type: "aggressive" },
              { text: "Flesh Forest", type: "mutant" }
          ] 
        },
        { q: "What is love?", 
          a: [
              { text: "Safety", type: "passive" }, 
              { text: "Power", type: "aggressive" },
              { text: "Biological Fusion", type: "mutant" }
          ] 
        },
        { q: "Final Question: Are you Rick or Morty?", 
          a: [
              { text: "Morty", type: "passive" }, 
              { text: "Rick", type: "aggressive" },
              { text: "Cronenberg #142", type: "mutant" }
          ] 
        }
    ];

    let currentIdx = 0;
    let scores = { passive: 0, aggressive: 0, mutant: 0 };

    // 1. START
    window.injectSerum = function() {
        const start = document.getElementById('start-screen');
        const ui = document.getElementById('game-ui');
        
        start.style.transform = "scale(1.1)";
        start.style.opacity = "0";
        start.style.pointerEvents = "none";
        
        // Enhance background effect
        document.getElementById('bg-layer').style.background = "radial-gradient(circle at 50% 50%, #4a0505 0%, #000 90%)";

        setTimeout(() => {
            ui.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
            ui.classList.add('scale-100');
            loadQuestion();
        }, 500);
    };

    // 2. LOAD
    function loadQuestion() {
        if (currentIdx >= questions.length) {
            calculateResult();
            return;
        }

        const data = questions[currentIdx];
        const qNumEl = document.getElementById('q-num');
        const qTextEl = document.getElementById('q-text');
        
        // Fade out slightly
        qTextEl.style.opacity = 0;
        
        setTimeout(() => {
            qNumEl.innerText = (currentIdx + 1).toString().padStart(2, '0');
            qTextEl.innerText = data.q;
            qTextEl.style.opacity = 1;
        }, 200);

        // Mutation Bar Animation
        const percent = ((currentIdx) / questions.length) * 100;
        document.getElementById('mutation-bar').style.height = `${percent}%`;

        const grid = document.getElementById('options-grid');
        grid.innerHTML = '';

        data.a.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = "choice-blob w-full p-6 rounded-lg text-left flex items-center justify-between group";
            // Stagger animation
            btn.style.animation = `drip 0.5s ease-out backwards`;
            btn.style.animationDelay = `${idx * 0.1}s`;
            
            btn.innerHTML = `
                <span class="font-clean font-bold text-lg text-slate-200 group-hover:text-white relative z-10">${opt.text}</span>
                <i class="fas fa-dna relative z-10 opacity-30 group-hover:opacity-100 group-hover:text-fleshRed transition-all"></i>
            `;
            btn.onclick = () => handleAnswer(opt.type);
            grid.appendChild(btn);
        });
    }

    // 3. ANSWER
    function handleAnswer(type) {
        scores[type]++;
        currentIdx++;
        
        // Visual Pulse
        const bg = document.getElementById('bg-layer');
        bg.style.background = 'radial-gradient(circle at 50% 50%, #ff2a2a 0%, #000 70%)';
        setTimeout(() => {
            bg.style.background = 'radial-gradient(circle at 50% 50%, #2d0a0a 0%, #000 90%)';
        }, 150);

        loadQuestion();
    }

    // 4. RESULTS
    async function calculateResult() {
        document.getElementById('game-ui').style.display = 'none'; // Hide explicitly to prevent layout shifts
        const modal = document.getElementById('results-modal');
        modal.classList.remove('hidden');

        // Determine Winner
        const winner = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
        
        let result = {};
        
        if (winner === 'passive') {
            result = {
                partner: "Mutated Jerry",
                rate: "12% (You will be eaten)",
                img: "https://i.pinimg.com/736x/8a/a5/d4/8aa5d44439c368383827599723232145.jpg" // Reliable placeholder or user asset
            };
        } else if (winner === 'aggressive') {
            result = {
                partner: "Scorpion Rick",
                rate: "98% (Apex Predators)",
                img: "https://static1.srcdn.com/wordpress/wp-content/uploads/2022/09/Rick-and-Morty-Cronenberg-Rick.jpg" 
            };
        } else {
            result = {
                partner: "Cronenberg Monster",
                rate: "100% (Pure Flesh)",
                img: "https://preview.redd.it/why-didnt-rick-fix-cronenberg-world-v0-4m5j3u6w932a1.png?width=1200&format=png&auto=webp&s=cd734891b61c4c15392e21b71d2b8e3a29023192" 
            };
        }

        document.getElementById('result-partner').innerText = result.partner;
        document.getElementById('result-rate').innerText = result.rate;
        document.getElementById('result-img').src = result.img;

        // Firebase Save - CORRECTED
        const user = window.auth?.currentUser;
        if (user && window.db && window.appId) {
            try {
                // Correct Path: artifacts/{appId}/users/{userId}/gameResults
                const resultsRef = collection(window.db, 'artifacts', window.appId, 'users', user.uid, 'gameResults');
                
                await addDoc(resultsRef, {
                    game: 'Cronenberg Match',
                    result: result.partner,
                    type: winner,
                    score: scores[winner], // Save the winning score
                    timestamp: new Date().toISOString()
                });
                console.log("Result saved to Firebase");
            } catch (e) { 
                console.error("Firebase Save Error:", e); 
            }
        } else {
            console.log("Offline or Auth not ready");
        }
    }
  </script>
</body>
</html>