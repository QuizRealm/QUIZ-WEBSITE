<!DOCTYPE html>
<html lang="en">
<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-ML3F7KLZ');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apology Style Audit • Diplomacy & Conflict | QuizRealm</title>
    <meta name="description" content="Discover your conflict resolution archetype. A 13-point audit of how you handle accountability and ego.">
    <meta name="theme-color" content="#1e293b">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,500;0,700;1,500&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="components.js" defer></script>
    <script type="module" src="game-engine.js"></script>
    <script type="module" src="assets/ux-core.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        'serif': ['Cormorant Garamond', 'serif'], 
                        'sans': ['Outfit', 'sans-serif'] 
                    },
                    colors: { 
                        'dip-navy': '#0f172a',
                        'dip-gold': '#c5a059',
                        'dip-paper': '#f8f5f0',
                        'dip-border': 'rgba(197, 160, 89, 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8f5f0; color: #0f172a; font-family: 'Outfit', sans-serif; overflow-x: hidden; }
        
        .serif-italic { font-family: 'Cormorant Garamond', serif; font-style: italic; }

        /* Premium Buttons */
        .btn-option {
            background: white;
            border: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            padding: 1.5rem;
            border-radius: 2px;
            font-size: 0.95rem;
        }
        .btn-option:hover {
            border-color: #c5a059;
            background: #fffdfa;
            transform: translateX(10px);
        }

        .btn-diplomat {
            background: #0f172a;
            color: #f8f5f0;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            font-weight: 600;
            transition: all 0.4s;
        }
        .btn-diplomat:hover {
            background: #c5a059;
            box-shadow: 0 10px 20px -10px rgba(197, 160, 89, 0.5);
        }

        /* Gold Line Accent */
        .gold-line {
            height: 1px;
            background: linear-gradient(90deg, transparent, #c5a059, transparent);
            width: 100%;
            margin: 2rem 0;
        }

        /* Progress Bar */
        .progress-track { background: #e2e8f0; height: 2px; width: 100%; }
        .progress-fill { background: #c5a059; height: 100%; width: 0%; transition: width 0.5s ease; }

        /* Animations */
        .fade-in { animation: fadeIn 1s ease forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>

<body class="flex flex-col min-h-screen">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ML3F7KLZ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <quiz-header style="color: #0f172a;"></quiz-header>

    <main class="flex-grow w-full max-w-4xl mx-auto px-6 py-16">

        <div id="start-screen" class="text-center space-y-10 fade-in">
            <div class="space-y-4">
                <span class="text-[10px] font-bold uppercase tracking-[0.5em] text-dip-gold">Internal Protocol // Conflict Resolution</span>
                <h1 class="font-serif text-6xl md:text-8xl leading-none">
                    The <span class="serif-italic">Apology</span> <br>Style Audit.
                </h1>
            </div>

            <div class="gold-line"></div>

            <p class="text-lg text-slate-600 font-light max-w-2xl mx-auto leading-relaxed italic">
                "An apology without a change in behavior is merely a request for permission to continue the offense."
            </p>

            <p class="text-sm text-slate-500 max-w-md mx-auto uppercase tracking-widest leading-loose">
                13 questions to determine your accountability baseline and ego-preservation tactics.
            </p>

            <button onclick="window.startQuiz()" class="btn-diplomat px-12 py-5 text-xs rounded-sm">
                Begin Assessment
            </button>
        </div>

        <div id="quiz-interface" class="hidden min-h-[50vh] flex flex-col justify-center max-w-2xl mx-auto">
            
            <div class="mb-16">
                <div class="flex justify-between items-end mb-4 font-serif italic text-xl text-dip-gold">
                    <span id="q-category">Diplomacy</span>
                    <span class="text-xs font-sans not-italic text-slate-400" id="progress-text">01 / 13</span>
                </div>
                <div class="progress-track">
                    <div id="progress-bar" class="progress-fill"></div>
                </div>
            </div>

            <h2 id="question-text" class="font-serif text-3xl md:text-5xl mb-12 leading-tight">
                Loading...
            </h2>

            <div id="options-container" class="grid grid-cols-1 gap-4">
                </div>
        </div>

        <div id="result-screen" class="hidden text-center max-w-3xl mx-auto fade-in">
            
            <div class="space-y-6 mb-12">
                <span class="text-[10px] uppercase tracking-[0.4em] text-dip-gold">Audit Result Assigned</span>
                <h2 class="font-serif text-6xl md:text-8xl leading-none"><span id="result-title" class="serif-italic">Archetype</span></h2>
                <h3 id="result-subtitle" class="text-slate-500 font-sans text-sm uppercase tracking-widest">Subtitle</h3>
            </div>

            <div class="bg-white p-10 border border-dip-border shadow-sm mb-12">
                <p id="result-summary" class="text-lg leading-loose text-slate-700 italic">
                    Summary loading...
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12 text-left">
                <div class="space-y-6">
                    <h4 class="text-xs font-bold uppercase tracking-widest text-dip-gold">Core Metrics</h4>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-[10px] uppercase font-bold mb-1"><span>Accountability</span><span id="stat-acc">0%</span></div>
                            <div class="progress-track"><div id="bar-acc" class="h-full bg-dip-navy" style="width:0%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] uppercase font-bold mb-1"><span>Ego Retention</span><span id="stat-ego">0%</span></div>
                            <div class="progress-track"><div id="bar-ego" class="h-full bg-dip-gold" style="width:0%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] uppercase font-bold mb-1"><span>Empathy Accuracy</span><span id="stat-emp">0%</span></div>
                            <div class="progress-track"><div id="bar-emp" class="h-full bg-slate-400" style="width:0%"></div></div>
                        </div>
                    </div>
                </div>
                <div class="bg-dip-navy p-8 text-white flex flex-col justify-center text-center">
                    <div class="text-[10px] uppercase tracking-[0.3em] text-dip-gold mb-2">Defensiveness Index</div>
                    <div id="stat-def" class="text-4xl font-serif italic">Analyzing...</div>
                </div>
            </div>

            <div class="space-y-6">
                <button onclick="document.getElementById('full-report').classList.toggle('hidden')" class="text-[10px] font-bold uppercase tracking-widest border-b border-dip-gold pb-1 hover:text-dip-gold transition">
                    View Full Behavioral Report
                </button>
                
                <div id="full-report" class="hidden text-left bg-white p-8 border border-slate-200 text-sm text-slate-500 leading-loose space-y-4">
                    <p id="result-desc">Full description...</p>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 justify-center pt-8">
                    <button onclick="shareResult()" class="btn-diplomat px-10 py-4 text-[10px]">Share Profile</button>
                    <a href="index-funnels.html" class="border border-dip-navy px-10 py-4 text-[10px] font-bold uppercase tracking-widest hover:bg-dip-navy hover:text-white transition">Full Index</a>
                </div>
            </div>

        </div>

    </main>

    <quiz-footer></quiz-footer>

    <script type="module">
        // ================= CONFIG & QUESTIONS =================
        // Scores: ACC (Accountability), EGO (Ego Preservation), EMP (Empathy)
        const questions = [
            { q: "You've been called out for a mistake. Your internal 'voice' says:", cat: "Instinct",
              a: [
                  { text: "I need to fix this and apologize immediately.", scores: { acc: 25, ego: 0, emp: 10 } },
                  { text: "Why is everyone always ganging up on me?", scores: { acc: 0, ego: 25, emp: 0 } },
                  { text: "I'll say sorry, but only to end the conversation.", scores: { acc: 5, ego: 15, emp: 5 } }
              ] 
            },
            { q: "When you say 'I'm sorry,' do you typically add a 'but...'?", cat: "Linguistics",
              a: [
                  { text: "Never. An apology should stand alone.", scores: { acc: 30, ego: 0, emp: 15 } },
                  { text: "Often, because context is important for them to understand.", scores: { acc: 5, ego: 20, emp: 0 } },
                  { text: "Only if the other person was also at fault.", scores: { acc: 10, ego: 15, emp: 5 } }
              ] 
            },
            { q: "Someone is crying because of something you said. You feel:", cat: "Empathy",
              a: [
                  { text: "Terrible. Their pain is my priority right now.", scores: { acc: 20, ego: 0, emp: 30 } },
                  { text: "Annoyed. It wasn't that big of a deal.", scores: { acc: 0, ego: 25, emp: 0 } },
                  { text: "Confused. I didn't mean it that way.", scores: { acc: 5, ego: 10, emp: 10 } }
              ] 
            },
            { q: "An apology is successful only if:", cat: "Philosophy",
              a: [
                  { text: "The other person feels truly heard and healed.", scores: { acc: 20, ego: 0, emp: 25 } },
                  { text: "They stop being mad at me.", scores: { acc: 5, ego: 25, emp: 0 } },
                  { text: "I have explained my side clearly.", scores: { acc: 10, ego: 20, emp: 5 } }
              ] 
            },
            { q: "How do you handle 'Historical' mistakes (from months ago)?", cat: "Persistence",
              a: [
                  { text: "I'll apologize again if it's still hurting them.", scores: { acc: 25, ego: 0, emp: 20 } },
                  { text: "I refuse to talk about the past. Move on.", scores: { acc: 0, ego: 30, emp: 0 } },
                  { text: "I've already said sorry once; that's enough.", scores: { acc: 5, ego: 20, emp: 5 } }
              ] 
            },
            { q: "In an argument, you realize you are 100% wrong. You:", cat: "Ego",
              a: [
                  { text: "Stop, admit it immediately, and apologize.", scores: { acc: 40, ego: -10, emp: 10 } },
                  { text: "Try to find one small thing they also did wrong.", scores: { acc: 5, ego: 30, emp: 0 } },
                  { text: "Slowly stop arguing and hope they forget.", scores: { acc: 10, ego: 20, emp: 5 } }
              ] 
            },
            { q: "A friend says your apology felt 'fake.' You:", cat: "Reaction",
              a: [
                  { text: "Ask what was missing and try again deeper.", scores: { acc: 20, ego: 0, emp: 25 } },
                  { text: "Get defensive. I said the words, what else do they want?", scores: { acc: 0, ego: 35, emp: 0 } },
                  { text: "Withdraw and stop talking to them for a while.", scores: { acc: 0, ego: 20, emp: 0 } }
              ] 
            },
            { q: "When you hurt someone, who is the 'Victim' in your mind?", cat: "Perspective",
              a: [
                  { text: "The other person, obviously.", scores: { acc: 15, ego: 0, emp: 25 } },
                  { text: "Me, because now I have to deal with their mood.", scores: { acc: 0, ego: 40, emp: 0 } },
                  { text: "Both of us, it's a misunderstanding.", scores: { acc: 5, ego: 20, emp: 10 } }
              ] 
            },
            { q: "Your partner wants to talk about their feelings. You feel:", cat: "Tolerance",
              a: [
                  { text: "Ready to listen. It's necessary for growth.", scores: { acc: 15, ego: 0, emp: 25 } },
                  { text: "Exhausted. Here we go again.", scores: { acc: 0, ego: 25, emp: -10 } },
                  { text: "Scared. I hate conflict.", scores: { acc: 10, ego: 15, emp: 10 } }
              ] 
            },
            { q: "You forgot a major anniversary. Your apology is:", cat: "Scenario",
              a: [
                  { text: "Flowers, a real talk, and a plan for next time.", scores: { acc: 25, ego: 0, emp: 20 } },
                  { text: "A list of reasons why I was too busy.", scores: { acc: 5, ego: 25, emp: 0 } },
                  { text: "Buying an expensive gift to 'erase' the error.", scores: { acc: 10, ego: 15, emp: 5 } }
              ] 
            },
            { q: "Do you believe some things are 'Unapologizable'?", cat: "Boundaries",
              a: [
                  { text: "Yes, some trust cannot be rebuilt with words.", scores: { acc: 20, ego: 10, emp: 15 } },
                  { text: "No, a good enough talk can fix anything.", scores: { acc: 5, ego: 20, emp: 5 } },
                  { text: "If I'm forgiven, it doesn't matter what I did.", scores: { acc: 0, ego: 30, emp: 0 } }
              ] 
            },
            { q: "The goal of a conversation after a fight is:", cat: "Goal",
              a: [
                  { text: "To understand each other better.", scores: { acc: 20, ego: 0, emp: 30 } },
                  { text: "To be proven right.", scores: { acc: 0, ego: 40, emp: 0 } },
                  { text: "To stop the yelling.", scores: { acc: 5, ego: 15, emp: 5 } }
              ] 
            },
            { q: "How do you feel after you apologize?", cat: "Aftermath",
              a: [
                  { text: "Relieved and closer to the person.", scores: { acc: 15, ego: 0, emp: 20 } },
                  { text: "Humiliated and small.", scores: { acc: 10, ego: 30, emp: 5 } },
                  { text: "I feel like I 'won' because it's over.", scores: { acc: 0, ego: 25, emp: 0 } }
              ] 
            }
        ];

        const archetypes = {
            "Reparative": {
                title: "The Reparative",
                subtitle: "The Architect of Trust",
                summary: "You view apologies as a tool for healing, not a loss of status.",
                desc: "You prioritize the relationship over your ego. You understand that a 'clean' apology involves acknowledging impact over intent. Your strength is high emotional intelligence and the ability to sit with discomfort without deflecting. People feel safe around you because you own your shadow."
            },
            "Lawyer": {
                title: "The Lawyer",
                subtitle: "The Contextualist",
                summary: "You apologize for the 'action,' but defend the 'reason' with evidence.",
                desc: "You have high Accountability but even higher Ego Retention. You will say sorry, but you require the other person to acknowledge exactly *why* you did what you did. Your apologies often feel like a closing argument in court—logical, but lacking warmth."
            },
            "Eraser": {
                title: "The Eraser",
                subtitle: "The Transactional Hero",
                summary: "You believe gifts and favors can overwrite emotional debts.",
                desc: "You struggle with the vulnerability of words. Instead of an apology, you offer a 'fix'—a gift, a chore, or an expensive dinner. While helpful, you often leave the emotional wound open because you refuse to acknowledge the pain directly."
            },
            "Groveler": {
                title: "The Groveler",
                subtitle: "The Guilt-Tripper",
                summary: "You make your apology so dramatic that the other person ends up comforting YOU.",
                desc: "This is a subtle form of manipulation. By becoming 'so sad' about your mistake, you shift the focus from the victim to your own guilt. You use self-deprecation as a shield against actual accountability."
            },
            "Silent": {
                title: "The Silent",
                subtitle: "The Ghost of Conflict",
                summary: "You apologize through silence and better behavior next time.",
                desc: "You find the words 'I am sorry' physically difficult to say. You prefer to wait for the tension to blow over and then act extra nice. This avoids the ego-hit of an apology but leaves a trail of unresolved resentment in your relationships."
            },
            "Deflector": {
                title: "The Deflector",
                subtitle: "The 'But' Enthusiast",
                summary: "You treat apologies as a game of hot potato.",
                desc: "You are highly defensive. Every 'I'm sorry' is followed by a 'but you also did...' You view conflict as a zero-sum game where admitting fault means losing. Your relationships are likely marked by constant power struggles and a lack of true intimacy."
            },
            "Evolutionist": {
                title: "The Evolutionist",
                subtitle: "The Forward-Thinker",
                summary: "You focus 100% on the future, ignoring the pain of the past.",
                desc: "You say, 'I can't change what happened, so let's just talk about tomorrow.' While pragmatic, you often leave your partners feeling dismissed. You view 'talking about feelings' as inefficient, but you forget that emotions don't follow a clock."
            }
        };

        // ================= LOGIC =================
        let currentQ = 0;
        let totals = { acc: 0, ego: 0, emp: 0 };
        let startTime = 0;

        window.startQuiz = function() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quiz-interface').classList.remove('hidden');
            startTime = Date.now();
            renderQuestion();
        }

        function renderQuestion() {
            if (currentQ >= questions.length) { finishQuiz(); return; }
            const q = questions[currentQ];
            document.getElementById('q-category').innerText = q.cat;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('progress-text').innerText = `${String(currentQ+1).padStart(2, '0')} / ${questions.length}`;
            document.getElementById('progress-bar').style.width = ((currentQ / questions.length) * 100) + "%";

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.a.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "btn-option";
                btn.innerText = opt.text;
                btn.onclick = () => {
                    totals.acc += opt.scores.acc;
                    totals.ego += opt.scores.ego;
                    totals.emp += opt.scores.emp;
                    currentQ++;
                    renderQuestion();
                };
                container.appendChild(btn);
            });
        }

        function finishQuiz() {
            const durationSec = Math.floor((Date.now() - startTime) / 1000);
            
            // Logic to determine key
            let resultKey = "Reparative";
            if (totals.ego > totals.acc && totals.ego > 250) resultKey = "Deflector";
            else if (totals.acc > 250 && totals.ego > 150) resultKey = "Lawyer";
            else if (totals.emp < 50 && totals.acc > 100) resultKey = "Evolutionist";
            else if (totals.ego > 200 && totals.emp > 150) resultKey = "Groveler";
            else if (totals.acc < 100 && totals.ego < 150) resultKey = "Silent";
            else if (totals.acc > 200 && totals.emp > 200) resultKey = "Reparative";
            else resultKey = "Eraser";

            const data = archetypes[resultKey];

            // Render UI
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('result-title').innerText = data.title;
            document.getElementById('result-subtitle').innerText = data.subtitle;
            document.getElementById('result-summary').innerText = data.summary;
            document.getElementById('result-desc').innerText = data.desc;

            // Stats (Normalized)
            document.getElementById('stat-acc').innerText = Math.min(100, Math.floor(totals.acc/3.5)) + "%";
            document.getElementById('bar-acc').style.width = Math.min(100, Math.floor(totals.acc/3.5)) + "%";
            document.getElementById('stat-ego').innerText = Math.min(100, Math.floor(totals.ego/4)) + "%";
            document.getElementById('bar-ego').style.width = Math.min(100, Math.floor(totals.ego/4)) + "%";
            document.getElementById('stat-emp').innerText = Math.min(100, Math.floor(totals.emp/3)) + "%";
            document.getElementById('bar-emp').style.width = Math.min(100, Math.floor(totals.emp/3)) + "%";
            
            document.getElementById('stat-def').innerText = totals.ego > 200 ? "High" : (totals.ego > 100 ? "Moderate" : "Low");

            const payload = {
                testId: "apology_style",
                archetype: resultKey,
                metrics: {
                    accountability_score: totals.acc,
                    ego_retention: totals.ego,
                    empathy_accuracy: totals.emp,
                    defensiveness: totals.ego > 200 ? "High" : "Low",
                    time_taken: durationSec
                }
            };

            if (window.saveTestResult) window.saveTestResult(payload);
        }

        window.shareResult = () => {
            if(navigator.share) navigator.share({title: 'My Apology Style', text: 'My style is ' + document.getElementById('result-title').innerText, url: window.location.href});
            else alert("Link copied to clipboard");
        }
    </script>
</body>
</html>