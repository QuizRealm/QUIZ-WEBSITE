<!DOCTYPE html>
<html lang="en">
<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-ML3F7KLZ');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apology Style Audit • Diplomacy & Conflict | QuizRealm</title>
    <meta name="description" content="A dark, brutally honest audit of your apology style. Are you actually sorry, or just managing PR? 13 questions. 7 archetypes. No gentle feedback.">
    <meta name="theme-color" content="#020617">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,500;0,700;1,500&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="components.js" defer></script>
    <script type="module" src="game-engine.js"></script>
    <script type="module" src="assets/ux-core.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        serif: ['Cormorant Garamond', 'serif'], 
                        sans: ['Outfit', 'sans-serif'] 
                    },
                    colors: { 
                        'dip-navy': '#020617',
                        'dip-panel': '#020617',
                        'dip-panel-soft': '#020617',
                        'dip-gold': '#c5a059',
                        'dip-paper': '#020617',
                        'dip-border': 'rgba(148, 163, 184, 0.65)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background: radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
            color: #e5e7eb;
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
        }
        
        .serif-italic {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
        }

        /* Premium dark cards */
        .card-panel {
            background: radial-gradient(circle at top left, rgba(148,163,184,0.12), rgba(15,23,42,0.95));
            border: 1px solid rgba(148,163,184,0.45);
            box-shadow: 0 22px 45px -25px rgba(15,23,42,0.9);
        }

        .card-soft {
            background: radial-gradient(circle at top right, rgba(148,163,184,0.18), rgba(15,23,42,0.98));
            border: 1px solid rgba(148,163,184,0.35);
            box-shadow: 0 18px 40px -28px rgba(15,23,42,0.9);
        }

        /* Premium Buttons */
        .btn-option {
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(148,163,184,0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            padding: 1.4rem 1.6rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            color: #e5e7eb;
        }
        .btn-option:hover {
            border-color: #c5a059;
            background: radial-gradient(circle at left, rgba(197,160,89,0.16), rgba(15,23,42,1));
            transform: translateX(10px) translateY(-2px);
            box-shadow: 0 12px 26px -16px rgba(197,160,89,0.65);
        }

        .btn-diplomat {
            background: linear-gradient(135deg, #c5a059, #facc6b);
            color: #020617;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            font-weight: 600;
            font-size: 0.7rem;
            transition: all 0.4s;
            border-radius: 999px;
        }
        .btn-diplomat:hover {
            background: #e5b868;
            box-shadow: 0 18px 40px -22px rgba(234,179,8,0.8);
            transform: translateY(-1px);
        }

        /* Gold Line Accent */
        .gold-line {
            height: 1px;
            background: linear-gradient(90deg, transparent, #c5a059, transparent);
            width: 100%;
            margin: 2rem 0;
            opacity: 0.8;
        }

        /* Progress Bar */
        .progress-track {
            background: rgba(15,23,42,0.8);
            height: 3px;
            width: 100%;
            border-radius: 999px;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #c5a059, #fbbf24);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .metric-track {
            background: rgba(15,23,42,0.8);
            height: 4px;
            width: 100%;
            border-radius: 999px;
            overflow: hidden;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 1s ease forwards;
            opacity: 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glow-label {
            text-shadow: 0 0 10px rgba(234,179,8,0.4);
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ML3F7KLZ" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <quiz-header style="color: #e5e7eb;"></quiz-header>

    <main class="flex-grow w-full max-w-4xl mx-auto px-6 py-16">

        <!-- START SCREEN -->
        <div id="start-screen" class="text-center space-y-10 fade-in">
            <div class="space-y-4">
                <span class="text-[10px] font-bold uppercase tracking-[0.5em] text-dip-gold/90">
                    INTERNAL PROTOCOL // CONFLICT & DAMAGE CONTROL
                </span>
                <h1 class="font-serif text-5xl md:text-7xl leading-none text-slate-50">
                    The <span class="serif-italic text-dip-gold">Apology</span><br>Style Audit.
                </h1>
            </div>

            <div class="gold-line"></div>

            <p class="text-base md:text-lg text-slate-400 font-light max-w-2xl mx-auto leading-relaxed italic">
                "An apology without changed behavior is not growth. It’s a recurring subscription to the same problem."
            </p>

            <p class="text-[11px] text-slate-500 max-w-md mx-auto uppercase tracking-[0.35em] leading-relaxed">
                13 QUESTIONS TO MEASURE IF YOU’RE ACTUALLY SORRY, OR JUST DOING DAMAGE CONTROL FOR YOUR EGO.
            </p>

            <button onclick="window.startQuiz()" class="btn-diplomat px-12 py-4 inline-flex items-center justify-center gap-3">
                <span>Begin Assessment</span>
                <i class="fa-solid fa-arrow-right-long text-[10px]"></i>
            </button>
        </div>

        <!-- QUIZ INTERFACE -->
        <div id="quiz-interface" class="hidden min-h-[50vh] flex flex-col justify-center max-w-2xl mx-auto">
            <div class="mb-16">
                <div class="flex justify-between items-end mb-4">
                    <div class="font-serif italic text-lg text-dip-gold flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-lime-400 animate-pulse"></span>
                        <span id="q-category">Diplomacy</span>
                    </div>
                    <span class="text-[10px] font-sans text-slate-500 uppercase tracking-[0.3em]" id="progress-text">
                        01 / 13
                    </span>
                </div>
                <div class="progress-track">
                    <div id="progress-bar" class="progress-fill"></div>
                </div>
            </div>

            <h2 id="question-text" class="font-serif text-2xl md:text-4xl mb-10 leading-tight text-slate-50">
                Loading...
            </h2>

            <div id="options-container" class="grid grid-cols-1 gap-4"></div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-screen" class="hidden text-center max-w-3xl mx-auto fade-in">
            
            <div class="space-y-6 mb-10">
                <span class="text-[10px] uppercase tracking-[0.4em] text-dip-gold/90">
                    AUDIT RESULT FINALIZED
                </span>
                <h2 class="font-serif text-5xl md:text-7xl leading-none text-slate-50">
                    <span id="result-title" class="serif-italic">Archetype</span>
                </h2>
                <h3 id="result-subtitle" class="text-slate-500 font-sans text-[11px] uppercase tracking-[0.35em]">
                    Subtitle
                </h3>
            </div>

            <div class="card-panel p-8 md:p-10 mb-10 rounded-3xl">
                <p id="result-summary" class="text-base md:text-lg leading-relaxed text-slate-300 italic">
                    Summary loading...
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 text-left">
                <div class="space-y-6">
                    <h4 class="text-[11px] font-bold uppercase tracking-[0.3em] text-dip-gold glow-label">
                        Core Metrics
                    </h4>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-[10px] uppercase font-bold mb-1 text-slate-400">
                                <span>Accountability</span><span id="stat-acc">0%</span>
                            </div>
                            <div class="metric-track">
                                <div id="bar-acc" class="h-full" style="width:0%; background:linear-gradient(90deg,#22c55e,#a3e635);"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] uppercase font-bold mb-1 text-slate-400">
                                <span>Ego Retention</span><span id="stat-ego">0%</span>
                            </div>
                            <div class="metric-track">
                                <div id="bar-ego" class="h-full" style="width:0%; background:linear-gradient(90deg,#f97316,#facc15);"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] uppercase font-bold mb-1 text-slate-400">
                                <span>Empathy Accuracy</span><span id="stat-emp">0%</span>
                            </div>
                            <div class="metric-track">
                                <div id="bar-emp" class="h-full" style="width:0%; background:linear-gradient(90deg,#38bdf8,#a855f7);"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-soft p-8 rounded-3xl flex flex-col justify-center text-center border border-dip-border">
                    <div class="text-[10px] uppercase tracking-[0.3em] text-dip-gold mb-2">
                        Defensiveness Index
                    </div>
                    <div id="stat-def" class="text-4xl font-serif italic text-slate-50">
                        Analyzing...
                    </div>
                    <p id="def-note" class="mt-3 text-[11px] text-slate-400 uppercase tracking-[0.2em]">
                        <!-- Filled dynamically -->
                    </p>
                </div>
            </div>

            <div class="space-y-6 text-left">
                <button
                    onclick="document.getElementById('full-report').classList.toggle('hidden')"
                    class="text-[10px] font-bold uppercase tracking-[0.35em] border-b border-dip-gold pb-1 hover:text-dip-gold transition w-full text-left">
                    View Full Behavioral Report
                </button>
                
                <div id="full-report" class="hidden card-panel p-8 border border-slate-700/60 text-sm text-slate-300 leading-relaxed space-y-4 rounded-3xl">
                    <p id="result-desc">Full description...</p>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 justify-center pt-8">
                    <button onclick="shareResult()" class="btn-diplomat px-10 py-4 text-[10px]">
                        Share Profile
                    </button>
                    <a href="index-funnels.html" class="border border-slate-600 px-10 py-4 text-[10px] font-bold uppercase tracking-[0.3em] text-slate-300 hover:bg-slate-100/5 hover:text-white transition text-center">
                        Full Index
                    </a>
                </div>

                <!-- SEO-style explanatory block -->
                <section class="mt-8 card-panel p-6 rounded-3xl text-xs text-slate-400 space-y-2">
                    <h2 class="font-serif text-sm text-slate-100 tracking-[0.2em] uppercase">
                        What this apology test actually measures
                    </h2>
                    <p>
                        This audit weighs three axes: <strong>Accountability</strong> (how fast you own it), 
                        <strong>Ego Retention</strong> (how hard you fight to stay “technically not the bad guy”), 
                        and <strong>Empathy Accuracy</strong> (whether you care about their pain or just your reputation).
                    </p>
                    <p>
                        Your archetype is not a compliment. It is a label for your default conflict script when you break something—
                        feelings, trust, or just the vibe. Use it to rewrite how you apologize, or at least to understand why people 
                        still bring up things you “already apologized for”.
                    </p>
                </section>
            </div>

        </div>

    </main>

    <quiz-footer></quiz-footer>

    <script type="module">
        // ================= AXES & QUESTIONS =================
        // Scores: ACC (Accountability), EGO (Ego Preservation), EMP (Empathy / Impact awareness)
        const questions = [
            {
                q: "You’ve been clearly called out for a mistake. Your honest inner monologue says:",
                cat: "Instinct",
                a: [
                    {
                        text: "“Okay, I actually messed this up. Time to fix it and repair the damage.”",
                        scores: { acc: 28, ego: 0,  emp: 12 }
                    },
                    {
                        text: "“Why is everyone so dramatic about literally everything I do?”",
                        scores: { acc: 0,  ego: 28, emp: 0 }
                    },
                    {
                        text: "“I’ll apologize just enough so they stop talking about it.”",
                        scores: { acc: 8,  ego: 18, emp: 5 }
                    }
                ]
            },
            {
                q: "When you say “I’m sorry…”, how often does a “but” sneak in right after?",
                cat: "Linguistics",
                a: [
                    {
                        text: "Basically never. I know “but” is a fire extinguisher for accountability.",
                        scores: { acc: 30, ego: 0,  emp: 15 }
                    },
                    {
                        text: "Often. I need them to understand it wasn’t really my fault, obviously.",
                        scores: { acc: 4,  ego: 24, emp: 0 }
                    },
                    {
                        text: "Only when they’re also guilty and I refuse to go down alone.",
                        scores: { acc: 10, ego: 18, emp: 5 }
                    }
                ]
            },
            {
                q: "Someone starts crying because of something you said.",
                cat: "Empathy Load",
                a: [
                    {
                        text: "My stomach drops. I care more about their pain than my defense.",
                        scores: { acc: 20, ego: 0,  emp: 30 }
                    },
                    {
                        text: "I’m mostly annoyed. It wasn’t that deep and now it’s a whole thing.",
                        scores: { acc: 0,  ego: 26, emp: 0 }
                    },
                    {
                        text: "Confused and awkward. I didn’t mean it that way, but clearly I missed something.",
                        scores: { acc: 7,  ego: 10, emp: 12 }
                    }
                ]
            },
            {
                q: "In your mind, a “successful” apology means:",
                cat: "Philosophy",
                a: [
                    {
                        text: "They feel understood, validated, and less alone in the hurt.",
                        scores: { acc: 20, ego: 0,  emp: 25 }
                    },
                    {
                        text: "They stop being mad at me so we can go back to normal.",
                        scores: { acc: 5,  ego: 26, emp: 0 }
                    },
                    {
                        text: "I have clearly explained my INTENT so they know I’m not a villain.",
                        scores: { acc: 10, ego: 19, emp: 5 }
                    }
                ]
            },
            {
                q: "They bring up something you did months ago that still hurts.",
                cat: "History",
                a: [
                    {
                        text: "If it still hurts, it still matters. I’ll apologize again and go deeper.",
                        scores: { acc: 24, ego: 0,  emp: 20 }
                    },
                    {
                        text: "I refuse to rehash ancient history. That’s a YOU problem now.",
                        scores: { acc: 0,  ego: 30, emp: 0 }
                    },
                    {
                        text: "I’ve already said sorry once; I’ll say it again, but with less patience.",
                        scores: { acc: 7,  ego: 20, emp: 5 }
                    }
                ]
            },
            {
                q: "Halfway through an argument you realize you are 100% wrong.",
                cat: "Ego Crash",
                a: [
                    {
                        text: "I stop, admit it, and switch to repair mode. Yes, it stings.",
                        scores: { acc: 40, ego: -8, emp: 10 }
                    },
                    {
                        text: "I immediately start searching for the one tiny thing they did wrong too.",
                        scores: { acc: 5,  ego: 32, emp: 0 }
                    },
                    {
                        text: "I quietly change topic and hope they forget I was confident five minutes ago.",
                        scores: { acc: 10, ego: 20, emp: 5 }
                    }
                ]
            },
            {
                q: "They say your apology felt “performative” or “fake”. You:",
                cat: "Feedback",
                a: [
                    {
                        text: "Ask what felt off, then try again like an adult human being.",
                        scores: { acc: 20, ego: 0,  emp: 26 }
                    },
                    {
                        text: "Get offended. I said the words—what else do they want, blood?",
                        scores: { acc: 0,  ego: 34, emp: 0 }
                    },
                    {
                        text: "Shut down and avoid them for a while. Problem “solved”.",
                        scores: { acc: 0,  ego: 22, emp: 0 }
                    }
                ]
            },
            {
                q: "When you hurt someone, who feels like the real victim in your internal narrative?",
                cat: "Perspective",
                a: [
                    {
                        text: "Them. Obviously. They’re the one carrying the pain.",
                        scores: { acc: 16, ego: 0,  emp: 25 }
                    },
                    {
                        text: "Me, actually. Now I have to deal with guilt and their mood.",
                        scores: { acc: 0,  ego: 40, emp: 0 }
                    },
                    {
                        text: "Both. It’s messy, and I’d rather pretend it never happened.",
                        scores: { acc: 6,  ego: 22, emp: 10 }
                    }
                ]
            },
            {
                q: "Your partner says, “Can we talk about how that made me feel?” and sits down.",
                cat: "Tolerance",
                a: [
                    {
                        text: "I brace, but I’m present. Feelings talks are maintenance, not attacks.",
                        scores: { acc: 16, ego: 0,  emp: 25 }
                    },
                    {
                        text: "I internally sigh. Another episode of “My Emotions & Me”.",
                        scores: { acc: 0,  ego: 26, emp: -8 }
                    },
                    {
                        text: "I get anxious and want to run, but I stay because I care.",
                        scores: { acc: 11, ego: 14, emp: 12 }
                    }
                ]
            },
            {
                q: "You forgot a major anniversary. Your idea of “making it right” is:",
                cat: "Scenario",
                a: [
                    {
                        text: "Big apology, real conversation, practical system so it never happens again.",
                        scores: { acc: 24, ego: 0,  emp: 20 }
                    },
                    {
                        text: "Explaining how busy and stressed I’ve been until they feel guilty for being upset.",
                        scores: { acc: 5,  ego: 26, emp: 0 }
                    },
                    {
                        text: "Buying something expensive and hoping capitalism fixes emotions.",
                        scores: { acc: 10, ego: 18, emp: 5 }
                    }
                ]
            },
            {
                q: "Do you believe some things are genuinely “unapologizable”?",
                cat: "Boundaries",
                a: [
                    {
                        text: "Yes. Some damage requires distance, not dialogue.",
                        scores: { acc: 18, ego: 8,  emp: 16 }
                    },
                    {
                        text: "No. With enough talking and context, anything can be repaired.",
                        scores: { acc: 7,  ego: 22, emp: 6 }
                    },
                    {
                        text: "If I’m forgiven, then it couldn’t have been that bad.",
                        scores: { acc: 0,  ego: 30, emp: 0 }
                    }
                ]
            },
            {
                q: "The real goal of a “talk after a fight” for you is:",
                cat: "Goal",
                a: [
                    {
                        text: "To actually understand each other better and adjust behavior.",
                        scores: { acc: 20, ego: 0,  emp: 30 }
                    },
                    {
                        text: "To be proven right and get an apology owed to ME.",
                        scores: { acc: 0,  ego: 40, emp: 0 }
                    },
                    {
                        text: "To reduce noise levels and escape the conversation alive.",
                        scores: { acc: 6,  ego: 18, emp: 5 }
                    }
                ]
            },
            {
                q: "After you apologize, you usually feel:",
                cat: "Aftermath",
                a: [
                    {
                        text: "Relieved, closer, and slightly emotionally hungover—but lighter.",
                        scores: { acc: 16, ego: 0,  emp: 20 }
                    },
                    {
                        text: "Humiliated, small, and lowkey resentful I had to apologize at all.",
                        scores: { acc: 8,  ego: 30, emp: 5 }
                    },
                    {
                        text: "Like I “won” because the conflict is technically over now.",
                        scores: { acc: 0,  ego: 26, emp: 0 }
                    }
                ]
            }
        ];

        // ================= ARCHETYPES =================
        const archetypes = {
            Reparative: {
                title: "The Reparative",
                subtitle: "Architect of Actual Growth",
                summary: "You treat apologies like renovation, not wallpaper.",
                desc: "You don’t just throw “sorry” at people like emotional confetti. You care about impact more than optics. You’re willing to feel uncomfortable, admit you were wrong, and actually change behavior. People feel unnervingly safe around you because you own your mess instead of rebranding it."
            },
            Lawyer: {
                title: "The Lawyer",
                subtitle: "Context Over Contrition",
                summary: "You apologize, but you also submit a legal defense file.",
                desc: "You will technically say the words “I’m sorry,” but the real star of the show is your explanation. You want the court (them) to understand your intent, your stress, your childhood, the weather, and the traffic. Logical? Yes. Healing? Occasionally. Warm? Absolutely not."
            },
            Eraser: {
                title: "The Eraser",
                subtitle: "Gift-Based Damage Control",
                summary: "You outsource emotional labor to flowers, food, and surprises.",
                desc: "Instead of sitting in discomfort and saying the real words, you throw money, plans, or tasks at the problem. You’re not heartless; you just prefer “fixing” to “feeling”. People around you get treated well—but not always truly heard."
            },
            Groveler: {
                title: "The Groveler",
                subtitle: "Apology as Performance Art",
                summary: "You make your guilt so loud they end up comforting you.",
                desc: "Your apologies come with full dramatic score: “I’m the worst person alive, you should leave me.” On the surface it looks self-aware, but underneath it pulls focus away from their hurt and onto your suffering. You weaponize self-blame to dodge responsibility."
            },
            Silent: {
                title: "The Silent",
                subtitle: "Change Behavior, Avoid Words",
                summary: "You upgrade your behavior but leave the emotional invoice unpaid.",
                desc: "You hate saying “I was wrong.” So you quietly do better and hope they notice. While your actions improve, the other person never gets the validation of hearing you acknowledge the damage. Your version of repair works—until someone needs language, not logistics."
            },
            Deflector: {
                title: "The Deflector",
                subtitle: "Master of the Word “But”",
                summary: "Every apology is a Trojan horse for counter-attack.",
                desc: "You treat accountability like a trap. You’ll say “I’m sorry you feel that way” or “I’m sorry, but you also...” and immediately push some blame back. Conflict with you feels like a courtroom, not a connection. People stop being honest with you to avoid getting cross-examined."
            },
            Evolutionist: {
                title: "The Evolutionist",
                subtitle: "Future-Only, Emotion-Optional",
                summary: "You skip the feelings and sprint straight to the upgrade.",
                desc: "You fully believe in fixing behavior—but not in lingering on how it felt. Talking about the past feels like inefficiency or emotional bureaucracy. People experience you as “better now” but never fully sure if you understand why they were hurt in the first place."
            }
        };

        // ================= LOGIC =================
        let currentQ = 0;
        let totals = { acc: 0, ego: 0, emp: 0 };
        let startTime = 0;

        const $ = (id) => document.getElementById(id);

        function normalise(raw, maxRaw) {
            const capped = Math.max(0, Math.min(maxRaw, raw));
            return Math.round((capped / maxRaw) * 100);
        }

        function pickArchetype(accPct, egoPct, empPct) {
            // Reparative: high accountability + high empathy, ego relatively low
            if (accPct >= 65 && empPct >= 60 && egoPct <= 55) return "Reparative";

            // Deflector: very high ego, low accountability
            if (egoPct >= 70 && accPct <= 40) return "Deflector";

            // Lawyer: high acc + high ego, mid empathy
            if (accPct >= 60 && egoPct >= 55 && empPct <= 60) return "Lawyer";

            // Groveler: high ego + high empathy, mid acc
            if (egoPct >= 60 && empPct >= 60 && accPct <= 55) return "Groveler";

            // Silent: low verbal accountability (acc low-mid) but not extreme ego; empathy varies
            if (accPct <= 45 && egoPct <= 55 && empPct >= 35) return "Silent";

            // Evolutionist: high acc, low empathy, mid-high ego
            if (accPct >= 55 && empPct <= 40 && egoPct >= 45) return "Evolutionist";

            // Eraser: mid acc, mid ego, low-moderate empathy
            if (accPct >= 40 && accPct <= 65 && egoPct >= 40 && empPct <= 55) return "Eraser";

            // Default: Eraser as a middle pattern
            return "Eraser";
        }

        window.startQuiz = function() {
            $("start-screen").style.display = 'none';
            $("result-screen").classList.add('hidden');
            $("quiz-interface").classList.remove('hidden');

            currentQ = 0;
            totals = { acc: 0, ego: 0, emp: 0 };
            startTime = Date.now();

            $("progress-text").innerText = `01 / ${questions.length}`;
            $("progress-bar").style.width = "0%";
            renderQuestion();
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function renderQuestion() {
            if (currentQ >= questions.length) { finishQuiz(); return; }

            const q = questions[currentQ];
            $("q-category").innerText = q.cat;
            $("question-text").innerText = q.q;
            $("progress-text").innerText = `${String(currentQ+1).padStart(2, '0')} / ${questions.length}`;
            $("progress-bar").style.width = ((currentQ / questions.length) * 100) + "%";

            const container = $("options-container");
            container.innerHTML = '';
            q.a.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "btn-option";
                btn.innerText = opt.text;
                btn.onclick = () => {
                    totals.acc += opt.scores.acc;
                    totals.ego += opt.scores.ego;
                    totals.emp += opt.scores.emp;
                    currentQ++;
                    renderQuestion();
                };
                container.appendChild(btn);
            });
        }

        function finishQuiz() {
            const durationSec = Math.floor((Date.now() - startTime) / 1000);

            $("quiz-interface").classList.add('hidden');
            $("result-screen").classList.remove('hidden');

            // Rough max per axis assuming ~40 per Q upper bound
            const maxRaw = questions.length * 40;

            const accPct = normalise(totals.acc, maxRaw);
            const egoPct = normalise(totals.ego, maxRaw);
            const empPct = normalise(totals.emp, maxRaw);

            const key = pickArchetype(accPct, egoPct, empPct);
            const data = archetypes[key];

            $("result-title").innerText = data.title;
            $("result-subtitle").innerText = data.subtitle;
            $("result-summary").innerText = data.summary;
            $("result-desc").innerText = data.desc;

            // Stats UI
            $("stat-acc").innerText = accPct + "%";
            $("stat-ego").innerText = egoPct + "%";
            $("stat-emp").innerText = empPct + "%";

            $("bar-acc").style.width = accPct + "%";
            $("bar-ego").style.width = egoPct + "%";
            $("bar-emp").style.width = empPct + "%";

            let defLabel = "Low";
            let defNote = "You can handle being wrong without immediately launching a counter-attack.";
            if (egoPct >= 70) {
                defLabel = "Severe";
                defNote = "Your ego deploys lawyers, shields, and fireworks the moment it’s threatened.";
            } else if (egoPct >= 50) {
                defLabel = "Moderate";
                defNote = "You can apologize, but your ego still wants closing arguments and appeal rights.";
            }
            $("stat-def").innerText = defLabel;
            $("def-note").innerText = defNote;

            const payload = {
                testId: "apology_style",
                archetype: key,
                metrics: {
                    accountability_raw: totals.acc,
                    ego_retention_raw: totals.ego,
                    empathy_raw: totals.emp,
                    accountability_pct: accPct,
                    ego_retention_pct: egoPct,
                    empathy_pct: empPct,
                    defensiveness_index: defLabel,
                    time_taken_seconds: durationSec
                }
            };

            if (window.saveTestResult) {
                try {
                    window.saveTestResult(payload);
                } catch (e) {
                    console.warn("saveTestResult (apology_style) failed", e);
                }
            }

            if (window.GameEngine && typeof window.GameEngine.trackEvent === "function") {
                try {
                    window.GameEngine.trackEvent("test_complete", {
                        testId: "apology_style",
                        archetype: key,
                        acc_pct: accPct,
                        ego_pct: egoPct,
                        emp_pct: empPct
                    });
                } catch (e) {}
            }

            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        window.shareResult = async () => {
            const title = "My Apology Style • QuizRealm";
            const arche = $("result-title").innerText;
            const summary = $("result-summary").innerText;

            const text =
                `I just took the “Apology Style Audit” on QuizRealm.\n` +
                `Archetype: ${arche}.\n` +
                `${summary}\n` +
                `Apparently this is how I say sorry.`;

            if (navigator.share) {
                try {
                    await navigator.share({ title, text, url: window.location.href });
                    return;
                } catch (e) {}
            }

            const fallback = `${text}\n${window.location.href}`;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                try {
                    await navigator.clipboard.writeText(fallback);
                    alert("Result + link copied. Paste it into the chat where you start 80% of your fights.");
                    return;
                } catch (e) {}
            }

            alert("Share this:\n\n" + fallback);
        };
    </script>
</body>
</html>
