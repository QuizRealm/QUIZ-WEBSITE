<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="text/javascript" data-cmp-ab="1" src="https://cdn.consentmanager.net/delivery/autoblocking/fce42799c2318.js" data-cmp-host="d.delivery.consentmanager.net" data-cmp-cdn="cdn.consentmanager.net" data-cmp-codesrc="16"></script>
  <meta charset="UTF-8" />
      <link rel="manifest" href="assets/site.webmanifest">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:;">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JJNQCVEXT1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JJNQCVEXT1');
</script>

<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
<link rel="manifest" href="assets/site.webmanifest">
<link rel="shortcut icon" href="assets/favicon.ico">
<meta name="msapplication-TileColor" content="#020617">
<meta name="theme-color" content="#020617">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chronos Lexicon • Hangman v2</title>

  <!-- Tailwind + Fonts (same sources) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Outfit:wght@300;400;500;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Keep using the same site sources -->
  <script src="components.js" defer></script>
  <script src="data.js"></script>

  <!--
  ========================= WORD BANK THEME TEMPLATE =========================
  Save to ./wordbank.json (you can mix object or array styles – this shows object style).

  
  Notes:
  - _themes: optional. Keys must match category keys (normalized to lowercase).
  - Each theme controls page palette & background when that category is active.
  - If a category has no theme, a tasteful default is used.
  ===========================================================================
  -->

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Outfit','sans-serif'],
            arcade: ['Bungee','cursive'],
            mono: ['Share Tech Mono','monospace']
          }
        }
      }
    }
  </script>

  <style>
    :root{
      --bg-dark:#050810;             /* base */
      --text:#e5e7eb;                /* dynamic */
      --primary:#3b82f6;             /* dynamic */
      --accent:#fbbf24;              /* dynamic */
      --glow:#93c5fd;                /* dynamic */
      --glass:rgba(15,23,42,0.6);    /* dynamic */
      --bg-gradient: radial-gradient(65% 55% at 15% 40%, rgba(59,130,246,.10), transparent 45%), radial-gradient(60% 55% at 85% 20%, rgba(251,191,36,.08), transparent 45%);
      --bg-image: none;              /* url(...) optional */
    }

    body{
      min-height:100vh;
      color:var(--text);
      background-color:var(--bg-dark);
      background-image: var(--bg-gradient);
      background-repeat:no-repeat;
      background-attachment: fixed;
      position:relative;
      overflow-x:hidden;
    }
    body::before{ /* category background image overlay */
      content:"";
      position:fixed; inset:0; z-index:-1; pointer-events:none;
      background-image: var(--bg-image);
      background-size: cover; background-position:center;
      opacity:.15; filter:contrast(110%) saturate(110%);
    }

    .glass{ background:var(--glass); backdrop-filter: blur(14px); border:1px solid rgba(255,255,255,.08); box-shadow:0 12px 40px rgba(0,0,0,.35) }
    .foil{ position:relative; overflow:hidden }
    .foil::after{ content:""; position:absolute; inset:-200% -200%; background: conic-gradient(from 180deg at 50% 50%, transparent 0 10%, rgba(255,255,255,.07) 12%, transparent 14% 24%, rgba(255,255,255,.06) 26%, transparent 28%); transform: translate3d(0,0,0); animation: foilSweep 9s linear infinite; mix-blend-mode: screen; }
    @keyframes foilSweep{ to{ transform: translate3d(50%,50%,0) rotate(1turn);} }

    .soft-glow{ box-shadow:0 0 0 2px rgba(255,255,255,.05), 0 0 30px var(--glow); }
    .key{ box-shadow:0 6px 0 rgba(0,0,0,.5); transition:transform .08s ease, box-shadow .08s ease; }
    .key:active{ transform: translateY(6px); box-shadow:0 0 0 rgba(0,0,0,0); }

    .hang line, .hang circle{ filter: drop-shadow(0 0 6px rgba(255,255,255,.07)); }
    .draw{ stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: draw 1s ease forwards; }
    @keyframes draw{ to{ stroke-dashoffset:0 } }
  </style>
</head>
<body class="flex flex-col antialiased selection:bg-white selection:text-black">
  <quiz-header></quiz-header>

  <!-- HERO: category‑skinned banner -->
  <section class="max-w-6xl w-full mx-auto px-4 md:px-6 mt-6">
    <div class="glass rounded-3xl overflow-hidden foil relative border border-white/10">
      <div class="absolute top-4 left-4 flex items-center gap-2 px-3 py-1 rounded-full bg-black/60 border border-white/10 backdrop-blur-sm">
        <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
        <span class="text-[10px] font-mono uppercase tracking-widest">Live Preview</span>
      </div>

      <div class="relative aspect-video">
        <video id="hero-video" class="w-full h-full object-cover" autoplay muted playsinline loop></video>
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>
      </div>

      <div class="absolute inset-x-0 bottom-0 p-6 md:p-8 flex items-end justify-between">
        <div>
          <h1 class="text-2xl md:text-4xl font-arcade text-white drop-shadow-xl tracking-tight">
            Chronos <span class="text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent)] to-white">Lexicon</span>
          </h1>
          <p id="hero-tag" class="text-xs font-mono tracking-widest opacity-80 mt-1">Word Puzzle • Category Mode</p>
        </div>
        <div class="hidden sm:flex items-center gap-2 text-[11px] font-mono">
          <span class="px-2 py-1 rounded bg-black/60 border border-white/10">Theme: <span id="hero-theme">Default</span></span>
        </div>
      </div>
    </div>
  </section>


  
  <!-- Stats Strip -->
  <section class="max-w-6xl w-full mx-auto px-4 md:px-6 mt-4">
    <div class="glass rounded-2xl px-5 md:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div id="level-badge" class="w-12 h-12 rounded-full flex items-center justify-center font-bold text-black bg-[var(--accent)] soft-glow">1</div>
        <div>
          <div class="text-[10px] text-slate-400 uppercase tracking-widest font-mono">Your Level</div>
          <div id="rank-title" class="text-white font-bold">Beginner</div>
        </div>
      </div>
      <div class="hidden md:block flex-1 mx-8">
        <div class="flex justify-between text-[10px] text-slate-400 mb-1 font-mono"><span>Progress</span><span id="xp-text">0 XP</span></div>
        <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
          <div id="xp-bar" class="h-full w-0 transition-all duration-500" style="background:linear-gradient(90deg,var(--primary),var(--accent))"></div>
        </div>
      </div>
      <div class="text-right">
        <div class="text-[10px] text-slate-400 uppercase tracking-widest font-mono">Win Streak</div>
        <div class="text-[var(--accent)] font-bold text-xl font-arcade flex items-center gap-2"><i class="fas fa-fire"></i> <span id="streak-count">0</span></div>
      </div>
    </div>
  </section>

  <!-- Category switcher (skinned buttons) -->
  <section class="max-w-6xl w-full mx-auto px-4 md:px-6 mt-6">
    <div class="glass rounded-2xl p-5 md:p-8">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <div>
          <p class="text-[10px] uppercase tracking-[0.25em] text-slate-400 font-mono mb-1">Category Mode</p>
          <h2 id="current-category-title" class="text-xl md:text-2xl font-arcade text-white">Original Pack</h2>
          <p id="current-category-subtitle" class="text-xs md:text-sm text-slate-400">Mix of all categories in your Hangman word bank.</p>
        </div>
        <span class="text-[10px] font-mono px-3 py-1 rounded-full bg-black/50 border border-white/10"> <span id="category-count-label">0 categories</span> </span>
      </div>
      <div id="category-list" class="mt-4 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2"></div>
    </div>
  </section>

  <!-- Game grid -->
  <section class="max-w-6xl w-full mx-auto px-4 md:px-6 mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Gallows / Lives -->
    <div class="lg:col-span-4">
      <div class="glass rounded-2xl p-6 relative min-h-[360px]">
        <div class="absolute top-4 left-6 flex items-center gap-2 text-[10px] font-mono tracking-widest"><span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span><span>Lives</span></div>
        <div class="absolute top-4 right-6 text-xs font-mono text-slate-400">ATTEMPTS: <span id="lives-count" class="text-white font-bold text-lg">6</span></div>

        <div class="relative w-full max-w-[260px] mx-auto mt-4">
            <!-- particle canvas overlay -->
            <canvas id="hang-particles" class="absolute inset-0 pointer-events-none"></canvas>

            <svg viewBox="0 0 200 250" class="w-full h-full hang">
                <!-- base builds in -->
                <line x1="20" y1="240" x2="180" y2="240" stroke="#2d3545" stroke-width="6" stroke-linecap="round" class="g-anim"/>
                <line x1="50" y1="240" x2="50" y2="20"  stroke="#2d3545" stroke-width="6" stroke-linecap="round" class="g-anim" style="animation-delay:.08s"/>
                <line x1="50" y1="20"  x2="130" y2="20" stroke="#2d3545" stroke-width="6" stroke-linecap="round" class="g-anim" style="animation-delay:.16s"/>
                <!-- rope -->
                <g id="rope" class="rope">
                <line x1="130" y1="20" x2="130" y2="50" stroke="var(--accent)" stroke-width="3" stroke-linecap="round" class="g-anim" style="animation-delay:.24s"/>
                </g>

                <!-- figure grouped so we can sway/fall -->
                <g id="figure" stroke="var(--primary)" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"
                class="figure">
                <circle id="part-0" cx="130" cy="70" r="15" class="hidden draw"/>
                <line id="part-1" x1="130" y1="85" x2="130" y2="150" class="hidden draw"/>
                <line id="part-2" x1="130" y1="100" x2="100" y2="130" class="hidden draw"/>
                <line id="part-3" x1="130" y1="100" x2="160" y2="130" class="hidden draw"/>
                <line id="part-4" x1="130" y1="150" x2="100" y2="200" class="hidden draw"/>
                <line id="part-5" x1="130" y1="150" x2="160" y2="200" class="hidden draw"/>
                </g>
            </svg>
            </div>


        <div class="mt-6">
          <div class="h-1.5 bg-slate-800 rounded-full overflow-hidden">
            <div id="health-bar" class="h-full w-full transition-all duration-300" style="background:linear-gradient(90deg,#16a34a,#ca8a04)"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Word & Keyboard -->
    <div class="lg:col-span-8 flex flex-col gap-4">
      <div class="glass rounded-2xl p-6 md:p-8 text-center">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 mb-5">
          <i class="fas fa-magnifying-glass"></i>
          <span id="category-hint" class="text-xs font-bold uppercase tracking-widest">Category</span>
        </div>
        <div id="word-container" class="flex flex-wrap justify-center gap-2 md:gap-3 w-full"></div>
        <div id="instruction-text" class="mt-6 text-slate-500 text-xs font-mono">Select a letter to guess…</div>
      </div>

      <div class="glass rounded-2xl p-4 md:p-6">
        <div id="keyboard-container" class="grid grid-cols-10 gap-1.5 md:gap-2 max-w-3xl mx-auto"></div>
      </div>
    </div>
  </section>

  <!-- About / How to -->
  <section class="max-w-6xl w-full mx-auto px-4 md:px-6 mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="glass rounded-2xl p-6 md:p-8">
      <h2 class="text-lg font-arcade mb-2"><i class="fas fa-database text-[var(--accent)] mr-2"></i> About the Game</h2>
      <p id="about-text" class="text-sm text-slate-300">Chronos Lexicon is a word puzzle game where you guess names, places, and objects from your chosen category—or mix them all.</p>
      <div class="flex items-center gap-3 text-xs text-slate-400 font-mono mt-3">
        <span class="inline-flex items-center gap-1"><i class="fas fa-check text-emerald-400"></i> Daily Play</span>
        <span>•</span>
        <span class="inline-flex items-center gap-1"><i class="fas fa-brain text-[var(--primary)]"></i> Brain Training</span>
      </div>
    </div>
    <div class="glass rounded-2xl p-6 md:p-8">
      <h3 class="text-sm font-bold uppercase tracking-wider mb-3">How to Play</h3>
      <ul class="space-y-3 text-sm text-slate-300">
        <li class="flex items-start gap-3"><span class="w-6 h-6 rounded bg-slate-800 flex items-center justify-center text-[var(--accent)] font-mono text-xs">1</span>Check the <strong>category & hint</strong> above the word.</li>
        <li class="flex items-start gap-3"><span class="w-6 h-6 rounded bg-slate-800 flex items-center justify-center text-[var(--accent)] font-mono text-xs">2</span>Click letters to guess. You can make <strong>6 mistakes</strong>.</li>
        <li class="flex items-start gap-3"><span class="w-6 h-6 rounded bg-slate-800 flex items-center justify-center text-[var(--accent)] font-mono text-xs">3</span>Win to build your <strong>streak</strong>, gain XP and level up.</li>
      </ul>
    </div>
  </section>

  <!-- Modal (Win/Lose) -->
  <div id="game-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
    <div id="modal-content" class="w-full max-w-lg glass rounded-2xl overflow-hidden border border-white/10 opacity-0 scale-95 transition-all">
      <div id="modal-header-bg" class="p-8 text-center border-b border-white/5">
        <div id="modal-icon-container" class="w-20 h-20 mx-auto rounded-full flex items-center justify-center text-4xl mb-4 border-2">
          <i id="modal-icon" class="fas fa-check"></i>
        </div>
        <h2 id="modal-title" class="text-3xl font-arcade">SOLVED</h2>
        <p id="modal-subtitle" class="text-xs font-mono tracking-widest opacity-70">Great Job!</p>
      </div>
      <div class="p-8 bg-[#0b1020]">
        <div class="grid gap-4">
          <div>
            <div class="text-[10px] text-[var(--accent)] uppercase tracking-widest font-bold mb-1">The Word</div>
            <div id="modal-word" class="text-2xl text-white font-bold">THE WORD</div>
          </div>
          <div class="pl-4 border-l-2" style="border-color:color-mix(in oklab, var(--primary) 30%, transparent)">
            <div class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">Did you know?</div>
            <p id="modal-desc" class="text-sm text-slate-300">Description goes here…</p>
          </div>
          <div class="grid grid-cols-2 gap-4 p-4 rounded-lg border border-white/5 bg-black/30">
            <div class="text-center">
              <div class="text-[10px] text-slate-500 uppercase">XP Gained</div>
              <div id="modal-xp" class="text-emerald-400 font-bold font-mono text-lg">+150</div>
            </div>
            <div class="text-center">
              <div class="text-[10px] text-slate-500 uppercase">Streak</div>
              <div id="modal-streak" class="text-[var(--accent)] font-bold font-mono text-lg">3x</div>
            </div>
          </div>
        </div>
        <button onclick="Game.nextRound()" class="mt-8 w-full py-4 rounded-lg font-bold uppercase tracking-widest text-black transition-all" style="background:linear-gradient(90deg,var(--accent),#fff)">Next Round <i class="fas fa-arrow-right ml-2"></i></button>
      </div>
    </div>
  </div>

  <!-- Achievement Toast -->
  <div id="achievement-toast" class="fixed bottom-8 right-8 z-50 hidden">
    <div class="glass p-4 rounded-xl border-l-4" style="border-left-color:var(--accent)">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-xl" style="background:color-mix(in oklab, var(--accent) 20%, transparent); color:var(--accent)"><i class="fas fa-trophy"></i></div>
        <div>
          <h4 class="text-white font-bold text-sm">Achievement Unlocked</h4>
          <div id="ach-name" class="text-[var(--accent)] text-xs font-bold">The Historian</div>
          <div id="ach-desc" class="text-[10px] text-slate-400">Solved 5 puzzles in a row.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="w-full max-w-[1200px] mx-auto px-6 mt-10">
    <quiz-seo-content></quiz-seo-content>
  </div>
  <quiz-footer></quiz-footer>

  <script>
    // ========================= CATEGORY + THEME ENGINE =========================
    let WORD_BANK = [];
    let WORD_BANK_BY_CATEGORY = {};
    let THEMES = {};
    let CURRENT_CATEGORY_KEY = 'all';

    const DEFAULT_THEME = {
      label: 'Original',
      icon: 'fa-shuffle',
      palette: { primary: '#3b82f6', accent:'#fbbf24', glow:'#93c5fd', text:'#e5e7eb', glass:'rgba(15,23,42,0.6)' },
      bg: { gradient: 'radial-gradient(60% 55% at 20% 30%, rgba(59,130,246,.10), transparent 45%), radial-gradient(60% 55% at 80% 20%, rgba(251,191,36,.08), transparent 45%)', image: '' },
      media: { video: 'assets/hangmanvid1.mp4', pattern: 'grid' }
    };
    // --- particles over the svg
    const Particles = (() => {
    const canvas = document.getElementById('hang-particles');
    const ctx = canvas.getContext('2d');
    let w, h, items = [];
    function resize(){ const svg = canvas.parentElement.querySelector('svg'); w=canvas.width=svg.clientWidth; h=canvas.height=svg.clientHeight; }
    window.addEventListener('resize', resize); resize();

    function burst(x=130, y=90, color=getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#fbbf24'){
        for(let i=0;i<22;i++){
        const ang = Math.random()*Math.PI*2, sp = 1+Math.random()*2;
        items.push({ x, y, vx: Math.cos(ang)*sp, vy: Math.sin(ang)*sp, life: 24, color });
        }
    }
    function step(){
        ctx.clearRect(0,0,w,h);
        items = items.filter(p=>p.life>0);
        items.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.vy += .08; p.life--;
        ctx.globalAlpha = Math.max(p.life/24,0); ctx.fillStyle = p.color;
        ctx.beginPath(); ctx.arc(p.x, p.y, 1.8, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(step);
    }
    step();
    return { burst };
    })();

    function normalizeCategory(raw){ return (raw||'general').toString().trim().toLowerCase(); }

    function getPrettyCategoryName(key){
      if(!key || key==='all') return 'Original';
      return key.replace(/[_-]+/g,' ').replace(/\s+/g,' ').trim().replace(/\b\w/g, c=>c.toUpperCase());
    }

    function getCategoryFromURL(){
      const params = new URLSearchParams(location.search); const cat = params.get('category');
      return cat ? normalizeCategory(cat) : null;
    }

    function getCurrentPool(){ return CURRENT_CATEGORY_KEY==='all' ? WORD_BANK : (WORD_BANK_BY_CATEGORY[CURRENT_CATEGORY_KEY]||WORD_BANK); }

    function applyTheme(key){
      const theme = key==='all' ? DEFAULT_THEME : (THEMES[key] || DEFAULT_THEME);
      const root = document.documentElement;
      root.style.setProperty('--text', theme.palette?.text || DEFAULT_THEME.palette.text);
      root.style.setProperty('--primary', theme.palette?.primary || DEFAULT_THEME.palette.primary);
      root.style.setProperty('--accent', theme.palette?.accent || DEFAULT_THEME.palette.accent);
      root.style.setProperty('--glow', theme.palette?.glow || DEFAULT_THEME.palette.glow);
      root.style.setProperty('--glass', theme.palette?.glass || DEFAULT_THEME.palette.glass);
      root.style.setProperty('--bg-gradient', theme.bg?.gradient || DEFAULT_THEME.bg.gradient);
      root.style.setProperty('--bg-image', theme.bg?.image ? `url('${theme.bg.image}')` : 'none');

      const heroVideo = document.getElementById('hero-video');
      const src = (theme.media && theme.media.video) ? theme.media.video : DEFAULT_THEME.media.video;
      if(heroVideo && heroVideo.getAttribute('data-src')!==src){ heroVideo.src = src; heroVideo.setAttribute('data-src', src); heroVideo.play().catch(()=>{}); }

      document.getElementById('hero-theme').textContent = getPrettyCategoryName(key);
      document.getElementById('hero-tag').textContent = `${getPrettyCategoryName(key)} • Word Puzzle`;
    }



    
    function buildCategoryUI(){
      const container = document.getElementById('category-list');
      const countLabel = document.getElementById('category-count-label');
      const basePath = location.pathname.split('/').pop() || 'hangman.html';

      container.innerHTML = '';

      const entries = [{ key:'all', label:'Original', description:'Mix of all categories.', href: basePath }];
      Object.keys(WORD_BANK_BY_CATEGORY).sort().forEach(key=>{
        entries.push({ key, label:getPrettyCategoryName(key), description:`Only ${getPrettyCategoryName(key)} words.`, href: `${basePath}?category=${encodeURIComponent(key)}` });
      });

      const realCount = Math.max(0, entries.length - 1);
      countLabel.textContent = realCount === 1 ? '1 category' : `${realCount} categories`;

      entries.forEach(entry=>{
        const theme = entry.key==='all'? DEFAULT_THEME : (THEMES[entry.key]||DEFAULT_THEME);
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.dataset.categoryKey = entry.key;
        btn.className = 'group w-full text-left px-3 py-2 rounded-xl border text-xs md:text-sm transition-all';
        btn.style.borderColor = 'rgba(255,255,255,.08)';
        btn.style.background = 'rgba(0,0,0,.35)';
        btn.innerHTML = `
          <span class="flex items-center justify-between gap-2">
            <span class="font-semibold flex items-center gap-2"><i class="fas ${theme.icon||'fa-shuffle'} text-[var(--accent)]"></i>${entry.label}</span>
            <span class="text-[10px] uppercase tracking-widest text-slate-500 group-hover:text-[var(--accent)]">Play</span>
          </span>
          <span class="text-[11px] text-slate-400">${entry.description}</span>`;
        btn.addEventListener('click', ()=>{ location.href = entry.href; });
        if(entry.key===CURRENT_CATEGORY_KEY) btn.classList.add('ring-2');
        container.appendChild(btn);
      });

      // Header label
      const titleEl = document.getElementById('current-category-title');
      const subtitleEl = document.getElementById('current-category-subtitle');
      titleEl.textContent = CURRENT_CATEGORY_KEY==='all' ? 'Original Pack' : getPrettyCategoryName(CURRENT_CATEGORY_KEY);
      subtitleEl.textContent = CURRENT_CATEGORY_KEY==='all' ? 'Mix of all categories in your Hangman word bank.' : `Only words from the "${getPrettyCategoryName(CURRENT_CATEGORY_KEY)}" category.`;
    }

    async function loadWordBank(){
      try{
        const res = await fetch('wordbank.json', { cache:'no-store' });
        if(!res.ok) throw new Error('Failed to load wordbank.json');
        const raw = await res.json();

        WORD_BANK = []; WORD_BANK_BY_CATEGORY = {}; THEMES = raw._themes || {};

        if(Array.isArray(raw)){
          raw.filter(x=>x && typeof x.word==='string' && x.word.trim()).forEach(item=>{
            const cat = normalizeCategory(item.category);
            const obj = { word:item.word.toUpperCase().trim(), hint:item.hint||'General', desc:item.desc||'No description yet.', category: cat };
            WORD_BANK.push(obj); (WORD_BANK_BY_CATEGORY[cat] ||= []).push(obj);
          })
        } else if (raw && typeof raw==='object'){
          Object.keys(raw).forEach(key=>{
            if(key==='_themes') return;
            const catKey = normalizeCategory(key);
            const arr = Array.isArray(raw[key]) ? raw[key] : [];
            arr.forEach(item=>{
              if(!item || typeof item.word!== 'string' || !item.word.trim()) return;
              const obj = { word:item.word.toUpperCase().trim(), hint:item.hint||'General', desc:item.desc||'No description yet.', category: catKey };
              WORD_BANK.push(obj); (WORD_BANK_BY_CATEGORY[catKey] ||= []).push(obj);
            });
          });
        }

        const urlCat = getCategoryFromURL();
        CURRENT_CATEGORY_KEY = (urlCat && WORD_BANK_BY_CATEGORY[urlCat]) ? urlCat : 'all';

      }catch(err){
        console.error(err);
        const backup = { word:'PARTHENON', hint:'Ancient Architecture', desc:'Backup entry because wordbank.json failed to load.', category:'history' };
        WORD_BANK=[backup]; WORD_BANK_BY_CATEGORY={ history:[backup] }; THEMES={}; CURRENT_CATEGORY_KEY='history';
      }

      applyTheme(CURRENT_CATEGORY_KEY);
      buildCategoryUI();
    }

    // =============================== GAME LOGIC ===============================
    const Game = {
      state: { currentWordObj:null, guessed:new Set(), mistakes:0, maxMistakes:6, isGameOver:false, streak:0, xp:0, level:1, unlocked:[] },
      el: {
        word: null, keys:null, lives:null, bar:null, hint:null, modal:null,
        parts:[], about:null, instruction:null
      },
      init(){
        this.el.word = document.getElementById('word-container');
        this.el.keys = document.getElementById('keyboard-container');
        this.el.lives = document.getElementById('lives-count');
        this.el.bar = document.getElementById('health-bar');
        this.el.hint = document.getElementById('category-hint');
        this.el.modal = document.getElementById('game-modal');
        this.el.parts = [0,1,2,3,4,5].map(i=>document.getElementById(`part-${i}`));
        this.el.about = document.getElementById('about-text');
        this.el.instruction = document.getElementById('instruction-text');

        this.loadProfile();
        this.nextRound();
      },
      loadProfile(){
        const save = JSON.parse(localStorage.getItem('chronos_hangman_save_v2'))||{};
        this.state.xp = save.xp||0; this.state.level=save.level||1; this.state.streak=save.streak||0; this.updateHeader();
      },
      saveProfile(){
        localStorage.setItem('chronos_hangman_save_v2', JSON.stringify({ xp:this.state.xp, level:this.state.level, streak:this.state.streak }));
        this.updateHeader();
      },
      updateHeader(){
        document.getElementById('level-badge').innerText = this.state.level;
        const titles=["Beginner","Learner","Scholar","Expert","Master","Legend"]; const idx=Math.min(Math.floor(this.state.level/2), titles.length-1);
        document.getElementById('rank-title').innerText = titles[idx];
        document.getElementById('xp-text').innerText = `${this.state.xp} XP`;
        document.getElementById('xp-bar').style.width = `${(this.state.xp%100)}%`;
        document.getElementById('streak-count').innerText = this.state.streak;
      },

// add inside Game = { ... }
hideModal(){
  const modal = this.el.modal;
  const content = document.getElementById('modal-content');
  if(!modal || !content) return;
  // reset transition state
  content.classList.remove('opacity-100','scale-100');
  content.classList.add('opacity-0','scale-95');
  modal.classList.add('hidden');
},
showModal(win, xp){
  const modal=this.el.modal;
  const content=document.getElementById('modal-content');
  // ... keep your existing showModal code ...
  modal.classList.remove('hidden');
  requestAnimationFrame(()=>{ 
    content.classList.remove('opacity-0','scale-95'); 
    content.classList.add('opacity-100','scale-100'); 
  });
},



      nextRound(){
        this.hideModal();
        const pool = getCurrentPool();
        if(!pool.length){ this.el.word.innerHTML = '<p class="text-sm text-red-400">No words for this category.</p>'; return; }
        this.state.mistakes=0; this.state.guessed.clear(); this.state.isGameOver=false;
        this.state.currentWordObj = pool[Math.floor(Math.random()*pool.length)];

        this.el.parts.forEach(p=>p.classList.add('hidden'));
        this.el.bar.style.width = '100%';
        this.el.lives.textContent = this.state.maxMistakes;

        const catKey = this.state.currentWordObj.category || CURRENT_CATEGORY_KEY;
        const pretty = getPrettyCategoryName(catKey).toUpperCase();
        const hintText = this.state.currentWordObj.hint || 'General';
        this.el.hint.textContent = `${pretty} • ${hintText}`;
        if(this.el.about) this.el.about.textContent = `Guess names, places, and objects from the "${getPrettyCategoryName(catKey)}" category—or mix them all.`;

        this.renderBoard();
        this.renderKeyboard();
      },
      renderBoard(){
        const w = this.state.currentWordObj.word; this.el.word.innerHTML='';
        w.split('').forEach(ch=>{
          if(ch===' '){ const gap=document.createElement('div'); gap.className='w-4 h-10 md:w-6'; this.el.word.appendChild(gap); return; }
          const slot=document.createElement('div');
          const guessed=this.state.guessed.has(ch);
          slot.className = `w-10 h-14 md:w-12 md:h-16 border-b-4 flex items-center justify-center text-3xl md:text-4xl font-serif font-bold transition-all ${guessed? 'border-[var(--accent)] text-white -translate-y-0.5 soft-glow' : 'border-slate-700 text-transparent'}`;
          slot.textContent = ch; this.el.word.appendChild(slot);
        });
      },
      renderKeyboard(){
        this.el.keys.innerHTML='';
        const rows=["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"];
        rows.forEach(row=>{
          const rowDiv=document.createElement('div'); rowDiv.className='col-span-10 flex justify-center gap-1.5 md:gap-2';
          row.split('').forEach(ch=>{
            const used=this.state.guessed.has(ch);
            const btn=document.createElement('button');
            btn.textContent=ch; btn.disabled=used || this.state.isGameOver; btn.className='key w-8 h-10 md:w-10 md:h-12 rounded border font-mono font-bold text-sm md:text-base';
            if(used){
              if(this.state.currentWordObj.word.includes(ch)){
                btn.style.cssText='background:color-mix(in oklab, var(--accent) 90%, white 10%); color:black; border-color:transparent; box-shadow:0 0 14px color-mix(in oklab, var(--accent) 50%, transparent)';
              }else{
                btn.style.cssText='background:#0b1020; color:#64748b; border-color:#0f172a; opacity:.6';
              }
            } else {
              btn.style.cssText='background:rgba(255,255,255,.06); color:#cbd5e1; border-color:rgba(255,255,255,.08)';
            }
            btn.addEventListener('click', ()=>this.handleGuess(ch));
            rowDiv.appendChild(btn);
          }); this.el.keys.appendChild(rowDiv);
        })
      },
      handleGuess(ch){
        if(this.state.isGameOver || this.state.guessed.has(ch)) return;
        this.state.guessed.add(ch);
        const hit = this.state.currentWordObj.word.includes(ch);
        if(hit){ this.state.xp += 5; this.saveProfile(); } else { this.addMistake(); }
        this.renderBoard(); this.renderKeyboard(); this.checkState();
      },
      addMistake(){
        const idx=this.state.mistakes; const part=this.el.parts[idx]; if(part){ part.classList.remove('hidden'); part.style.animation='none'; part.offsetHeight; part.style.animation=null; }
        this.state.mistakes++;
        const remaining=this.state.maxMistakes - this.state.mistakes; this.el.lives.textContent=remaining;
        this.el.bar.style.width = `${(remaining/this.state.maxMistakes)*100}%`;
        if(remaining<=2){ this.el.bar.style.background='linear-gradient(90deg,#ef4444,#b91c1c)'; }
        else if(remaining<=4){ this.el.bar.style.background='linear-gradient(90deg,#f59e0b,#d97706)'; }
      },
      checkState(){
        const letters=this.state.currentWordObj.word.split('').filter(c=>c!==' ');
        const win = letters.every(c=>this.state.guessed.has(c));
        if(win) return this.handleWin();
        if(this.state.mistakes>=this.state.maxMistakes) return this.handleLoss();
      },
      handleWin(){
        this.state.isGameOver = true; this.state.streak++;
        let earned = 50 + (this.state.streak*10); this.state.xp += earned;
        if(this.state.xp >= this.state.level*100){ this.state.level++; this.toast('Level Up!', `Reached Rank ${this.state.level}`); }
        if(this.state.streak===3) this.toast('On Fire', '3 Win Streak');
        this.saveProfile(); this.showModal(true, earned);
      },
      handleLoss(){ this.state.isGameOver=true; this.state.streak=0; this.saveProfile(); this.showModal(false, 0); },
      toast(title,desc){
        const t=document.getElementById('achievement-toast');
        document.getElementById('ach-name').innerText=title; document.getElementById('ach-desc').innerText=desc;
        t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 3500);
      },
      showModal(win, xp){
        const modal=this.el.modal; const content=document.getElementById('modal-content');
        document.getElementById('modal-word').innerText = this.state.currentWordObj.word;
        document.getElementById('modal-desc').innerText = this.state.currentWordObj.desc;
        document.getElementById('modal-xp').innerText = `+${xp}`;
        document.getElementById('modal-streak').innerText = `${this.state.streak}x`;

        if(win){
          document.getElementById('modal-header-bg').style.background = 'linear-gradient(180deg, color-mix(in oklab, var(--primary) 25%, transparent), transparent)';
          const iconWrap=document.getElementById('modal-icon-container'); iconWrap.style.borderColor='var(--primary)'; iconWrap.style.color='var(--primary)'; iconWrap.style.background='color-mix(in oklab, var(--primary) 15%, transparent)';
          document.getElementById('modal-icon').className='fas fa-check';
          document.getElementById('modal-title').className='text-3xl font-arcade text-white';
          document.getElementById('modal-title').innerText='SOLVED';
        }else{
          document.getElementById('modal-header-bg').style.background = 'linear-gradient(180deg, rgba(239,68,68,.25), transparent)';
          const iconWrap=document.getElementById('modal-icon-container'); iconWrap.style.borderColor='#ef4444'; iconWrap.style.color='#ef4444'; iconWrap.style.background='rgba(239,68,68,.1)';
          document.getElementById('modal-icon').className='fas fa-times';
          document.getElementById('modal-title').className='text-3xl font-arcade text-red-400';
          document.getElementById('modal-title').innerText='GAME OVER';
        }
        modal.classList.remove('hidden'); requestAnimationFrame(()=>{ content.classList.remove('opacity-0','scale-95'); content.classList.add('opacity-100','scale-100'); });
      }
    };

    // =============================== BOOT ===============================
    document.addEventListener('keydown', (e)=>{ const ch=e.key?.toUpperCase(); if(/^[A-Z]$/.test(ch)) Game.handleGuess(ch); });
    document.addEventListener('DOMContentLoaded', async ()=>{
      const instruction=document.getElementById('instruction-text'); if(instruction) instruction.textContent='> Loading words…';
      await loadWordBank(); if(instruction) instruction.textContent='Select a letter to guess…';
      applyTheme(CURRENT_CATEGORY_KEY); Game.init();
    });


    // In Game.addMistake(), after you update lives/health:
document.getElementById('figure').classList.add('hit');
document.getElementById('rope').classList.add('hit');
Particles.burst(130, 90); // around the head
setTimeout(()=>{
  document.getElementById('figure').classList.remove('hit');
  document.getElementById('rope').classList.remove('hit');
}, 180);
// In Game.handleLoss() before showModal(false,...)
document.getElementById('rope').classList.add('cut');
document.getElementById('figure').classList.add('fall');
Particles.burst(130, 50); // rope snap
setTimeout(()=>{ this.showModal(false, 0); }, 550);

  </script>
</body>
</html>
