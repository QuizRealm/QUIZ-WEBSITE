<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-ML3F7KLZ');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Red Flag Audit • Toxic Traits Test | QuizRealm</title>
    <meta name="description" content="A brutally honest 13-question red flag test about your dating habits, accountability and emotional chaos. Discover your toxic traits profile and get a shareable result card.">
    <meta name="theme-color" content="#020617">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="/components.js" defer></script>
    <script type="module" src="/game-engine.js"></script>
    <script type="module" src="/assets/ux-core.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ['Space Grotesk', 'sans-serif'],
                        body: ['Inter', 'sans-serif']
                    },
                    colors: {
                        ink: '#020617',
                        panel: '#020617',
                        panelSoft: '#020617',
                        card: '#020617',
                        accentRed: '#f97373',
                        accentDeep: '#b91c1c',
                        textSoft: '#9ca3af'
                    },
                    boxShadow: {
                        card: '0 24px 80px rgba(0,0,0,0.8)',
                        ring: '0 0 0 1px rgba(248, 113, 113, 0.4), 0 24px 80px rgba(0,0,0,0.9)'
                    },
                    borderRadius: {
                        card: '24px'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background: radial-gradient(circle at top, #111827 0, #020617 38%, #020617 100%);
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        .bg-texture {
            position: relative;
        }
        .bg-texture::before {
            content: "";
            position: fixed;
            inset: 0;
            opacity: 0.18;
            pointer-events: none;
            background-image:
                radial-gradient(circle at 0 0, rgba(148,163,184,0.1) 0, transparent 50%),
                radial-gradient(circle at 100% 0, rgba(248,113,113,0.08) 0, transparent 55%);
            mix-blend-mode: soft-light;
            z-index: -1;
        }
        .audit-card {
            background: radial-gradient(circle at top left, rgba(248,113,113,0.08), transparent 55%), #020617;
            border: 1px solid rgba(148,163,184,0.3);
            box-shadow: 0 24px 80px rgba(0,0,0,0.85);
        }
        .option-btn {
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(148,163,184,0.45);
            position: relative;
            overflow: hidden;
        }
        .option-btn::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 0 0, rgba(248,113,113,0.24), transparent 55%);
            opacity: 0;
            transition: opacity 0.18s ease-out;
        }
        .option-btn:hover::before {
            opacity: 1;
        }
        .option-btn:hover {
            transform: translateY(-1px);
            border-color: rgba(248,113,113,0.8);
        }
        .btn-main {
            background: #f9fafb;
            color: #020617;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            box-shadow: 0 18px 45px rgba(15,23,42,0.95);
        }
        .btn-main:hover {
            background: #ffffff;
            transform: translateY(-1px);
            box-shadow: 0 26px 70px rgba(15,23,42,1);
        }
        .pill-chip {
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.45);
            background: rgba(15,23,42,0.7);
        }
        .progress-track { background: rgba(15,23,42,0.9); height: 4px; border-radius: 999px; }
        .progress-fill { background: linear-gradient(to right,#f97373,#fb7185); height: 100%; width: 0%; border-radius: 999px; transition: width 0.4s ease; }

        .fade-up {
            opacity: 0;
            transform: translateY(16px);
            animation: fadeUp 0.45s ease-out forwards;
        }
        @keyframes fadeUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .share-card-gradient {
            background:
                radial-gradient(circle at top left, rgba(248,113,113,0.16), transparent 60%),
                radial-gradient(circle at bottom right, rgba(248,250,252,0.05), transparent 55%),
                #020617;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen bg-texture">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ML3F7KLZ"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <quiz-header></quiz-header>

    <main class="flex-grow w-full max-w-6xl mx-auto px-4 md:px-6 py-10 md:py-16 lg:py-20">

        <!-- START SCREEN -->
        <section id="start-screen" class="fade-up" style="animation-delay:0.05s">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 items-center">
                <!-- Left: Copy -->
                <div class="lg:col-span-7 space-y-7">
                    <div class="inline-flex items-center gap-2 pill-chip px-3 py-1 text-[10px] uppercase tracking-[0.25em] text-textSoft">
                        <span class="w-1.5 h-1.5 rounded-full bg-red-400 animate-pulse"></span>
                        <span>Dating & Personality Test</span>
                    </div>

                    <div>
                        <h1 class="font-display text-4xl sm:text-5xl md:text-6xl lg:text-7xl leading-[0.9] text-slate-50">
                            Red&nbsp;Flag<br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-300 via-red-500 to-red-700">
                                Audit
                            </span>
                        </h1>
                        <p class="mt-4 text-[15px] md:text-base text-textSoft max-w-xl">
                            A short, uncomfortably honest audit of how you behave in relationships:
                            jealousy, accountability, emotional messiness. No sugar coating, no “you’re perfect as you are.”
                        </p>
                    </div>

                    <div class="grid sm:grid-cols-[auto,1fr] gap-5 items-center">
                        <button
                            class="btn-main px-10 py-4 rounded-card text-xs tracking-[0.22em]"
                            onclick="window.startQuiz()">
                            Start the audit
                        </button>
                        <div class="flex flex-wrap gap-4 text-xs text-textSoft">
                            <span class="flex items-center gap-2">
                                <i class="fa-regular fa-clock text-red-300"></i>
                                ~3 minutes
                            </span>
                            <span class="flex items-center gap-2">
                                <i class="fa-solid fa-user-ninja text-red-300"></i>
                                No login · No email
                            </span>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3 text-[11px] text-slate-500">
                        <div class="pill-chip px-3 py-1 flex items-center gap-2">
                            <i class="fa-solid fa-flag text-xs text-red-400"></i>
                            <span>Red flag score · 7 result types</span>
                        </div>
                        <div class="pill-chip px-3 py-1">
                            Made for screenshots and sharing with friends who “aren’t the problem”.
                        </div>
                    </div>
                </div>

                <!-- Right: Preview / Social card -->
                <div class="lg:col-span-5">
                    <div class="audit-card rounded-card p-6 sm:p-7 lg:p-8 relative overflow-hidden">
                        <div class="absolute inset-x-0 -top-16 h-40 opacity-40 bg-gradient-to-b from-red-500/30 via-red-500/10 to-transparent blur-3xl"></div>
                        <div class="relative">
                            <div class="flex justify-between items-center mb-4 text-[11px] text-textSoft">
                                <span class="uppercase tracking-[0.3em] text-slate-300">Preview</span>
                                <span class="flex items-center gap-1">
                                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                                    <span>Result card · Shareable</span>
                                </span>
                            </div>

                            <div class="rounded-2xl border border-slate-700/70 share-card-gradient px-5 py-5 sm:px-6 sm:py-6 shadow-ring">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="px-2.5 py-1 rounded-full text-[10px] font-semibold tracking-[0.2em] uppercase bg-red-500/10 text-red-300 border border-red-500/40">
                                        Sample result
                                    </span>
                                    <span class="text-[11px] text-slate-400">
                                        Red&nbsp;Flag Score: <span class="text-red-300 font-semibold">78%</span>
                                    </span>
                                </div>

                                <h2 class="font-display text-2xl sm:text-3xl text-slate-50 mb-1">
                                    The Professional Victim
                                </h2>
                                <p class="text-[11px] uppercase tracking-[0.2em] text-red-300 mb-4">
                                    “Everyone is toxic except me.”
                                </p>

                                <p class="text-[13px] text-slate-300 leading-relaxed mb-4">
                                    You collect sympathy like it’s a reward system and treat responsibility
                                    like a personal attack. Your therapist would make a fortune.
                                </p>

                                <div class="flex items-center justify-between text-[11px] text-slate-400">
                                    <span>Tap to share · Tag the friend who needs this more than you.</span>
                                    <i class="fa-solid fa-share-nodes text-red-300"></i>
                                </div>
                            </div>

                            <p class="mt-4 text-[11px] text-slate-500 leading-relaxed">
                                This test is for entertainment, not diagnosis. If it hits a little too hard,
                                that’s between you and your Notes app.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- QUIZ INTERFACE -->
        <section id="quiz-interface" class="hidden h-full min-h-[60vh] max-w-3xl mx-auto pt-4">
            <div class="flex justify-between items-end mb-4">
                <span id="progress-text" class="text-[11px] font-mono text-red-300">Q 01 / 13</span>
                <span id="timer-display" class="text-[11px] font-mono text-textSoft">00:00</span>
            </div>

            <div class="progress-track w-full mb-8">
                <div id="progress-bar" class="progress-fill"></div>
            </div>

            <div class="space-y-8">
                <h2 id="question-text" class="font-display text-2xl md:text-3xl lg:text-4xl text-slate-50 leading-tight min-h-[4rem]">
                    Loading...
                </h2>

                <div id="options-container" class="space-y-4">
                    <!-- injected buttons -->
                </div>

                <div class="mt-6 flex justify-between items-center text-[11px] text-slate-500">
                    <span>Answer honestly. We’re judging you either way.</span>
                    <span>Tap once · No back button</span>
                </div>
            </div>
        </section>

        <!-- RESULT SCREEN -->
        <section id="result-screen" class="hidden max-w-5xl mx-auto pt-8">

            <!-- Hero Result Block / Share Card -->
            <div id="share-card" class="audit-card rounded-card p-6 sm:p-8 lg:p-10 mb-10 share-card-gradient">
                <div class="flex flex-wrap gap-3 justify-between items-center mb-6">
                    <div class="flex items-center gap-2 text-[11px] text-slate-400 uppercase tracking-[0.3em]">
                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                        <span>Red Flag Audit · Completed</span>
                    </div>
                    <div id="result-severity-chip" class="pill-chip px-3 py-1 text-[11px] text-slate-200 uppercase tracking-[0.25em]">
                        Mild red flags
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-[minmax(0,3fr),minmax(0,2fr)] gap-8 items-start">
                    <div>
                        <h2 id="result-title" class="font-display text-3xl sm:text-4xl lg:text-5xl text-slate-50 leading-tight mb-2">
                            Result Title
                        </h2>
                        <p id="result-subtitle" class="text-[12px] sm:text-xs md:text-sm uppercase tracking-[0.3em] text-red-300 mb-5">
                            Subtitle
                        </p>

                        <p id="result-summary" class="text-sm sm:text-[15px] text-slate-200 leading-relaxed mb-6 max-w-xl">
                            Summary text...
                        </p>

                        <ul id="result-tags" class="flex flex-wrap gap-2 text-[11px] text-slate-300">
                            <!-- generated small tags -->
                        </ul>
                    </div>

                    <div class="bg-black/40 border border-slate-700/70 rounded-2xl p-5 sm:p-6 flex flex-col gap-4">
                        <div class="flex justify-between items-center text-[11px] text-slate-400">
                            <span>Red Flag Score</span>
                            <span id="result-flag-score" class="text-slate-100 font-semibold text-sm">0%</span>
                        </div>
                        <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden">
                            <div id="result-flag-bar" class="h-full rounded-full bg-gradient-to-r from-emerald-400 via-amber-300 to-red-500" style="width:0%"></div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 pt-3 border-t border-slate-800 mt-2 text-[11px] text-slate-400">
                            <div>
                                <div class="text-[10px] uppercase tracking-[0.22em] mb-1">Time to admit it</div>
                                <div id="stat-time" class="text-base text-slate-50 font-mono">00s</div>
                            </div>
                            <div>
                                <div class="text-[10px] uppercase tracking-[0.22em] mb-1">Accountability</div>
                                <div id="stat-accountability" class="text-base text-slate-50 font-mono">Average</div>
                            </div>
                        </div>

                        <div class="mt-3 pb-1 text-[11px] text-slate-500">
                            Screenshot this card and send it to the friend who made you like this.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metrics + Breakdown -->
            <div class="grid grid-cols-1 lg:grid-cols-[minmax(0,3fr),minmax(0,2fr)] gap-8 mb-10">
                <!-- Metrics -->
                <div class="audit-card rounded-card p-6 sm:p-7">
                    <h3 class="text-[11px] uppercase tracking-[0.28em] text-slate-400 mb-5">
                        Your numbers (since you like attention)
                    </h3>

                    <div class="space-y-5 text-sm">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span>Narcissism</span>
                                <span id="score-narc" class="text-red-300">0%</span>
                            </div>
                            <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                <div id="bar-narc" class="h-full rounded-full bg-gradient-to-r from-slate-400 to-red-400" style="width:0%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between mb-1">
                                <span>Impulsivity</span>
                                <span id="score-imp" class="text-red-300">0%</span>
                            </div>
                            <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                <div id="bar-imp" class="h-full rounded-full bg-gradient-to-r from-slate-400 to-amber-400" style="width:0%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between mb-1">
                                <span>Empathy gap</span>
                                <span id="score-emp" class="text-red-300">0%</span>
                            </div>
                            <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                <div id="bar-emp" class="h-full rounded-full bg-gradient-to-r from-slate-400 to-rose-400" style="width:0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 text-[11px] text-slate-500 leading-relaxed">
                        These scores are based on how you reacted to conflict, boundaries and ego threats
                        across 13 questions. High does not mean “evil” — it just means your therapist
                        would never be bored.
                    </div>
                </div>

                <!-- Written breakdown -->
                <div class="audit-card rounded-card p-6 sm:p-7 flex flex-col gap-4">
                    <h3 class="text-[11px] uppercase tracking-[0.28em] text-slate-400">
                        What this says about you
                    </h3>

                    <p id="result-description" class="text-sm text-slate-200 leading-relaxed">
                        Detailed description loading...
                    </p>

                    <div id="quick-lines" class="mt-3 text-[12px] text-slate-400 space-y-2">
                        <!-- short bullets per archetype -->
                    </div>

                    <button
                        onclick="window.toggleFullReport()"
                        class="mt-4 text-left text-[12px] flex justify-between items-center border-t border-slate-800 pt-3 text-slate-300 hover:text-slate-100">
                        <span class="uppercase tracking-[0.26em] text-[11px]">
                            Open full breakdown
                        </span>
                        <i class="fa-solid fa-chevron-down text-xs text-red-300"></i>
                    </button>
                </div>
            </div>

            <!-- Full report expandable -->
            <div id="full-report" class="hidden audit-card rounded-card p-6 sm:p-7 mb-10 text-sm text-slate-200 leading-relaxed">
                <h3 class="text-[11px] uppercase tracking-[0.28em] text-slate-400 mb-4">
                    Full report: red flags, explained
                </h3>
                <p id="report-extra-1" class="mb-3">
                    <!-- filled dynamically -->
                </p>
                <p id="report-extra-2" class="mb-3">
                    <!-- filled dynamically -->
                </p>
                <p id="report-extra-3" class="italic text-slate-500 border-l border-red-500/60 pl-4">
                    This test is entertainment only. If parts of it feel a little too accurate, that is your cue
                    to talk to someone who is not a quiz on the internet.
                </p>
            </div>

            <!-- CTA row -->
            <div class="flex flex-col md:flex-row gap-4 md:items-center md:justify-between mb-12">
                <div class="flex flex-col gap-2 text-[12px] text-slate-400">
                    <span class="uppercase tracking-[0.26em] text-slate-300 text-[11px]">
                        Share your score
                    </span>
                    <span>
                        Either tap share or screenshot the big card above. Tag the people who would fail this test on question one.
                    </span>
                </div>

                <div class="flex flex-wrap gap-3">
                    <button
                        onclick="window.shareResults()"
                        class="btn-main px-6 py-3 rounded-full text-[11px] tracking-[0.24em] flex items-center gap-2 justify-center">
                        <i class="fa-solid fa-share-nodes text-xs"></i>
                        Share result
                    </button>

                    <button
                        onclick="window.retakeTest()"
                        class="px-5 py-3 rounded-full border border-slate-600 text-[11px] tracking-[0.24em] uppercase text-slate-200 hover:bg-white/5">
                        Retake
                    </button>

                    <a href="arcade.html"
                       class="px-5 py-3 rounded-full border border-slate-600 text-[11px] tracking-[0.24em] uppercase text-slate-200 hover:bg-white/5 flex items-center gap-2">
                        <i class="fa-solid fa-gamepad-modern text-xs"></i>
                        Try other games
                    </a>
                </div>
            </div>

            <!-- SEO CONTENT BLOCK -->
            <section class="border-t border-slate-800 pt-8 pb-4 text-[13px] md:text-[14px] text-slate-300 space-y-5">
                <h2 class="text-sm md:text-base font-semibold text-slate-100">
                    What is a “Red Flag Audit” and why do people share it?
                </h2>
                <p>
                    The Red Flag Audit is a short, brutally honest
                    <strong>toxic traits quiz</strong> designed to mirror how you act in real-world situations:
                    conflict, jealousy, secrets, apologies and self-control. Instead of asking “What is your favorite color?”,
                    it puts you in small social dilemmas and watches which way you lean.
                </p>
                <p>
                    People share their results because the labels are sarcastic, slightly insulting and
                    uncomfortably accurate. Whether you land on
                    <em>The Gaslighter</em>, <em>The Love Bomber</em>, or the suspiciously rare
                    <em>Unicorn</em>, your card becomes a conversation starter in group chats and stories.
                </p>

                <h3 class="text-sm md:text-base font-semibold text-slate-100">
                    A quick reminder before you overthink it
                </h3>
                <p>
                    This test is a reflection of habits, not a clinical diagnosis. Real personal work happens offline:
                    in therapy, in honest conversations, and in the small decisions you make when nobody is watching.
                    Use this result as a mirror, not a life sentence.
                </p>
            </section>
        </section>

    </main>

    <quiz-footer></quiz-footer>

    <script type="module">
        // ================= DATA (QUESTIONS + ARCHETYPES) =================
        const questions = [
            { q: "Your ex calls you at 2 AM. What is your immediate reflex?",
              a: [
                  { text: "Answer immediately. It might be drama I can use.", scores: { narc: 15, imp: 20, emp: 0,  acc: 0 } },
                  { text: "Ignore. They belong to the past.",                    scores: { narc: 0,  imp: 0,  emp: 0,  acc: 20 } },
                  { text: "Screenshot the call and post it to my story.",       scores: { narc: 25, imp: 10, emp: 20, acc: 0 } }
              ]
            },
            { q: "You are caught in a small lie. You...",
              a: [
                  { text: "Admit it instantly. No big deal.",                    scores: { narc: 0,  imp: 0,  emp: 0,  acc: 25 } },
                  { text: "Twist the story so I look like the victim.",          scores: { narc: 20, imp: 5,  emp: 15, acc: -10 } },
                  { text: "Accuse them of being paranoid for asking.",           scores: { narc: 30, imp: 10, emp: 25, acc: -20 } }
              ]
            },
            { q: "Your partner goes out with attractive friends. You feel...",
              a: [
                  { text: "Secure. Have a good night.",                          scores: { narc: 0,  imp: 0,  emp: 0,  acc: 10 } },
                  { text: "A need to text them every 20 minutes.",               scores: { narc: 10, imp: 15, emp: 0,  acc: 0 } },
                  { text: "Rage. I start a fight so they stay home.",            scores: { narc: 25, imp: 30, emp: 30, acc: -10 } }
              ]
            },
            { q: "How do you handle valid criticism?",
              a: [
                  { text: "I internalize it and try to improve.",                scores: { narc: 0,  imp: 0,  emp: 0,  acc: 20 } },
                  { text: "I cry until they apologize for hurting me.",          scores: { narc: 15, imp: 10, emp: 5,  acc: 0 } },
                  { text: "I attack their insecurities immediately.",            scores: { narc: 30, imp: 25, emp: 30, acc: -10 } }
              ]
            },
            { q: "Ideally, your partner should be...",
              a: [
                  { text: "My equal partner.",                                    scores: { narc: 0,  imp: 0,  emp: 0,  acc: 10 } },
                  { text: "Obsessed with me 24/7.",                              scores: { narc: 25, imp: 10, emp: 10, acc: 0 } },
                  { text: "Someone I can 'fix' or mold.",                        scores: { narc: 20, imp: 5,  emp: 15, acc: 0 } }
              ]
            },
            { q: "When you do a good deed, you...",
              a: [
                  { text: "Tell no one.",                                        scores: { narc: 0,  imp: 0,  emp: 0,  acc: 10 } },
                  { text: "Post it online. Impact is impact, right?",            scores: { narc: 20, imp: 0,  emp: 5,  acc: 0 } },
                  { text: "Bring it up in arguments later as leverage.",         scores: { narc: 30, imp: 5,  emp: 25, acc: -10 } }
              ]
            },
            { q: "A friend tells you a deep secret. You...",
              a: [
                  { text: "Take it to the grave.",                               scores: { narc: 0,  imp: 0,  emp: 0,  acc: 20 } },
                  { text: "Tell my partner, but nobody else.",                   scores: { narc: 5,  imp: 10, emp: 0,  acc: 0 } },
                  { text: "Tell the group chat. It's too juicy.",                scores: { narc: 20, imp: 25, emp: 25, acc: -10 } }
              ]
            },
            { q: "Someone breaks up with you. Your reaction?",
              a: [
                  { text: "Respect their decision and grieve.",                  scores: { narc: 0,  imp: 0,  emp: 0,  acc: 20 } },
                  { text: "Bombard them with texts and pleading.",               scores: { narc: 10, imp: 30, emp: 5,  acc: 0 } },
                  { text: "Burn their clothes / Slash tires.",                   scores: { narc: 25, imp: 40, emp: 30, acc: -20 } }
              ]
            },
            { q: "What is your relationship with 'The Truth'?",
              a: [
                  { text: "It is absolute.",                                     scores: { narc: 0,  imp: 0,  emp: 0,  acc: 20 } },
                  { text: "It is flexible depending on my mood.",                scores: { narc: 15, imp: 15, emp: 10, acc: -5 } },
                  { text: "What they don't know protects them.",                 scores: { narc: 20, imp: 5,  emp: 20, acc: -10 } }
              ]
            },
            { q: "How fast do you fall in love?",
              a: [
                  { text: "Slowly, over months.",                                scores: { narc: 0,  imp: 0,  emp: 0,  acc: 10 } },
                  { text: "Instantly. We move in after week 2.",                 scores: { narc: 15, imp: 30, emp: 5,  acc: 0 } },
                  { text: "I don't. I just like the chase.",                     scores: { narc: 25, imp: 10, emp: 25, acc: 0 } }
              ]
            },
            { q: "Your partner is crying about a bad day. You think...",
              a: [
                  { text: "How can I help them?",                                scores: { narc: 0,  imp: 0,  emp: 0,  acc: 10 } },
                  { text: "This is ruining my vibe.",                            scores: { narc: 20, imp: 5,  emp: 30, acc: 0 } },
                  { text: "They are being so dramatic for attention.",           scores: { narc: 25, imp: 10, emp: 30, acc: 0 } }
              ]
            },
            { q: "Apologizing makes you feel...",
              a: [
                  { text: "Relieved to fix things.",                             scores: { narc: 0,  imp: 0,  emp: 0,  acc: 20 } },
                  { text: "Weak and defeated.",                                  scores: { narc: 30, imp: 0,  emp: 10, acc: -10 } },
                  { text: "I only apologize to shut them up.",                   scores: { narc: 25, imp: 10, emp: 25, acc: -10 } }
              ]
            },
            { q: "Why did you click on this test?",
              a: [
                  { text: "Self-improvement.",                                   scores: { narc: 0,  imp: 0,  emp: 0,  acc: 10 } },
                  { text: "To prove I'm not the problem.",                       scores: { narc: 20, imp: 0,  emp: 10, acc: 0 } },
                  { text: "Because I love talking about myself.",                scores: { narc: 30, imp: 10, emp: 0,  acc: 0 } }
              ]
            }
        ];

        const archetypes = {
            Gaslighter: {
                title: "The Gaslighter",
                subtitle: "\"You're overreacting, I never said that.\"",
                summary: "You treat reality as something you can edit. You bend stories, feelings and facts until they fit the version where you’re never wrong.",
                desc: "Your results show very high narcissism paired with a serious empathy gap. You rarely take responsibility unless cornered, and even then, you’re more interested in winning the argument than fixing the damage.",
                bullets: [
                    "You weaponize calm tone and long texts to make other people doubt their memory.",
                    "You apologise for \"how they feel\", not for what you actually did.",
                    "People leave conversations with you feeling confused and guilty, even when they were the ones hurt."
                ]
            },
            LoveBomber: {
                title: "The Love Bomber",
                subtitle: "\"We just met, but I can already see forever.\"",
                summary: "You sprint into emotional intimacy, flood people with attention, then vanish the second it stops feeling exciting.",
                desc: "Your impulsivity score is doing laps. You chase intensity, not stability, and confuse obsession with connection. You’re excellent at first impressions and terrible at maintenance.",
                bullets: [
                    "You plan a future with someone before you know their last name.",
                    "You say \"I’ve never felt this way\" every three months.",
                    "When things calm down, you assume the relationship is dying instead of maturing."
                ]
            },
            Victim: {
                title: "The Professional Victim",
                subtitle: "\"Somehow, everyone keeps hurting me.\"",
                summary: "Nothing is your fault. The universe, your exes, and the group chat are all plotting against your peace.",
                desc: "You scored low on accountability and high on narcissism. You want sympathy without self-reflection. Every story has you as the main character and the injured party.",
                bullets: [
                    "You retell every conflict in a way that removes 100% of your responsibility.",
                    "Feedback feels like a personal attack, not an opportunity to grow.",
                    "You attract chaos, then act shocked when drama keeps finding you."
                ]
            },
            Vampire: {
                title: "The Emotional Vampire",
                subtitle: "\"Enough about your day, here’s everything wrong with mine.\"",
                summary: "You turn every interaction into an emotional drain. You unload, vent and spiral, but rarely hold space for anyone else.",
                desc: "Your empathy gap is loud. You use your problems as a social currency, but you rarely listen with the same intensity you demand.",
                bullets: [
                    "You say \"I don’t want to trauma-dump\" and then absolutely do.",
                    "You feel lighter after talking; other people feel exhausted.",
                    "You confuse being honest about your feelings with being considerate of theirs."
                ]
            },
            Ick: {
                title: "The Walking Ick",
                subtitle: "\"So anyway, can I get a hug?\"",
                summary: "You’re not malicious, just aggressively unaware. Boundaries, tone and timing are more of a suggestion in your world.",
                desc: "Your impulsivity is high and your awareness of social cues is… developing. You don’t mean harm, but you often come across as pushy, clingy or just a little too much.",
                bullets: [
                    "You overshare within 10 minutes of meeting someone.",
                    "You confuse persistence with charm.",
                    "You only notice a boundary after you’ve already crossed it."
                ]
            },
            Commitment: {
                title: "The Phantom",
                subtitle: "\"Let’s act like a couple, but never call it that.\"",
                summary: "You love connection as long as there’s a visible exit sign. You give just enough to keep people close, but not enough to feel vulnerable.",
                desc: "Your profile is relatively balanced but spikes in avoidance. You pride yourself on being \"chill\" while quietly dodging depth.",
                bullets: [
                    "You say \"I’m just going with the flow\" while steering away from every label.",
                    "You avoid difficult talks until the other person gives up.",
                    "You prefer almost-relationships: all the feelings, none of the responsibility."
                ]
            },
            Unicorn: {
                title: "The Unicorn",
                subtitle: "\"Alarmingly emotionally stable.\"",
                summary: "You communicate, take accountability and don’t create unnecessary chaos. Frankly, you seem suspicious.",
                desc: "Low scores across all red flag metrics. You likely have a secure attachment style, decent self-awareness and a healthy respect for other people’s feelings.",
                bullets: [
                    "You apologise without drama and mean it.",
                    "You don’t confuse intensity with love.",
                    "Your biggest red flag is probably that you send long, reasonable texts."
                ]
            }
        };

        // ================= STATE =================
        let currentQ = 0;
        let totalScores = { narc: 0, imp: 0, emp: 0, acc: 0 };
        let startTime = 0;
        let timerActive = false;

        // ================= HELPERS =================
        const $ = (id) => document.getElementById(id);

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, "0");
            const s = (seconds % 60).toString().padStart(2, "0");
            return `${m}:${s}`;
        }

        function computeFlagScore() {
            // Simple composite: narcissism + impulsivity + empathy gap, scaled
            const raw = totalScores.narc + totalScores.imp + totalScores.emp;
            const scaled = Math.max(0, Math.min(100, Math.round(raw / 4))); // rough cap
            return scaled;
        }

        function flagSeverityLabel(score) {
            if (score < 25) return "Suspiciously normal";
            if (score < 45) return "Mild red flags";
            if (score < 65) return "Manageable chaos";
            if (score < 85) return "Certified problem";
            return "Walking hazard";
        }

        function fillTags(archetypeKey, severityScore) {
            const container = $("result-tags");
            container.innerHTML = "";

            const tags = [];

            tags.push(archetypeKey === "Unicorn" ? "Emotionally stable (for now)" : "Certified red flag content");

            if (severityScore >= 70) tags.push("High-risk habits");
            else if (severityScore >= 45) tags.push("Work in progress");
            else tags.push("Mostly safe, slightly unhinged");

            if (totalScores.acc < 0) tags.push("Accountability issues");
            if (totalScores.emp > 60) tags.push("Empathy gap");
            if (totalScores.imp > 60) tags.push("Impulsive decisions");
            if (tags.length < 4) tags.push("Shareable result card");

            tags.slice(0, 5).forEach(t => {
                const span = document.createElement("span");
                span.className = "pill-chip px-3 py-1";
                span.textContent = t;
                container.appendChild(span);
            });
        }

        // ================= QUIZ FLOW =================
        window.startQuiz = function () {
            $("start-screen").classList.add("hidden");
            $("result-screen").classList.add("hidden");

            $("quiz-interface").classList.remove("hidden");

            currentQ = 0;
            totalScores = { narc: 0, imp: 0, emp: 0, acc: 0 };
            startTime = Date.now();
            timerActive = true;
            renderQuestion();
            updateTimer();
        };

        window.retakeTest = function () {
            window.startQuiz();
            window.scrollTo({ top: 0, behavior: "smooth" });
        };

        function renderQuestion() {
            if (currentQ >= questions.length) {
                finishQuiz();
                return;
            }

            const q = questions[currentQ];
            $("question-text").textContent = q.q;
            $("progress-text").textContent = `Q ${String(currentQ + 1).padStart(2, "0")} / ${questions.length}`;
            $("progress-bar").style.width = `${(currentQ / questions.length) * 100}%`;

            const container = $("options-container");
            container.innerHTML = "";

            q.a.forEach((opt) => {
                const btn = document.createElement("button");
                btn.className = "option-btn w-full p-4 sm:p-5 rounded-2xl text-left text-sm sm:text-[15px] text-slate-100 transition-all";
                btn.textContent = opt.text;
                btn.onclick = () => handleAnswer(opt.scores);
                container.appendChild(btn);
            });
        }

        function handleAnswer(scores) {
            totalScores.narc += scores.narc;
            totalScores.imp += scores.imp;
            totalScores.emp += scores.emp;
            totalScores.acc += scores.acc;

            currentQ++;
            renderQuestion();
        }

        function updateTimer() {
            if (!timerActive || $("quiz-interface").classList.contains("hidden")) return;
            const diffSec = Math.max(0, Math.floor((Date.now() - startTime) / 1000));
            $("timer-display").textContent = formatTime(diffSec);
            requestAnimationFrame(updateTimer);
        }

        // ================= RESULT LOGIC =================
        function pickArchetype() {
            const { narc, imp, emp, acc } = totalScores;
            let resultKey = "Unicorn";

            if (narc > 80 && emp > 60) resultKey = "Gaslighter";
            else if (imp > 80 && narc > 40) resultKey = "LoveBomber";
            else if (narc > 60 && acc < 0) resultKey = "Victim";
            else if (emp > 70) resultKey = "Vampire";
            else if (imp > 60 && acc < 20) resultKey = "Ick";
            else if (emp > 40 && narc < 40 && acc <= 20) resultKey = "Commitment";
            else if (narc < 30 && acc > 50) resultKey = "Unicorn";
            else resultKey = "Victim";

            return resultKey;
        }

        function finishQuiz() {
            timerActive = false;
            $("quiz-interface").classList.add("hidden");
            $("result-screen").classList.remove("hidden");

            const endTime = Date.now();
            const durationSec = Math.max(1, Math.floor((endTime - startTime) / 1000));

            const key = pickArchetype();
            const data = archetypes[key];

            const flagScore = computeFlagScore();
            const severityLabel = flagSeverityLabel(flagScore);

            // primary text
            $("result-title").textContent = data.title;
            $("result-subtitle").textContent = data.subtitle;
            $("result-summary").textContent = data.summary;
            $("result-description").textContent = data.desc;

            $("result-flag-score").textContent = `${flagScore}%`;
            $("result-flag-bar").style.width = `${flagScore}%`;
            $("result-severity-chip").textContent = severityLabel;

            // metrics
            const cappedNarc = Math.min(100, totalScores.narc);
            const cappedImp = Math.min(100, totalScores.imp);
            const cappedEmp = Math.min(100, totalScores.emp);

            $("score-narc").textContent = `${cappedNarc}%`;
            $("bar-narc").style.width = `${cappedNarc}%`;

            $("score-imp").textContent = `${cappedImp}%`;
            $("bar-imp").style.width = `${cappedImp}%`;

            $("score-emp").textContent = `${cappedEmp}%`;
            $("bar-emp").style.width = `${cappedEmp}%`;

            $("stat-time").textContent = `${durationSec}s`;
            $("stat-accountability").textContent =
                totalScores.acc > 30 ? "High" :
                totalScores.acc > 0 ? "Average" :
                "Avoidant";

            fillTags(key, flagScore);

            // quick lines
            const quick = $("quick-lines");
            quick.innerHTML = "";
            (data.bullets || []).forEach(line => {
                const p = document.createElement("p");
                p.textContent = "• " + line;
                quick.appendChild(p);
            });

            // extra report text (SEO-friendly but on theme)
            $("report-extra-1").textContent =
                "This profile is built from tiny choices: how fast you escalate, how you react when challenged, and what you do with other people’s trust. None of these moments look dramatic on their own, but together they form a pattern.";
            $("report-extra-2").textContent =
                "If you recognise yourself in this result, that is already progress. The next step is learning to pause before reacting, to apologise without arguments attached, and to treat other people’s feelings as more than background noise.";

            // Save to game-engine / Firestore – same structure as before
            const savePayload = {
                testId: "red_flag_radar",
                timestamp: new Date().toISOString(),
                archetype: key,
                durationSeconds: durationSec,
                metrics: {
                    narcissism_score: totalScores.narc,
                    impulse_control: totalScores.imp,
                    empathy_deficit: totalScores.emp,
                    accountability: totalScores.acc,
                    manipulation_index: (totalScores.narc + totalScores.emp) / 2
                }
            };

            if (window.saveTestResult) {
                try {
                    window.saveTestResult(savePayload);
                } catch (e) {
                    console.warn("saveTestResult failed", e);
                }
            }

            if (window.GameEngine && typeof window.GameEngine.trackEvent === "function") {
                try {
                    window.GameEngine.trackEvent("test_complete", {
                        testId: "red_flag_radar",
                        archetype: key,
                        durationSeconds: durationSec,
                        flagScore
                    });
                } catch (e) { /* ignore */ }
            }

            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        // ================= UI ACTIONS =================
        window.toggleFullReport = function () {
            const el = $("full-report");
            el.classList.toggle("hidden");
        };

        window.shareResults = async function () {
            const shareText = `I just did the Red Flag Audit on QuizRealm.\nResult: ${$("result-title").textContent} – ${$("result-subtitle").textContent}\nCheck yours here: ${window.location.href}`;

            if (navigator.share) {
                try {
                    await navigator.share({
                        title: "Red Flag Audit • QuizRealm",
                        text: shareText,
                        url: window.location.href
                    });
                    return;
                } catch (e) {
                    // fall through to clipboard
                }
            }

            if (navigator.clipboard && navigator.clipboard.writeText) {
                try {
                    await navigator.clipboard.writeText(shareText);
                    alert("Link and caption copied. Paste it into your chat or story.");
                    return;
                } catch (e) {
                    // fallback
                }
            }

            alert("Copy this text to share:\n\n" + shareText);
        };
    </script>
</body>
</html>
